(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module collections.
  Module btree.
    Module node.
      Definition value_B (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        ltac:(M.monadic (M.alloc (| Ty.path "usize", Value.Integer IntegerKind.Usize 6 |))).
      
      Global Instance Instance_IsConstant_value_B :
        M.IsFunction.C "alloc::collections::btree::node::B" value_B.
      Admitted.
      Global Typeclasses Opaque value_B.
      
      Definition value_CAPACITY (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        ltac:(M.monadic
          (M.alloc (|
            Ty.path "usize",
            M.call_closure (|
              Ty.path "usize",
              BinOp.Wrap.sub,
              [
                M.call_closure (|
                  Ty.path "usize",
                  BinOp.Wrap.mul,
                  [
                    Value.Integer IntegerKind.Usize 2;
                    M.read (|
                      get_constant (| "alloc::collections::btree::node::B", Ty.path "usize" |)
                    |)
                  ]
                |);
                Value.Integer IntegerKind.Usize 1
              ]
            |)
          |))).
      
      Global Instance Instance_IsConstant_value_CAPACITY :
        M.IsFunction.C "alloc::collections::btree::node::CAPACITY" value_CAPACITY.
      Admitted.
      Global Typeclasses Opaque value_CAPACITY.
      
      Definition value_MIN_LEN_AFTER_SPLIT
          (ε : list Value.t)
          (τ : list Ty.t)
          (α : list Value.t)
          : M :=
        ltac:(M.monadic
          (M.alloc (|
            Ty.path "usize",
            M.call_closure (|
              Ty.path "usize",
              BinOp.Wrap.sub,
              [
                M.read (|
                  get_constant (| "alloc::collections::btree::node::B", Ty.path "usize" |)
                |);
                Value.Integer IntegerKind.Usize 1
              ]
            |)
          |))).
      
      Global Instance Instance_IsConstant_value_MIN_LEN_AFTER_SPLIT :
        M.IsFunction.C
          "alloc::collections::btree::node::MIN_LEN_AFTER_SPLIT"
          value_MIN_LEN_AFTER_SPLIT.
      Admitted.
      Global Typeclasses Opaque value_MIN_LEN_AFTER_SPLIT.
      
      Definition value_KV_IDX_CENTER (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        ltac:(M.monadic
          (M.alloc (|
            Ty.path "usize",
            M.call_closure (|
              Ty.path "usize",
              BinOp.Wrap.sub,
              [
                M.read (|
                  get_constant (| "alloc::collections::btree::node::B", Ty.path "usize" |)
                |);
                Value.Integer IntegerKind.Usize 1
              ]
            |)
          |))).
      
      Global Instance Instance_IsConstant_value_KV_IDX_CENTER :
        M.IsFunction.C "alloc::collections::btree::node::KV_IDX_CENTER" value_KV_IDX_CENTER.
      Admitted.
      Global Typeclasses Opaque value_KV_IDX_CENTER.
      
      Definition value_EDGE_IDX_LEFT_OF_CENTER
          (ε : list Value.t)
          (τ : list Ty.t)
          (α : list Value.t)
          : M :=
        ltac:(M.monadic
          (M.alloc (|
            Ty.path "usize",
            M.call_closure (|
              Ty.path "usize",
              BinOp.Wrap.sub,
              [
                M.read (|
                  get_constant (| "alloc::collections::btree::node::B", Ty.path "usize" |)
                |);
                Value.Integer IntegerKind.Usize 1
              ]
            |)
          |))).
      
      Global Instance Instance_IsConstant_value_EDGE_IDX_LEFT_OF_CENTER :
        M.IsFunction.C
          "alloc::collections::btree::node::EDGE_IDX_LEFT_OF_CENTER"
          value_EDGE_IDX_LEFT_OF_CENTER.
      Admitted.
      Global Typeclasses Opaque value_EDGE_IDX_LEFT_OF_CENTER.
      
      Definition value_EDGE_IDX_RIGHT_OF_CENTER
          (ε : list Value.t)
          (τ : list Ty.t)
          (α : list Value.t)
          : M :=
        ltac:(M.monadic (get_constant (| "alloc::collections::btree::node::B", Ty.path "usize" |))).
      
      Global Instance Instance_IsConstant_value_EDGE_IDX_RIGHT_OF_CENTER :
        M.IsFunction.C
          "alloc::collections::btree::node::EDGE_IDX_RIGHT_OF_CENTER"
          value_EDGE_IDX_RIGHT_OF_CENTER.
      Admitted.
      Global Typeclasses Opaque value_EDGE_IDX_RIGHT_OF_CENTER.
      
      (* StructRecord
        {
          name := "LeafNode";
          const_params := [];
          ty_params := [ "K"; "V" ];
          fields :=
            [
              ("parent",
                Ty.apply
                  (Ty.path "core::option::Option")
                  []
                  [
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ]
                  ]);
              ("parent_idx",
                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ Ty.path "u16" ]);
              ("len", Ty.path "u16");
              ("keys",
                Ty.apply
                  (Ty.path "array")
                  [
                    M.unevaluated_const
                      (mk_str (| "alloc_collections_btree_node_LeafNode_keys_discriminant" |))
                  ]
                  [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]);
              ("vals",
                Ty.apply
                  (Ty.path "array")
                  [
                    M.unevaluated_const
                      (mk_str (| "alloc_collections_btree_node_LeafNode_vals_discriminant" |))
                  ]
                  [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ])
            ];
        } *)
      
      Module Impl_alloc_collections_btree_node_LeafNode_K_V.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ].
        
        (*
            unsafe fn init(this: *mut Self) {
                // As a general policy, we leave fields uninitialized if they can be, as this should
                // be both slightly faster and easier to track in Valgrind.
                unsafe {
                    // parent_idx, keys, and vals are all MaybeUninit
                    (&raw mut ( *this).parent).write(None);
                    (&raw mut ( *this).len).write(0);
                }
            }
        *)
        Definition init (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ this ] =>
            ltac:(M.monadic
              (let this :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                  this
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "*mut")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::option::Option")
                            []
                            [
                              Ty.apply
                                (Ty.path "core::ptr::non_null::NonNull")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::InternalNode")
                                    []
                                    [ K; V ]
                                ]
                            ]
                        ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutPointer,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| this |) |),
                          "alloc::collections::btree::node::LeafNode",
                          "parent"
                        |)
                      |);
                      Value.StructTuple
                        "core::option::Option::None"
                        []
                        [
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::InternalNode")
                                []
                                [ K; V ]
                            ]
                        ]
                        []
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "*mut") [] [ Ty.path "u16" ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutPointer,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| this |) |),
                          "alloc::collections::btree::node::LeafNode",
                          "len"
                        |)
                      |);
                      Value.Integer IntegerKind.U16 0
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_init :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "init" (init K V).
        Admitted.
        Global Typeclasses Opaque init.
        
        (*
            fn new<A: Allocator + Clone>(alloc: A) -> Box<Self, A> {
                unsafe {
                    let mut leaf = Box::new_uninit_in(alloc);
                    LeafNode::init(leaf.as_mut_ptr());
                    leaf.assume_init()
                }
            }
        *)
        Definition new (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ alloc ] =>
            ltac:(M.monadic
              (let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ leaf :
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ];
                        A
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::boxed::Box")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::LeafNode")
                            []
                            [ K; V ];
                          A
                        ],
                      "new_uninit_in",
                      [],
                      []
                    |),
                    [ M.read (| alloc |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ],
                      "init",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ],
                          "as_mut_ptr",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| leaf |) |) |) ]
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::boxed::Box")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]; A
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::boxed::Box")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ];
                          A
                        ],
                      "assume_init",
                      [],
                      []
                    |),
                    [ M.read (| leaf |) ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "new" (new K V).
        Admitted.
        Global Typeclasses Opaque new.
      End Impl_alloc_collections_btree_node_LeafNode_K_V.
      
      (* StructRecord
        {
          name := "InternalNode";
          const_params := [];
          ty_params := [ "K"; "V" ];
          fields :=
            [
              ("data", Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]);
              ("edges",
                Ty.apply
                  (Ty.path "array")
                  [
                    M.unevaluated_const
                      (mk_str (| "alloc_collections_btree_node_InternalNode_edges_discriminant" |))
                  ]
                  [
                    Ty.apply
                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ]
                  ])
            ];
        } *)
      
      Module Impl_alloc_collections_btree_node_InternalNode_K_V.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::InternalNode") [] [ K; V ].
        
        (*
            unsafe fn new<A: Allocator + Clone>(alloc: A) -> Box<Self, A> {
                unsafe {
                    let mut node = Box::<Self, _>::new_uninit_in(alloc);
                    // We only need to initialize the data; the edges are MaybeUninit.
                    LeafNode::init(&raw mut ( *node.as_mut_ptr()).data);
                    node.assume_init()
                }
            }
        *)
        Definition new (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ alloc ] =>
            ltac:(M.monadic
              (let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ node :
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ];
                        A
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::boxed::Box")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::InternalNode")
                            []
                            [ K; V ];
                          A
                        ],
                      "new_uninit_in",
                      [],
                      []
                    |),
                    [ M.read (| alloc |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ],
                      "init",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutPointer,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (|
                            M.call_closure (|
                              Ty.apply
                                (Ty.path "*mut")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::InternalNode")
                                    []
                                    [ K; V ]
                                ],
                              M.get_associated_function (|
                                Ty.apply
                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::InternalNode")
                                      []
                                      [ K; V ]
                                  ],
                                "as_mut_ptr",
                                [],
                                []
                              |),
                              [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| node |) |) |)
                              ]
                            |)
                          |),
                          "alloc::collections::btree::node::InternalNode",
                          "data"
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::boxed::Box")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::InternalNode")
                        []
                        [ K; V ];
                      A
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::boxed::Box")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::InternalNode")
                                []
                                [ K; V ]
                            ];
                          A
                        ],
                      "assume_init",
                      [],
                      []
                    |),
                    [ M.read (| node |) ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "new" (new K V).
        Admitted.
        Global Typeclasses Opaque new.
      End Impl_alloc_collections_btree_node_InternalNode_K_V.
      
      Axiom BoxedNode :
        forall (K V : Ty.t),
        (Ty.apply (Ty.path "alloc::collections::btree::node::BoxedNode") [] [ K; V ]) =
          (Ty.apply
            (Ty.path "core::ptr::non_null::NonNull")
            []
            [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ]).
      
      (* StructRecord
        {
          name := "NodeRef";
          const_params := [];
          ty_params := [ "BorrowType"; "K"; "V"; "Type_" ];
          fields :=
            [
              ("height", Ty.path "usize");
              ("node",
                Ty.apply
                  (Ty.path "core::ptr::non_null::NonNull")
                  []
                  [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ]);
              ("_marker",
                Ty.apply
                  (Ty.path "core::marker::PhantomData")
                  []
                  [ Ty.tuple [ BorrowType; Type_ ] ])
            ];
        } *)
      
      Axiom Root :
        forall (K V : Ty.t),
        (Ty.apply (Ty.path "alloc::collections::btree::node::Root") [] [ K; V ]) =
          (Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Owned";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
            ]).
      
      Module Impl_core_marker_Copy_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Copy"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Copy_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
      
      Module Impl_core_clone_Clone_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ].
        
        (*
            fn clone(&self) -> Self {
                *self
            }
        *)
        Definition clone
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ]
                    ],
                  self
                |) in
              M.read (| M.deref (| M.read (| self |) |) |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::clone::Clone"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [ ("clone", InstanceField.Method (clone K V Type_)) ].
      End Impl_core_clone_Clone_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
      
      Module Impl_core_marker_Sync_where_core_marker_Sync_K_where_core_marker_Sync_V_for_alloc_collections_btree_node_NodeRef_BorrowType_K_V_Type_.
        Definition Self (BorrowType K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ BorrowType; K; V; Type_ ].
        
        Axiom Implements :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Sync"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self BorrowType K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Sync_where_core_marker_Sync_K_where_core_marker_Sync_V_for_alloc_collections_btree_node_NodeRef_BorrowType_K_V_Type_.
      
      Module Impl_core_marker_Send_where_core_marker_Sync_K_where_core_marker_Sync_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Send"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Send_where_core_marker_Sync_K_where_core_marker_Sync_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
      
      Module Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Send"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_Type_.
      
      Module Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Send"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_Type_.
      
      Module Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Send"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_Type_.
      
      Module Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; Type_ ].
        
        Axiom Implements :
          forall (K V Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Send"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self K V Type_)
            (* Instance *) [].
      End Impl_core_marker_Send_where_core_marker_Send_K_where_core_marker_Send_V_for_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_Type_.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_Leaf.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Owned";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::Leaf"
            ].
        
        (*
            pub fn new_leaf<A: Allocator + Clone>(alloc: A) -> Self {
                Self::from_new_leaf(LeafNode::new(alloc))
            }
        *)
        Definition new_leaf
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ alloc ] =>
            ltac:(M.monadic
              (let alloc := M.alloc (| A, alloc |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Owned";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                    ],
                  "from_new_leaf",
                  [],
                  [ A ]
                |),
                [
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ],
                      "new",
                      [],
                      [ A ]
                    |),
                    [ M.read (| alloc |) ]
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new_leaf :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "new_leaf" (new_leaf K V).
        Admitted.
        Global Typeclasses Opaque new_leaf.
        
        (*
            fn from_new_leaf<A: Allocator + Clone>(leaf: Box<LeafNode<K, V>, A>) -> Self {
                NodeRef { height: 0, node: NonNull::from(Box::leak(leaf)), _marker: PhantomData }
            }
        *)
        Definition from_new_leaf
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ leaf ] =>
            ltac:(M.monadic
              (let leaf :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::boxed::Box")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]; A
                    ],
                  leaf
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Owned";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                ]
                [
                  ("height", Value.Integer IntegerKind.Usize 0);
                  ("node",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "core::ptr::non_null::NonNull")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ],
                      M.get_trait_method (|
                        "core::convert::From",
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        [],
                        [
                          Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ]
                        ],
                        "from",
                        [],
                        []
                      |),
                      [
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "alloc::boxed::Box")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::LeafNode")
                                  []
                                  [ K; V ];
                                A
                              ],
                            "leak",
                            [],
                            []
                          |),
                          [ M.read (| leaf |) ]
                        |)
                      ]
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [
                        Ty.tuple
                          [
                            Ty.path "alloc::collections::btree::node::marker::Owned";
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_from_new_leaf :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "from_new_leaf" (from_new_leaf K V).
        Admitted.
        Global Typeclasses Opaque from_new_leaf.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_Leaf.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_Internal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Owned";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::Internal"
            ].
        
        (*
            fn new_internal<A: Allocator + Clone>(child: Root<K, V>, alloc: A) -> Self {
                let mut new_node = unsafe { InternalNode::new(alloc) };
                new_node.edges[0].write(child.node);
                unsafe { NodeRef::from_new_internal(new_node, child.height + 1) }
            }
        *)
        Definition new_internal
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ child; alloc ] =>
            ltac:(M.monadic
              (let child :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  child
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ new_node :
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ];
                        A
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::InternalNode")
                        []
                        [ K; V ],
                      "new",
                      [],
                      [ A ]
                    |),
                    [ M.read (| alloc |) ]
                  |) in
                let~ _ :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ]
                        ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_array_field (|
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| new_node |) |),
                            "alloc::collections::btree::node::InternalNode",
                            "edges"
                          |),
                          Value.Integer IntegerKind.Usize 0
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          child,
                          "alloc::collections::btree::node::NodeRef",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "from_new_internal",
                      [],
                      [ A ]
                    |),
                    [
                      M.read (| new_node |);
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.add,
                        [
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              child,
                              "alloc::collections::btree::node::NodeRef",
                              "height"
                            |)
                          |);
                          Value.Integer IntegerKind.Usize 1
                        ]
                      |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new_internal :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "new_internal" (new_internal K V).
        Admitted.
        Global Typeclasses Opaque new_internal.
        
        (*
            unsafe fn from_new_internal<A: Allocator + Clone>(
                internal: Box<InternalNode<K, V>, A>,
                height: usize,
            ) -> Self {
                debug_assert!(height > 0);
                let node = NonNull::from(Box::leak(internal)).cast();
                let mut this = NodeRef { height, node, _marker: PhantomData };
                this.borrow_mut().correct_all_childrens_parent_links();
                this
            }
        *)
        Definition from_new_internal
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ internal; height ] =>
            ltac:(M.monadic
              (let internal :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::boxed::Box")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::InternalNode")
                        []
                        [ K; V ];
                      A
                    ],
                  internal
                |) in
              let height := M.alloc (| Ty.path "usize", height |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.gt,
                                                  [
                                                    M.read (| height |);
                                                    Value.Integer IntegerKind.Usize 0
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: height > 0" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ node :
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::ptr::non_null::NonNull")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::InternalNode")
                            []
                            [ K; V ]
                        ],
                      "cast",
                      [],
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ]
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ],
                        M.get_trait_method (|
                          "core::convert::From",
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::InternalNode")
                                []
                                [ K; V ]
                            ],
                          [],
                          [
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::InternalNode")
                                  []
                                  [ K; V ]
                              ]
                          ],
                          "from",
                          [],
                          []
                        |),
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::InternalNode")
                                  []
                                  [ K; V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::boxed::Box")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::InternalNode")
                                    []
                                    [ K; V ];
                                  A
                                ],
                              "leak",
                              [],
                              []
                            |),
                            [ M.read (| internal |) ]
                          |)
                        ]
                      |)
                    ]
                  |) in
                let~ this :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ] :=
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ]
                    [
                      ("height", M.read (| height |));
                      ("node", M.read (| node |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                Ty.path "alloc::collections::btree::node::marker::Owned";
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ]
                          ]
                          [])
                    ] in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "correct_all_childrens_parent_links",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.alloc (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Owned";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "borrow_mut",
                              [],
                              []
                            |),
                            [ M.borrow (| Pointer.Kind.MutRef, this |) ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                this
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_from_new_internal :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "from_new_internal" (from_new_internal K V).
        Admitted.
        Global Typeclasses Opaque from_new_internal.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_Internal.
      
      Module Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Internal.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ].
        
        (*
            fn from_internal(node: NonNull<InternalNode<K, V>>, height: usize) -> Self {
                debug_assert!(height > 0);
                NodeRef { height, node: node.cast(), _marker: PhantomData }
            }
        *)
        Definition from_internal
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ node; height ] =>
            ltac:(M.monadic
              (let node :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "core::ptr::non_null::NonNull")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::InternalNode") [] [ K; V ]
                    ],
                  node
                |) in
              let height := M.alloc (| Ty.path "usize", height |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.gt,
                                                  [
                                                    M.read (| height |);
                                                    Value.Integer IntegerKind.Usize 0
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: height > 0" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Internal"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Internal"
                    ]
                    [
                      ("height", M.read (| height |));
                      ("node",
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "core::ptr::non_null::NonNull")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::InternalNode")
                                  []
                                  [ K; V ]
                              ],
                            "cast",
                            [],
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ]
                          |),
                          [ M.read (| node |) ]
                        |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                BorrowType;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ]
                          ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_from_internal :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V)
            "from_internal"
            (from_internal BorrowType K V).
        Admitted.
        Global Typeclasses Opaque from_internal.
        (*
            fn as_internal_ptr(this: &Self) -> *mut InternalNode<K, V> {
                // SAFETY: the static node type is `Internal`.
                this.node.as_ptr() as *mut InternalNode<K, V>
            }
        *)
        Definition as_internal_ptr
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ this ] =>
            ltac:(M.monadic
              (let this :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  this
                |) in
              M.cast
                (Ty.apply
                  (Ty.path "*mut")
                  []
                  [ Ty.apply (Ty.path "alloc::collections::btree::node::InternalNode") [] [ K; V ]
                  ])
                (M.call_closure (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    "as_ptr",
                    [],
                    []
                  |),
                  [
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| this |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |)
                  ]
                |))))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_as_internal_ptr :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V)
            "as_internal_ptr"
            (as_internal_ptr BorrowType K V).
        Admitted.
        Global Typeclasses Opaque as_internal_ptr.
        (*
            pub fn forget_type(self) -> NodeRef<BorrowType, K, V, marker::LeafOrInternal> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition forget_type
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Internal"
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [
                  BorrowType;
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [
                        Ty.tuple
                          [
                            BorrowType;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_type :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V) "forget_type" (forget_type BorrowType K V).
        Admitted.
        Global Typeclasses Opaque forget_type.
      End Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Internal.
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Mut";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::Internal"
            ].
        
        (*
            fn as_internal_mut(&mut self) -> &mut InternalNode<K, V> {
                let ptr = Self::as_internal_ptr(self);
                unsafe { &mut *ptr }
            }
        *)
        Definition as_internal_mut
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.read (|
                    let~ ptr :
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ] :=
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          "as_internal_ptr",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                      |) in
                    M.alloc (|
                      Ty.apply
                        (Ty.path "&mut")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::InternalNode")
                            []
                            [ K; V ]
                        ],
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| ptr |) |) |)
                            |)
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_as_internal_mut :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "as_internal_mut" (as_internal_mut K V).
        Admitted.
        Global Typeclasses Opaque as_internal_mut.
        (*
            unsafe fn edge_area_mut<I, Output: ?Sized>(&mut self, index: I) -> &mut Output
            where
                I: SliceIndex<[MaybeUninit<BoxedNode<K, V>>], Output = Output>,
            {
                // SAFETY: the caller will not be able to call further methods on self
                // until the edge slice reference is dropped, as we have unique access
                // for the lifetime of the borrow.
                unsafe { self.as_internal_mut().edges.as_mut_slice().get_unchecked_mut(index) }
            }
        *)
        Definition edge_area_mut
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ _ as I; Output ], [ self; index ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  self
                |) in
              let index := M.alloc (| I, index |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply (Ty.path "&mut") [] [ Output ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::ptr::non_null::NonNull")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::LeafNode")
                                            []
                                            [ K; V ]
                                        ]
                                    ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ I ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ptr::non_null::NonNull")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::LeafNode")
                                                      []
                                                      [ K; V ]
                                                  ]
                                              ]
                                          ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 12 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::ptr::non_null::NonNull")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::LeafNode")
                                                    []
                                                    [ K; V ]
                                                ]
                                            ]
                                        ],
                                      "as_mut_slice",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (|
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::InternalNode")
                                                    []
                                                    [ K; V ]
                                                ],
                                              M.get_associated_function (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Internal"
                                                  ],
                                                "as_internal_mut",
                                                [],
                                                []
                                              |),
                                              [
                                                M.borrow (|
                                                  Pointer.Kind.MutRef,
                                                  M.deref (| M.read (| self |) |)
                                                |)
                                              ]
                                            |)
                                          |),
                                          "alloc::collections::btree::node::InternalNode",
                                          "edges"
                                        |)
                                      |)
                                    ]
                                  |)
                                |)
                              |);
                              M.read (| index |)
                            ]
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_edge_area_mut :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "edge_area_mut" (edge_area_mut K V).
        Admitted.
        Global Typeclasses Opaque edge_area_mut.
        (*
            unsafe fn correct_childrens_parent_links<R: Iterator<Item = usize>>(&mut self, range: R) {
                for i in range {
                    debug_assert!(i <= self.len());
                    unsafe { Handle::new_edge(self.reborrow_mut(), i) }.correct_parent_link();
                }
            }
        *)
        Definition correct_childrens_parent_links
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ R ], [ self; range ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  self
                |) in
              let range := M.alloc (| R, range |) in
              M.read (|
                M.use
                  (M.alloc (|
                    Ty.tuple [],
                    M.match_operator (|
                      Ty.tuple [],
                      M.alloc (|
                        R,
                        M.call_closure (|
                          R,
                          M.get_trait_method (|
                            "core::iter::traits::collect::IntoIterator",
                            R,
                            [],
                            [],
                            "into_iter",
                            [],
                            []
                          |),
                          [ M.read (| range |) ]
                        |)
                      |),
                      [
                        fun γ =>
                          ltac:(M.monadic
                            (let iter := M.copy (| R, γ |) in
                            M.read (|
                              M.loop (|
                                Ty.tuple [],
                                ltac:(M.monadic
                                  (let~ _ : Ty.tuple [] :=
                                    M.match_operator (|
                                      Ty.tuple [],
                                      M.alloc (|
                                        Ty.apply
                                          (Ty.path "core::option::Option")
                                          []
                                          [ Ty.path "usize" ],
                                        M.call_closure (|
                                          Ty.apply
                                            (Ty.path "core::option::Option")
                                            []
                                            [ Ty.path "usize" ],
                                          M.get_trait_method (|
                                            "core::iter::traits::iterator::Iterator",
                                            R,
                                            [],
                                            [],
                                            "next",
                                            [],
                                            []
                                          |),
                                          [
                                            M.borrow (|
                                              Pointer.Kind.MutRef,
                                              M.deref (| M.borrow (| Pointer.Kind.MutRef, iter |) |)
                                            |)
                                          ]
                                        |)
                                      |),
                                      [
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let _ :=
                                              M.is_struct_tuple (|
                                                γ,
                                                "core::option::Option::None"
                                              |) in
                                            M.never_to_any (| M.read (| M.break (||) |) |)));
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let γ0_0 :=
                                              M.SubPointer.get_struct_tuple_field (|
                                                γ,
                                                "core::option::Option::Some",
                                                0
                                              |) in
                                            let i := M.copy (| Ty.path "usize", γ0_0 |) in
                                            M.read (|
                                              let~ _ : Ty.tuple [] :=
                                                M.match_operator (|
                                                  Ty.tuple [],
                                                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                                  [
                                                    fun γ =>
                                                      ltac:(M.monadic
                                                        (let γ :=
                                                          M.use
                                                            (M.alloc (|
                                                              Ty.path "bool",
                                                              Value.Bool true
                                                            |)) in
                                                        let _ :=
                                                          is_constant_or_break_match (|
                                                            M.read (| γ |),
                                                            Value.Bool true
                                                          |) in
                                                        M.read (|
                                                          let~ _ : Ty.tuple [] :=
                                                            M.match_operator (|
                                                              Ty.tuple [],
                                                              M.alloc (|
                                                                Ty.tuple [],
                                                                Value.Tuple []
                                                              |),
                                                              [
                                                                fun γ =>
                                                                  ltac:(M.monadic
                                                                    (let γ :=
                                                                      M.use
                                                                        (M.alloc (|
                                                                          Ty.path "bool",
                                                                          M.call_closure (|
                                                                            Ty.path "bool",
                                                                            UnOp.not,
                                                                            [
                                                                              M.call_closure (|
                                                                                Ty.path "bool",
                                                                                BinOp.le,
                                                                                [
                                                                                  M.read (| i |);
                                                                                  M.call_closure (|
                                                                                    Ty.path "usize",
                                                                                    M.get_associated_function (|
                                                                                      Ty.apply
                                                                                        (Ty.path
                                                                                          "alloc::collections::btree::node::NodeRef")
                                                                                        []
                                                                                        [
                                                                                          Ty.path
                                                                                            "alloc::collections::btree::node::marker::Mut";
                                                                                          K;
                                                                                          V;
                                                                                          Ty.path
                                                                                            "alloc::collections::btree::node::marker::Internal"
                                                                                        ],
                                                                                      "len",
                                                                                      [],
                                                                                      []
                                                                                    |),
                                                                                    [
                                                                                      M.borrow (|
                                                                                        Pointer.Kind.Ref,
                                                                                        M.deref (|
                                                                                          M.read (|
                                                                                            self
                                                                                          |)
                                                                                        |)
                                                                                      |)
                                                                                    ]
                                                                                  |)
                                                                                ]
                                                                              |)
                                                                            ]
                                                                          |)
                                                                        |)) in
                                                                    let _ :=
                                                                      is_constant_or_break_match (|
                                                                        M.read (| γ |),
                                                                        Value.Bool true
                                                                      |) in
                                                                    M.never_to_any (|
                                                                      M.call_closure (|
                                                                        Ty.path "never",
                                                                        M.get_function (|
                                                                          "core::panicking::panic",
                                                                          [],
                                                                          []
                                                                        |),
                                                                        [
                                                                          mk_str (|
                                                                            "assertion failed: i <= self.len()"
                                                                          |)
                                                                        ]
                                                                      |)
                                                                    |)));
                                                                fun γ =>
                                                                  ltac:(M.monadic (Value.Tuple []))
                                                              ]
                                                            |) in
                                                          M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                                        |)));
                                                    fun γ => ltac:(M.monadic (Value.Tuple []))
                                                  ]
                                                |) in
                                              let~ _ : Ty.tuple [] :=
                                                M.call_closure (|
                                                  Ty.tuple [],
                                                  M.get_associated_function (|
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::Handle")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Internal"
                                                          ];
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Edge"
                                                      ],
                                                    "correct_parent_link",
                                                    [],
                                                    []
                                                  |),
                                                  [
                                                    M.call_closure (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::Handle")
                                                        []
                                                        [
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::NodeRef")
                                                            []
                                                            [
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Mut";
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ];
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Edge"
                                                        ],
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::Handle")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::NodeRef")
                                                              []
                                                              [
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Mut";
                                                                K;
                                                                V;
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Internal"
                                                              ];
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Edge"
                                                          ],
                                                        "new_edge",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.call_closure (|
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::NodeRef")
                                                            []
                                                            [
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Mut";
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ],
                                                          M.get_associated_function (|
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::NodeRef")
                                                              []
                                                              [
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Mut";
                                                                K;
                                                                V;
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Internal"
                                                              ],
                                                            "reborrow_mut",
                                                            [],
                                                            []
                                                          |),
                                                          [
                                                            M.borrow (|
                                                              Pointer.Kind.MutRef,
                                                              M.deref (| M.read (| self |) |)
                                                            |)
                                                          ]
                                                        |);
                                                        M.read (| i |)
                                                      ]
                                                    |)
                                                  ]
                                                |) in
                                              M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                            |)))
                                      ]
                                    |) in
                                  M.alloc (| Ty.tuple [], Value.Tuple [] |)))
                              |)
                            |)))
                      ]
                    |)
                  |))
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_correct_childrens_parent_links :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V)
            "correct_childrens_parent_links"
            (correct_childrens_parent_links K V).
        Admitted.
        Global Typeclasses Opaque correct_childrens_parent_links.
        
        (*
            fn correct_all_childrens_parent_links(&mut self) {
                let len = self.len();
                unsafe { self.correct_childrens_parent_links(0..=len) };
            }
        *)
        Definition correct_all_childrens_parent_links
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  self
                |) in
              M.read (|
                let~ len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "correct_childrens_parent_links",
                      [],
                      [ Ty.apply (Ty.path "core::ops::range::RangeInclusive") [] [ Ty.path "usize" ]
                      ]
                    |),
                    [
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "core::ops::range::RangeInclusive")
                          []
                          [ Ty.path "usize" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "core::ops::range::RangeInclusive")
                            []
                            [ Ty.path "usize" ],
                          "new",
                          [],
                          []
                        |),
                        [ Value.Integer IntegerKind.Usize 0; M.read (| len |) ]
                      |)
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_correct_all_childrens_parent_links :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V)
            "correct_all_childrens_parent_links"
            (correct_all_childrens_parent_links K V).
        Admitted.
        Global Typeclasses Opaque correct_all_childrens_parent_links.
        (*
            pub fn push(&mut self, key: K, val: V, edge: Root<K, V>) {
                assert!(edge.height == self.height - 1);
        
                let len = self.len_mut();
                let idx = usize::from( *len);
                assert!(idx < CAPACITY);
                *len += 1;
                unsafe {
                    self.key_area_mut(idx).write(key);
                    self.val_area_mut(idx).write(val);
                    self.edge_area_mut(idx + 1).write(edge.node);
                    Handle::new_edge(self.reborrow_mut(), idx + 1).correct_parent_link();
                }
            }
        *)
        Definition push (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; key; val; edge ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              let edge :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  edge
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.eq,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            edge,
                                            "alloc::collections::btree::node::NodeRef",
                                            "height"
                                          |)
                                        |);
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.sub,
                                          [
                                            M.read (|
                                              M.SubPointer.get_struct_record_field (|
                                                M.deref (| M.read (| self |) |),
                                                "alloc::collections::btree::node::NodeRef",
                                                "height"
                                              |)
                                            |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: edge.height == self.height - 1" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ len : Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "len_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ idx : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_trait_method (|
                      "core::convert::From",
                      Ty.path "usize",
                      [],
                      [ Ty.path "u16" ],
                      "from",
                      [],
                      []
                    |),
                    [ M.read (| M.deref (| M.read (| len |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.lt,
                                      [
                                        M.read (| idx |);
                                        M.read (|
                                          get_constant (|
                                            "alloc::collections::btree::node::CAPACITY",
                                            Ty.path "usize"
                                          |)
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: idx < CAPACITY" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  let β := M.deref (| M.read (| len |) |) in
                  M.write (|
                    β,
                    M.call_closure (|
                      Ty.path "u16",
                      BinOp.Wrap.add,
                      [ M.read (| β |); Value.Integer IntegerKind.U16 1 ]
                    |)
                  |) in
                let~ _ : Ty.apply (Ty.path "&mut") [] [ K ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ K ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ]
                            |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                              M.read (| idx |)
                            ]
                          |)
                        |)
                      |);
                      M.read (| key |)
                    ]
                  |) in
                let~ _ : Ty.apply (Ty.path "&mut") [] [ V ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ V ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ]
                            |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                              M.read (| idx |)
                            ]
                          |)
                        |)
                      |);
                      M.read (| val |)
                    ]
                  |) in
                let~ _ :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ]
                        ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "edge_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply
                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                              M.call_closure (|
                                Ty.path "usize",
                                BinOp.Wrap.add,
                                [ M.read (| idx |); Value.Integer IntegerKind.Usize 1 ]
                              |)
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          edge,
                          "alloc::collections::btree::node::NodeRef",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "correct_parent_link",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ],
                          "new_edge",
                          [],
                          []
                        |),
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "reborrow_mut",
                              [],
                              []
                            |),
                            [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                          |);
                          M.call_closure (|
                            Ty.path "usize",
                            BinOp.Wrap.add,
                            [ M.read (| idx |); Value.Integer IntegerKind.Usize 1 ]
                          |)
                        ]
                      |)
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_push :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "push" (push K V).
        Admitted.
        Global Typeclasses Opaque push.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal.
      
      Module Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_Type_.
        Definition Self (BorrowType K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ BorrowType; K; V; Type_ ].
        
        (*
            pub fn len(&self) -> usize {
                // Crucially, we only access the `len` field here. If BorrowType is marker::ValMut,
                // there might be outstanding mutable references to values that we must not invalidate.
                unsafe { usize::from(( *Self::as_leaf_ptr(self)).len) }
            }
        *)
        Definition len
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.path "usize",
                M.get_trait_method (|
                  "core::convert::From",
                  Ty.path "usize",
                  [],
                  [ Ty.path "u16" ],
                  "from",
                  [],
                  []
                |),
                [
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (|
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "*mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [ BorrowType; K; V; Type_ ],
                            "as_leaf_ptr",
                            [],
                            []
                          |),
                          [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                        |)
                      |),
                      "alloc::collections::btree::node::LeafNode",
                      "len"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_len :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V Type_) "len" (len BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque len.
        
        (*
            pub fn height(&self) -> usize {
                self.height
            }
        *)
        Definition height
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  self
                |) in
              M.read (|
                M.SubPointer.get_struct_record_field (|
                  M.deref (| M.read (| self |) |),
                  "alloc::collections::btree::node::NodeRef",
                  "height"
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_height :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "height"
            (height BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque height.
        
        (*
            pub fn reborrow(&self) -> NodeRef<marker::Immut<'_>, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition reborrow
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [ Ty.tuple [ Ty.path "alloc::collections::btree::node::marker::Immut"; Type_ ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_reborrow :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "reborrow"
            (reborrow BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque reborrow.
        
        (*
            fn as_leaf_ptr(this: &Self) -> *mut LeafNode<K, V> {
                // The node must be valid for at least the LeafNode portion.
                // This is not a reference in the NodeRef type because we don't know if
                // it should be unique or shared.
                this.node.as_ptr()
            }
        *)
        Definition as_leaf_ptr
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ this ] =>
            ltac:(M.monadic
              (let this :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  this
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "*mut")
                  []
                  [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "core::ptr::non_null::NonNull")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                  "as_ptr",
                  [],
                  []
                |),
                [
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| this |) |),
                      "alloc::collections::btree::node::NodeRef",
                      "node"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_as_leaf_ptr :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "as_leaf_ptr"
            (as_leaf_ptr BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque as_leaf_ptr.
        (*
            pub fn ascend(
                self,
            ) -> Result<Handle<NodeRef<BorrowType, K, V, marker::Internal>, marker::Edge>, Self> {
                const {
                    assert!(BorrowType::TRAVERSAL_PERMIT);
                }
        
                // We need to use raw pointers to nodes because, if BorrowType is marker::ValMut,
                // there might be outstanding mutable references to values that we must not invalidate.
                let leaf_ptr: *const _ = Self::as_leaf_ptr(&self);
                unsafe { ( *leaf_ptr).parent }
                    .as_ref()
                    .map(|parent| Handle {
                        node: NodeRef::from_internal( *parent, self.height + 1),
                        idx: unsafe { usize::from(( *leaf_ptr).parent_idx.assume_init()) },
                        _marker: PhantomData,
                    })
                    .ok_or(self)
            }
        *)
        Definition ascend
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Type_ ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.read (|
                    get_constant (|
                      "alloc::collections::btree::node::ascend_discriminant",
                      Ty.tuple []
                    |)
                  |) in
                let~ leaf_ptr :
                    Ty.apply
                      (Ty.path "*const")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*const")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.pointer_coercion
                      M.PointerCoercion.MutToConstPointer
                      (Ty.apply
                        (Ty.path "*mut")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ])
                      (Ty.apply
                        (Ty.path "*const")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ]),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; Type_ ],
                          "as_leaf_ptr",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (| M.borrow (| Pointer.Kind.Ref, self |) |)
                          |)
                        ]
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "core::result::Result")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ];
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::result::Result")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                BorrowType;
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ];
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; Type_ ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::option::Option")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ]
                        ],
                      "ok_or",
                      [],
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; Type_ ]
                      ]
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "core::option::Option")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    BorrowType;
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::Edge"
                              ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "core::option::Option")
                            []
                            [
                              Ty.apply
                                (Ty.path "&")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "core::ptr::non_null::NonNull")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::InternalNode")
                                        []
                                        [ K; V ]
                                    ]
                                ]
                            ],
                          "map",
                          [],
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    BorrowType;
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::Edge"
                              ];
                            Ty.function
                              [
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::InternalNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                              ]
                              (Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      BorrowType;
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ])
                          ]
                        |),
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "core::option::Option")
                              []
                              [
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::InternalNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "core::option::Option")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "core::ptr::non_null::NonNull")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::InternalNode")
                                        []
                                        [ K; V ]
                                    ]
                                ],
                              "as_ref",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.Ref,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| leaf_ptr |) |),
                                  "alloc::collections::btree::node::LeafNode",
                                  "parent"
                                |)
                              |)
                            ]
                          |);
                          M.closure
                            (fun γ =>
                              ltac:(M.monadic
                                match γ with
                                | [ α0 ] =>
                                  ltac:(M.monadic
                                    (M.match_operator (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              BorrowType;
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::Edge"
                                        ],
                                      M.alloc (|
                                        Ty.apply
                                          (Ty.path "&")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::ptr::non_null::NonNull")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::InternalNode")
                                                  []
                                                  [ K; V ]
                                              ]
                                          ],
                                        α0
                                      |),
                                      [
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let parent :=
                                              M.copy (|
                                                Ty.apply
                                                  (Ty.path "&")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::InternalNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ],
                                                γ
                                              |) in
                                            Value.mkStructRecord
                                              "alloc::collections::btree::node::Handle"
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    BorrowType;
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Internal"
                                                  ];
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Edge"
                                              ]
                                              [
                                                ("node",
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        BorrowType;
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          BorrowType;
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "from_internal",
                                                      [],
                                                      []
                                                    |),
                                                    [
                                                      M.read (|
                                                        M.deref (| M.read (| parent |) |)
                                                      |);
                                                      M.call_closure (|
                                                        Ty.path "usize",
                                                        BinOp.Wrap.add,
                                                        [
                                                          M.read (|
                                                            M.SubPointer.get_struct_record_field (|
                                                              self,
                                                              "alloc::collections::btree::node::NodeRef",
                                                              "height"
                                                            |)
                                                          |);
                                                          Value.Integer IntegerKind.Usize 1
                                                        ]
                                                      |)
                                                    ]
                                                  |));
                                                ("idx",
                                                  M.call_closure (|
                                                    Ty.path "usize",
                                                    M.get_trait_method (|
                                                      "core::convert::From",
                                                      Ty.path "usize",
                                                      [],
                                                      [ Ty.path "u16" ],
                                                      "from",
                                                      [],
                                                      []
                                                    |),
                                                    [
                                                      M.call_closure (|
                                                        Ty.path "u16",
                                                        M.get_associated_function (|
                                                          Ty.apply
                                                            (Ty.path
                                                              "core::mem::maybe_uninit::MaybeUninit")
                                                            []
                                                            [ Ty.path "u16" ],
                                                          "assume_init",
                                                          [],
                                                          []
                                                        |),
                                                        [
                                                          M.read (|
                                                            M.SubPointer.get_struct_record_field (|
                                                              M.deref (| M.read (| leaf_ptr |) |),
                                                              "alloc::collections::btree::node::LeafNode",
                                                              "parent_idx"
                                                            |)
                                                          |)
                                                        ]
                                                      |)
                                                    ]
                                                  |));
                                                ("_marker",
                                                  Value.StructTuple
                                                    "core::marker::PhantomData"
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Edge"
                                                    ]
                                                    [])
                                              ]))
                                      ]
                                    |)))
                                | _ => M.impossible "wrong number of arguments"
                                end))
                        ]
                      |);
                      M.read (| self |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_ascend :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "ascend"
            (ascend BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque ascend.
        
        (*
            pub fn first_edge(self) -> Handle<Self, marker::Edge> {
                unsafe { Handle::new_edge(self, 0) }
            }
        *)
        Definition first_edge
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Type_ ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [ BorrowType; K; V; Type_ ];
                    Ty.path "alloc::collections::btree::node::marker::Edge"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  "new_edge",
                  [],
                  []
                |),
                [ M.read (| self |); Value.Integer IntegerKind.Usize 0 ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_first_edge :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "first_edge"
            (first_edge BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque first_edge.
        
        (*
            pub fn last_edge(self) -> Handle<Self, marker::Edge> {
                let len = self.len();
                unsafe { Handle::new_edge(self, len) }
            }
        *)
        Definition last_edge
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Type_ ],
                  self
                |) in
              M.read (|
                let~ len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, self |) ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; Type_ ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; Type_ ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "new_edge",
                      [],
                      []
                    |),
                    [ M.read (| self |); M.read (| len |) ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_last_edge :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "last_edge"
            (last_edge BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque last_edge.
        
        (*
            pub fn first_kv(self) -> Handle<Self, marker::KV> {
                let len = self.len();
                assert!(len > 0);
                unsafe { Handle::new_kv(self, 0) }
            }
        *)
        Definition first_kv
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Type_ ],
                  self
                |) in
              M.read (|
                let~ len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, self |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.gt,
                                      [ M.read (| len |); Value.Integer IntegerKind.Usize 0 ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: len > 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; Type_ ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; Type_ ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "new_kv",
                      [],
                      []
                    |),
                    [ M.read (| self |); Value.Integer IntegerKind.Usize 0 ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_first_kv :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "first_kv"
            (first_kv BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque first_kv.
        
        (*
            pub fn last_kv(self) -> Handle<Self, marker::KV> {
                let len = self.len();
                assert!(len > 0);
                unsafe { Handle::new_kv(self, len - 1) }
            }
        *)
        Definition last_kv
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Type_ ],
                  self
                |) in
              M.read (|
                let~ len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, self |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.gt,
                                      [ M.read (| len |); Value.Integer IntegerKind.Usize 0 ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: len > 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; Type_ ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; Type_ ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "new_kv",
                      [],
                      []
                    |),
                    [
                      M.read (| self |);
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.sub,
                        [ M.read (| len |); Value.Integer IntegerKind.Usize 1 ]
                      |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_last_kv :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V Type_)
            "last_kv"
            (last_kv BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque last_kv.
        (*
            fn eq(&self, other: &Self) -> bool {
                let Self { node, height, _marker } = self;
                if node.eq(&other.node) {
                    debug_assert_eq!( *height, other.height);
                    true
                } else {
                    false
                }
            }
        *)
        Definition eq
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self; other ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  self
                |) in
              let other :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Type_ ]
                    ],
                  other
                |) in
              M.match_operator (|
                Ty.path "bool",
                self,
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ := M.deref (| M.read (| γ |) |) in
                      let γ1_0 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::NodeRef",
                          "node"
                        |) in
                      let γ1_1 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::NodeRef",
                          "height"
                        |) in
                      let γ1_2 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::NodeRef",
                          "_marker"
                        |) in
                      let node :=
                        M.alloc (|
                          Ty.apply
                            (Ty.path "&")
                            []
                            [
                              Ty.apply
                                (Ty.path "core::ptr::non_null::NonNull")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeafNode")
                                    []
                                    [ K; V ]
                                ]
                            ],
                          γ1_0
                        |) in
                      let height :=
                        M.alloc (| Ty.apply (Ty.path "&") [] [ Ty.path "usize" ], γ1_1 |) in
                      let _marker :=
                        M.alloc (|
                          Ty.apply
                            (Ty.path "&")
                            []
                            [
                              Ty.apply
                                (Ty.path "core::marker::PhantomData")
                                []
                                [ Ty.tuple [ BorrowType; Type_ ] ]
                            ],
                          γ1_2
                        |) in
                      M.match_operator (|
                        Ty.path "bool",
                        M.alloc (| Ty.tuple [], Value.Tuple [] |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ :=
                                M.use
                                  (M.alloc (|
                                    Ty.path "bool",
                                    M.call_closure (|
                                      Ty.path "bool",
                                      M.get_trait_method (|
                                        "core::cmp::PartialEq",
                                        Ty.apply
                                          (Ty.path "core::ptr::non_null::NonNull")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::LeafNode")
                                              []
                                              [ K; V ]
                                          ],
                                        [],
                                        [
                                          Ty.apply
                                            (Ty.path "core::ptr::non_null::NonNull")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path
                                                  "alloc::collections::btree::node::LeafNode")
                                                []
                                                [ K; V ]
                                            ]
                                        ],
                                        "eq",
                                        [],
                                        []
                                      |),
                                      [
                                        M.borrow (|
                                          Pointer.Kind.Ref,
                                          M.deref (| M.read (| node |) |)
                                        |);
                                        M.borrow (|
                                          Pointer.Kind.Ref,
                                          M.deref (|
                                            M.borrow (|
                                              Pointer.Kind.Ref,
                                              M.SubPointer.get_struct_record_field (|
                                                M.deref (| M.read (| other |) |),
                                                "alloc::collections::btree::node::NodeRef",
                                                "node"
                                              |)
                                            |)
                                          |)
                                        |)
                                      ]
                                    |)
                                  |)) in
                              let _ :=
                                is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                              M.read (|
                                let~ _ : Ty.tuple [] :=
                                  M.match_operator (|
                                    Ty.tuple [],
                                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                    [
                                      fun γ =>
                                        ltac:(M.monadic
                                          (let γ :=
                                            M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                                          let _ :=
                                            is_constant_or_break_match (|
                                              M.read (| γ |),
                                              Value.Bool true
                                            |) in
                                          M.read (|
                                            let~ _ : Ty.tuple [] :=
                                              M.match_operator (|
                                                Ty.tuple [],
                                                M.alloc (|
                                                  Ty.tuple
                                                    [
                                                      Ty.apply (Ty.path "&") [] [ Ty.path "usize" ];
                                                      Ty.apply (Ty.path "&") [] [ Ty.path "usize" ]
                                                    ],
                                                  Value.Tuple
                                                    [
                                                      M.borrow (|
                                                        Pointer.Kind.Ref,
                                                        M.deref (| M.read (| height |) |)
                                                      |);
                                                      M.borrow (|
                                                        Pointer.Kind.Ref,
                                                        M.SubPointer.get_struct_record_field (|
                                                          M.deref (| M.read (| other |) |),
                                                          "alloc::collections::btree::node::NodeRef",
                                                          "height"
                                                        |)
                                                      |)
                                                    ]
                                                |),
                                                [
                                                  fun γ =>
                                                    ltac:(M.monadic
                                                      (let γ0_0 :=
                                                        M.SubPointer.get_tuple_field (| γ, 0 |) in
                                                      let γ0_1 :=
                                                        M.SubPointer.get_tuple_field (| γ, 1 |) in
                                                      let left_val :=
                                                        M.copy (|
                                                          Ty.apply
                                                            (Ty.path "&")
                                                            []
                                                            [ Ty.path "usize" ],
                                                          γ0_0
                                                        |) in
                                                      let right_val :=
                                                        M.copy (|
                                                          Ty.apply
                                                            (Ty.path "&")
                                                            []
                                                            [ Ty.path "usize" ],
                                                          γ0_1
                                                        |) in
                                                      M.match_operator (|
                                                        Ty.tuple [],
                                                        M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                                        [
                                                          fun γ =>
                                                            ltac:(M.monadic
                                                              (let γ :=
                                                                M.use
                                                                  (M.alloc (|
                                                                    Ty.path "bool",
                                                                    M.call_closure (|
                                                                      Ty.path "bool",
                                                                      UnOp.not,
                                                                      [
                                                                        M.call_closure (|
                                                                          Ty.path "bool",
                                                                          BinOp.eq,
                                                                          [
                                                                            M.read (|
                                                                              M.deref (|
                                                                                M.read (|
                                                                                  left_val
                                                                                |)
                                                                              |)
                                                                            |);
                                                                            M.read (|
                                                                              M.deref (|
                                                                                M.read (|
                                                                                  right_val
                                                                                |)
                                                                              |)
                                                                            |)
                                                                          ]
                                                                        |)
                                                                      ]
                                                                    |)
                                                                  |)) in
                                                              let _ :=
                                                                is_constant_or_break_match (|
                                                                  M.read (| γ |),
                                                                  Value.Bool true
                                                                |) in
                                                              M.never_to_any (|
                                                                M.read (|
                                                                  let~ kind :
                                                                      Ty.path
                                                                        "core::panicking::AssertKind" :=
                                                                    Value.StructTuple
                                                                      "core::panicking::AssertKind::Eq"
                                                                      []
                                                                      []
                                                                      [] in
                                                                  M.alloc (|
                                                                    Ty.path "never",
                                                                    M.call_closure (|
                                                                      Ty.path "never",
                                                                      M.get_function (|
                                                                        "core::panicking::assert_failed",
                                                                        [],
                                                                        [
                                                                          Ty.path "usize";
                                                                          Ty.path "usize"
                                                                        ]
                                                                      |),
                                                                      [
                                                                        M.read (| kind |);
                                                                        M.borrow (|
                                                                          Pointer.Kind.Ref,
                                                                          M.deref (|
                                                                            M.borrow (|
                                                                              Pointer.Kind.Ref,
                                                                              M.deref (|
                                                                                M.read (|
                                                                                  left_val
                                                                                |)
                                                                              |)
                                                                            |)
                                                                          |)
                                                                        |);
                                                                        M.borrow (|
                                                                          Pointer.Kind.Ref,
                                                                          M.deref (|
                                                                            M.borrow (|
                                                                              Pointer.Kind.Ref,
                                                                              M.deref (|
                                                                                M.read (|
                                                                                  right_val
                                                                                |)
                                                                              |)
                                                                            |)
                                                                          |)
                                                                        |);
                                                                        Value.StructTuple
                                                                          "core::option::Option::None"
                                                                          []
                                                                          [
                                                                            Ty.path
                                                                              "core::fmt::Arguments"
                                                                          ]
                                                                          []
                                                                      ]
                                                                    |)
                                                                  |)
                                                                |)
                                                              |)));
                                                          fun γ => ltac:(M.monadic (Value.Tuple []))
                                                        ]
                                                      |)))
                                                ]
                                              |) in
                                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                          |)));
                                      fun γ => ltac:(M.monadic (Value.Tuple []))
                                    ]
                                  |) in
                                M.alloc (| Ty.path "bool", Value.Bool true |)
                              |)));
                          fun γ => ltac:(M.monadic (Value.Bool false))
                        ]
                      |)))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_eq :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V Type_) "eq" (eq BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque eq.
      End Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_Type_.
      
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ].
        
        (*
            fn into_leaf(self) -> &'a LeafNode<K, V> {
                let ptr = Self::as_leaf_ptr(&self);
                // SAFETY: there can be no mutable references into this tree borrowed as `Immut`.
                unsafe { &*ptr }
            }
        *)
        Definition into_leaf
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ],
                  self
                |) in
              M.read (|
                let~ ptr :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ],
                      "as_leaf_ptr",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (| M.borrow (| Pointer.Kind.Ref, self |) |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                  M.borrow (|
                    Pointer.Kind.Ref,
                    M.deref (| M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| ptr |) |) |) |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_leaf :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "into_leaf" (into_leaf K V Type_).
        Admitted.
        Global Typeclasses Opaque into_leaf.
        
        (*
            pub fn keys(&self) -> &[K] {
                let leaf = self.into_leaf();
                unsafe {
                    MaybeUninit::slice_assume_init_ref(leaf.keys.get_unchecked(..usize::from(leaf.len)))
                }
            }
        *)
        Definition keys
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ]
                    ],
                  self
                |) in
              M.read (|
                let~ leaf :
                    Ty.apply
                      (Ty.path "&")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; Type_ ],
                      "into_leaf",
                      [],
                      []
                    |),
                    [ M.read (| M.deref (| M.read (| self |) |) |) ]
                  |) in
                M.alloc (|
                  Ty.apply (Ty.path "&") [] [ Ty.apply (Ty.path "slice") [] [ K ] ],
                  M.borrow (|
                    Pointer.Kind.Ref,
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&") [] [ Ty.apply (Ty.path "slice") [] [ K ] ],
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                          "slice_assume_init_ref",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "slice")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ K ]
                                    ],
                                  "get_unchecked",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ]
                                  ]
                                |),
                                [
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ K ]
                                          ]
                                      ],
                                    M.pointer_coercion
                                      M.PointerCoercion.Unsize
                                      (Ty.apply
                                        (Ty.path "&")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "array")
                                            [ Value.Integer IntegerKind.Usize 11 ]
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ K ]
                                            ]
                                        ])
                                      (Ty.apply
                                        (Ty.path "&")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ K ]
                                            ]
                                        ]),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.Ref,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (| M.read (| leaf |) |),
                                          "alloc::collections::btree::node::LeafNode",
                                          "keys"
                                        |)
                                      |)
                                    ]
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          M.get_trait_method (|
                                            "core::convert::From",
                                            Ty.path "usize",
                                            [],
                                            [ Ty.path "u16" ],
                                            "from",
                                            [],
                                            []
                                          |),
                                          [
                                            M.read (|
                                              M.SubPointer.get_struct_record_field (|
                                                M.deref (| M.read (| leaf |) |),
                                                "alloc::collections::btree::node::LeafNode",
                                                "len"
                                              |)
                                            |)
                                          ]
                                        |))
                                    ]
                                ]
                              |)
                            |)
                          |)
                        ]
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_keys :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "keys" (keys K V Type_).
        Admitted.
        Global Typeclasses Opaque keys.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_Type_.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Dying";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
            ].
        
        (*
            pub unsafe fn deallocate_and_ascend<A: Allocator + Clone>(
                self,
                alloc: A,
            ) -> Option<Handle<NodeRef<marker::Dying, K, V, marker::Internal>, marker::Edge>> {
                let height = self.height;
                let node = self.node;
                let ret = self.ascend().ok();
                unsafe {
                    alloc.deallocate(
                        node.cast(),
                        if height > 0 {
                            Layout::new::<InternalNode<K, V>>()
                        } else {
                            Layout::new::<LeafNode<K, V>>()
                        },
                    );
                }
                ret
            }
        *)
        Definition deallocate_and_ascend
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Dying";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ height : Ty.path "usize" :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::NodeRef",
                      "height"
                    |)
                  |) in
                let~ node :
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::NodeRef",
                      "node"
                    |)
                  |) in
                let~ ret :
                    Ty.apply
                      (Ty.path "core::option::Option")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Dying";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::option::Option")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Dying";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::result::Result")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Dying";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Dying";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ]
                        ],
                      "ok",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "core::result::Result")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Dying";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::Edge"
                              ];
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Dying";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Dying";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "ascend",
                          [],
                          []
                        |),
                        [ M.read (| self |) ]
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.read (|
                    let~ _ : Ty.tuple [] :=
                      M.call_closure (|
                        Ty.tuple [],
                        M.get_trait_method (|
                          "core::alloc::Allocator",
                          A,
                          [],
                          [],
                          "deallocate",
                          [],
                          []
                        |),
                        [
                          M.borrow (| Pointer.Kind.Ref, alloc |);
                          M.call_closure (|
                            Ty.apply (Ty.path "core::ptr::non_null::NonNull") [] [ Ty.path "u8" ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "core::ptr::non_null::NonNull")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeafNode")
                                    []
                                    [ K; V ]
                                ],
                              "cast",
                              [],
                              [ Ty.path "u8" ]
                            |),
                            [ M.read (| node |) ]
                          |);
                          M.match_operator (|
                            Ty.path "core::alloc::layout::Layout",
                            M.alloc (| Ty.tuple [], Value.Tuple [] |),
                            [
                              fun γ =>
                                ltac:(M.monadic
                                  (let γ :=
                                    M.use
                                      (M.alloc (|
                                        Ty.path "bool",
                                        M.call_closure (|
                                          Ty.path "bool",
                                          BinOp.gt,
                                          [ M.read (| height |); Value.Integer IntegerKind.Usize 0 ]
                                        |)
                                      |)) in
                                  let _ :=
                                    is_constant_or_break_match (|
                                      M.read (| γ |),
                                      Value.Bool true
                                    |) in
                                  M.call_closure (|
                                    Ty.path "core::alloc::layout::Layout",
                                    M.get_associated_function (|
                                      Ty.path "core::alloc::layout::Layout",
                                      "new",
                                      [],
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::InternalNode")
                                          []
                                          [ K; V ]
                                      ]
                                    |),
                                    []
                                  |)));
                              fun γ =>
                                ltac:(M.monadic
                                  (M.call_closure (|
                                    Ty.path "core::alloc::layout::Layout",
                                    M.get_associated_function (|
                                      Ty.path "core::alloc::layout::Layout",
                                      "new",
                                      [],
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                    |),
                                    []
                                  |)))
                            ]
                          |)
                        ]
                      |) in
                    M.alloc (| Ty.tuple [], Value.Tuple [] |)
                  |) in
                ret
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_deallocate_and_ascend :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "deallocate_and_ascend" (deallocate_and_ascend K V).
        Admitted.
        Global Typeclasses Opaque deallocate_and_ascend.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ].
        
        (*
            unsafe fn reborrow_mut(&mut self) -> NodeRef<marker::Mut<'_>, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition reborrow_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [ Ty.tuple [ Ty.path "alloc::collections::btree::node::marker::Mut"; Type_ ] ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_reborrow_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "reborrow_mut" (reborrow_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque reborrow_mut.
        
        (*
            fn as_leaf_mut(&mut self) -> &mut LeafNode<K, V> {
                let ptr = Self::as_leaf_ptr(self);
                // SAFETY: we have exclusive access to the entire node.
                unsafe { &mut *ptr }
            }
        *)
        Definition as_leaf_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.read (|
                    let~ ptr :
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ] :=
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ],
                          "as_leaf_ptr",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                      |) in
                    M.alloc (|
                      Ty.apply
                        (Ty.path "&mut")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ],
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| ptr |) |) |)
                            |)
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_as_leaf_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "as_leaf_mut" (as_leaf_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque as_leaf_mut.
        
        (*
            fn into_leaf_mut(mut self) -> &'a mut LeafNode<K, V> {
                let ptr = Self::as_leaf_ptr(&mut self);
                // SAFETY: we have exclusive access to the entire node.
                unsafe { &mut *ptr }
            }
        *)
        Definition into_leaf_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.read (|
                    let~ ptr :
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ] :=
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ],
                          "as_leaf_ptr",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (| M.borrow (| Pointer.Kind.MutRef, self |) |)
                          |)
                        ]
                      |) in
                    M.alloc (|
                      Ty.apply
                        (Ty.path "&mut")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ],
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| ptr |) |) |)
                            |)
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_leaf_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "into_leaf_mut" (into_leaf_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque into_leaf_mut.
        
        (*
            pub fn dormant(&self) -> NodeRef<marker::DormantMut, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition dormant
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [
                        Ty.tuple
                          [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; Type_ ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_dormant :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "dormant" (dormant K V Type_).
        Admitted.
        Global Typeclasses Opaque dormant.
        (*
            unsafe fn key_area_mut<I, Output: ?Sized>(&mut self, index: I) -> &mut Output
            where
                I: SliceIndex<[MaybeUninit<K>], Output = Output>,
            {
                // SAFETY: the caller will not be able to call further methods on self
                // until the key slice reference is dropped, as we have unique access
                // for the lifetime of the borrow.
                unsafe { self.as_leaf_mut().keys.as_mut_slice().get_unchecked_mut(index) }
            }
        *)
        Definition key_area_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [ _ as I; Output ], [ self; index ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              let index := M.alloc (| I, index |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply (Ty.path "&mut") [] [ Output ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ I ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ K ]
                                          ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ],
                                      "as_mut_slice",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (|
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::LeafNode")
                                                    []
                                                    [ K; V ]
                                                ],
                                              M.get_associated_function (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Type_
                                                  ],
                                                "as_leaf_mut",
                                                [],
                                                []
                                              |),
                                              [
                                                M.borrow (|
                                                  Pointer.Kind.MutRef,
                                                  M.deref (| M.read (| self |) |)
                                                |)
                                              ]
                                            |)
                                          |),
                                          "alloc::collections::btree::node::LeafNode",
                                          "keys"
                                        |)
                                      |)
                                    ]
                                  |)
                                |)
                              |);
                              M.read (| index |)
                            ]
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_key_area_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "key_area_mut" (key_area_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque key_area_mut.
        
        (*
            unsafe fn val_area_mut<I, Output: ?Sized>(&mut self, index: I) -> &mut Output
            where
                I: SliceIndex<[MaybeUninit<V>], Output = Output>,
            {
                // SAFETY: the caller will not be able to call further methods on self
                // until the value slice reference is dropped, as we have unique access
                // for the lifetime of the borrow.
                unsafe { self.as_leaf_mut().vals.as_mut_slice().get_unchecked_mut(index) }
            }
        *)
        Definition val_area_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [ _ as I; Output ], [ self; index ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              let index := M.alloc (| I, index |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply (Ty.path "&mut") [] [ Output ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ I ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ V ]
                                          ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ],
                                      "as_mut_slice",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (|
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::LeafNode")
                                                    []
                                                    [ K; V ]
                                                ],
                                              M.get_associated_function (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Type_
                                                  ],
                                                "as_leaf_mut",
                                                [],
                                                []
                                              |),
                                              [
                                                M.borrow (|
                                                  Pointer.Kind.MutRef,
                                                  M.deref (| M.read (| self |) |)
                                                |)
                                              ]
                                            |)
                                          |),
                                          "alloc::collections::btree::node::LeafNode",
                                          "vals"
                                        |)
                                      |)
                                    ]
                                  |)
                                |)
                              |);
                              M.read (| index |)
                            ]
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_val_area_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "val_area_mut" (val_area_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque val_area_mut.
        (*
            pub fn len_mut(&mut self) -> &mut u16 {
                &mut self.as_leaf_mut().len
            }
        *)
        Definition len_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (|
                            M.call_closure (|
                              Ty.apply
                                (Ty.path "&mut")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeafNode")
                                    []
                                    [ K; V ]
                                ],
                              M.get_associated_function (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Type_
                                  ],
                                "as_leaf_mut",
                                [],
                                []
                              |),
                              [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |)
                              ]
                            |)
                          |),
                          "alloc::collections::btree::node::LeafNode",
                          "len"
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_len_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "len_mut" (len_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque len_mut.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_Type_.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_DormantMut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; K; V; Type_ ].
        
        (*
            pub unsafe fn awaken<'a>(self) -> NodeRef<marker::Mut<'a>, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition awaken
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; K; V; Type_ ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [ Ty.tuple [ Ty.path "alloc::collections::btree::node::marker::Mut"; Type_ ] ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_awaken :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "awaken" (awaken K V Type_).
        Admitted.
        Global Typeclasses Opaque awaken.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_DormantMut_K_V_Type_.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; Type_ ].
        
        (*
            fn as_leaf_dying(&mut self) -> &mut LeafNode<K, V> {
                let ptr = Self::as_leaf_ptr(self);
                // SAFETY: we have exclusive access to the entire node.
                unsafe { &mut *ptr }
            }
        *)
        Definition as_leaf_dying
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; Type_ ]
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.read (|
                    let~ ptr :
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ] :=
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; Type_
                            ],
                          "as_leaf_ptr",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                      |) in
                    M.alloc (|
                      Ty.apply
                        (Ty.path "&mut")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ],
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| ptr |) |) |)
                            |)
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_as_leaf_dying :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "as_leaf_dying" (as_leaf_dying K V Type_).
        Admitted.
        Global Typeclasses Opaque as_leaf_dying.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_Type_.
      
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; Type_ ].
        
        (*
            unsafe fn into_key_val_mut_at(mut self, idx: usize) -> (&'a K, &'a mut V) {
                // We only create a reference to the one element we are interested in,
                // to avoid aliasing with outstanding references to other elements,
                // in particular, those returned to the caller in earlier iterations.
                let leaf = Self::as_leaf_ptr(&mut self);
                let keys = unsafe { &raw const ( *leaf).keys };
                let vals = unsafe { &raw mut ( *leaf).vals };
                // We must coerce to unsized array pointers because of Rust issue #74679.
                let keys: *const [_] = keys;
                let vals: *mut [_] = vals;
                let key = unsafe { (&*keys.get_unchecked(idx)).assume_init_ref() };
                let val = unsafe { (&mut *vals.get_unchecked_mut(idx)).assume_init_mut() };
                (key, val)
            }
        *)
        Definition into_key_val_mut_at
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self; idx ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; Type_ ],
                  self
                |) in
              let idx := M.alloc (| Ty.path "usize", idx |) in
              M.read (|
                let~ leaf :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; Type_ ],
                      "as_leaf_ptr",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (| M.borrow (| Pointer.Kind.MutRef, self |) |)
                      |)
                    ]
                  |) in
                let~ keys :
                    Ty.apply
                      (Ty.path "*const")
                      []
                      [
                        Ty.apply
                          (Ty.path "array")
                          [ Value.Integer IntegerKind.Usize 11 ]
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.ConstPointer,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| leaf |) |),
                      "alloc::collections::btree::node::LeafNode",
                      "keys"
                    |)
                  |) in
                let~ vals :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "array")
                          [ Value.Integer IntegerKind.Usize 11 ]
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutPointer,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| leaf |) |),
                      "alloc::collections::btree::node::LeafNode",
                      "vals"
                    |)
                  |) in
                let~ keys :
                    Ty.apply
                      (Ty.path "*const")
                      []
                      [
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*const")
                      []
                      [
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                      ],
                    M.pointer_coercion
                      M.PointerCoercion.Unsize
                      (Ty.apply
                        (Ty.path "*const")
                        []
                        [
                          Ty.apply
                            (Ty.path "array")
                            [ Value.Integer IntegerKind.Usize 11 ]
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                        ])
                      (Ty.apply
                        (Ty.path "*const")
                        []
                        [
                          Ty.apply
                            (Ty.path "slice")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                        ]),
                    [ M.read (| keys |) ]
                  |) in
                let~ vals :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                      ],
                    M.pointer_coercion
                      M.PointerCoercion.Unsize
                      (Ty.apply
                        (Ty.path "*mut")
                        []
                        [
                          Ty.apply
                            (Ty.path "array")
                            [ Value.Integer IntegerKind.Usize 11 ]
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                        ])
                      (Ty.apply
                        (Ty.path "*mut")
                        []
                        [
                          Ty.apply
                            (Ty.path "slice")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                        ]),
                    [ M.read (| vals |) ]
                  |) in
                let~ key : Ty.apply (Ty.path "&") [] [ K ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&") [] [ K ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_ref",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "*const")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "*const")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ],
                                  "get_unchecked",
                                  [],
                                  [ Ty.path "usize" ]
                                |),
                                [ M.read (| keys |); M.read (| idx |) ]
                              |)
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ val : Ty.apply (Ty.path "&mut") [] [ V ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ V ],
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                          "assume_init_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "*mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "*mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ V ]
                                            ]
                                        ],
                                      "get_unchecked_mut",
                                      [],
                                      [ Ty.path "usize" ]
                                    |),
                                    [ M.read (| vals |); M.read (| idx |) ]
                                  |)
                                |)
                              |)
                            |)
                          |)
                        ]
                      |)
                    |)
                  |) in
                M.alloc (|
                  Ty.tuple [ Ty.apply (Ty.path "&") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                  Value.Tuple
                    [
                      M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| key |) |) |);
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| val |) |) |)
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_key_val_mut_at :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V Type_)
            "into_key_val_mut_at"
            (into_key_val_mut_at K V Type_).
        Admitted.
        Global Typeclasses Opaque into_key_val_mut_at.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_Type_.
      
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Mut";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
            ].
        
        (*
            fn set_parent_link(&mut self, parent: NonNull<InternalNode<K, V>>, parent_idx: usize) {
                let leaf = Self::as_leaf_ptr(self);
                unsafe { ( *leaf).parent = Some(parent) };
                unsafe { ( *leaf).parent_idx.write(parent_idx as u16) };
            }
        *)
        Definition set_parent_link
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; parent; parent_idx ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  self
                |) in
              let parent :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "core::ptr::non_null::NonNull")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::InternalNode") [] [ K; V ]
                    ],
                  parent
                |) in
              let parent_idx := M.alloc (| Ty.path "usize", parent_idx |) in
              M.read (|
                let~ leaf :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "as_leaf_ptr",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| leaf |) |),
                      "alloc::collections::btree::node::LeafNode",
                      "parent"
                    |),
                    Value.StructTuple
                      "core::option::Option::Some"
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ]
                      ]
                      [ M.read (| parent |) ]
                  |) in
                let~ _ : Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                        []
                        [ Ty.path "u16" ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| leaf |) |),
                          "alloc::collections::btree::node::LeafNode",
                          "parent_idx"
                        |)
                      |);
                      M.cast (Ty.path "u16") (M.read (| parent_idx |))
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_set_parent_link :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "set_parent_link" (set_parent_link K V).
        Admitted.
        Global Typeclasses Opaque set_parent_link.
        (*
            pub unsafe fn cast_to_leaf_unchecked(self) -> NodeRef<marker::Mut<'a>, K, V, marker::Leaf> {
                debug_assert!(self.height == 0);
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition cast_to_leaf_unchecked
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.eq,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::NodeRef",
                                                        "height"
                                                      |)
                                                    |);
                                                    Value.Integer IntegerKind.Usize 0
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: self.height == 0" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                    ]
                    [
                      ("height",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::NodeRef",
                            "height"
                          |)
                        |));
                      ("node",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::NodeRef",
                            "node"
                          |)
                        |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                Ty.path "alloc::collections::btree::node::marker::Leaf"
                              ]
                          ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_cast_to_leaf_unchecked :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "cast_to_leaf_unchecked" (cast_to_leaf_unchecked K V).
        Admitted.
        Global Typeclasses Opaque cast_to_leaf_unchecked.
        
        (*
            unsafe fn cast_to_internal_unchecked(self) -> NodeRef<marker::Mut<'a>, K, V, marker::Internal> {
                debug_assert!(self.height > 0);
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition cast_to_internal_unchecked
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.gt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::NodeRef",
                                                        "height"
                                                      |)
                                                    |);
                                                    Value.Integer IntegerKind.Usize 0
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: self.height > 0" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ]
                    [
                      ("height",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::NodeRef",
                            "height"
                          |)
                        |));
                      ("node",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::NodeRef",
                            "node"
                          |)
                        |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ]
                          ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_cast_to_internal_unchecked :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V)
            "cast_to_internal_unchecked"
            (cast_to_internal_unchecked K V).
        Admitted.
        Global Typeclasses Opaque cast_to_internal_unchecked.
        (*
            pub fn choose_parent_kv(self) -> Result<LeftOrRight<BalancingContext<'a, K, V>>, Self> {
                match unsafe { ptr::read(&self) }.ascend() {
                    Ok(parent_edge) => match parent_edge.left_kv() {
                        Ok(left_parent_kv) => Ok(LeftOrRight::Left(BalancingContext {
                            parent: unsafe { ptr::read(&left_parent_kv) },
                            left_child: left_parent_kv.left_edge().descend(),
                            right_child: self,
                        })),
                        Err(parent_edge) => match parent_edge.right_kv() {
                            Ok(right_parent_kv) => Ok(LeftOrRight::Right(BalancingContext {
                                parent: unsafe { ptr::read(&right_parent_kv) },
                                left_child: self,
                                right_child: right_parent_kv.right_edge().descend(),
                            })),
                            Err(_) => unreachable!("empty internal node"),
                        },
                    },
                    Err(root) => Err(root),
                }
            }
        *)
        Definition choose_parent_kv
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  self
                |) in
              M.match_operator (|
                Ty.apply
                  (Ty.path "core::result::Result")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::LeftOrRight")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::BalancingContext")
                          []
                          [ K; V ]
                      ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ]
                  ],
                M.alloc (|
                  Ty.apply
                    (Ty.path "core::result::Result")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ];
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::result::Result")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ];
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "ascend",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ],
                        M.get_function (|
                          "core::ptr::read",
                          [],
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ]
                          ]
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.ConstPointer,
                            M.deref (| M.borrow (| Pointer.Kind.Ref, self |) |)
                          |)
                        ]
                      |)
                    ]
                  |)
                |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 :=
                        M.SubPointer.get_struct_tuple_field (|
                          γ,
                          "core::result::Result::Ok",
                          0
                        |) in
                      let parent_edge :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ],
                          γ0_0
                        |) in
                      M.match_operator (|
                        Ty.apply
                          (Ty.path "core::result::Result")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeftOrRight")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::BalancingContext")
                                  []
                                  [ K; V ]
                              ];
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ]
                          ],
                        M.alloc (|
                          Ty.apply
                            (Ty.path "core::result::Result")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ]
                            ],
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "core::result::Result")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::KV"
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::Edge"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ],
                              "left_kv",
                              [],
                              []
                            |),
                            [ M.read (| parent_edge |) ]
                          |)
                        |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 :=
                                M.SubPointer.get_struct_tuple_field (|
                                  γ,
                                  "core::result::Result::Ok",
                                  0
                                |) in
                              let left_parent_kv :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::Internal"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::KV"
                                    ],
                                  γ0_0
                                |) in
                              Value.StructTuple
                                "core::result::Result::Ok"
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path
                                          "alloc::collections::btree::node::BalancingContext")
                                        []
                                        [ K; V ]
                                    ];
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ]
                                ]
                                [
                                  Value.StructTuple
                                    "alloc::collections::btree::node::LeftOrRight::Left"
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path
                                          "alloc::collections::btree::node::BalancingContext")
                                        []
                                        [ K; V ]
                                    ]
                                    [
                                      Value.mkStructRecord
                                        "alloc::collections::btree::node::BalancingContext"
                                        []
                                        [ K; V ]
                                        [
                                          ("parent",
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::Handle")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Internal"
                                                    ];
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::KV"
                                                ],
                                              M.get_function (|
                                                "core::ptr::read",
                                                [],
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::Handle")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ];
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::KV"
                                                    ]
                                                ]
                                              |),
                                              [
                                                M.borrow (|
                                                  Pointer.Kind.ConstPointer,
                                                  M.deref (|
                                                    M.borrow (| Pointer.Kind.Ref, left_parent_kv |)
                                                  |)
                                                |)
                                              ]
                                            |));
                                          ("left_child",
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              M.get_associated_function (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::Handle")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ];
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Edge"
                                                  ],
                                                "descend",
                                                [],
                                                []
                                              |),
                                              [
                                                M.call_closure (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::Handle")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ];
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Edge"
                                                    ],
                                                  M.get_associated_function (|
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::Handle")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Internal"
                                                          ];
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::KV"
                                                      ],
                                                    "left_edge",
                                                    [],
                                                    []
                                                  |),
                                                  [ M.read (| left_parent_kv |) ]
                                                |)
                                              ]
                                            |));
                                          ("right_child", M.read (| self |))
                                        ]
                                    ]
                                ]));
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 :=
                                M.SubPointer.get_struct_tuple_field (|
                                  γ,
                                  "core::result::Result::Err",
                                  0
                                |) in
                              let parent_edge :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::Internal"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::Edge"
                                    ],
                                  γ0_0
                                |) in
                              M.match_operator (|
                                Ty.apply
                                  (Ty.path "core::result::Result")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path
                                            "alloc::collections::btree::node::BalancingContext")
                                          []
                                          [ K; V ]
                                      ];
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path
                                          "alloc::collections::btree::node::marker::LeafOrInternal"
                                      ]
                                  ],
                                M.alloc (|
                                  Ty.apply
                                    (Ty.path "core::result::Result")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ];
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::Edge"
                                        ]
                                    ],
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "core::result::Result")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::KV"
                                          ];
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::Edge"
                                          ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::Edge"
                                        ],
                                      "right_kv",
                                      [],
                                      []
                                    |),
                                    [ M.read (| parent_edge |) ]
                                  |)
                                |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ0_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ,
                                          "core::result::Result::Ok",
                                          0
                                        |) in
                                      let right_parent_kv :=
                                        M.copy (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::Handle")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ];
                                              Ty.path "alloc::collections::btree::node::marker::KV"
                                            ],
                                          γ0_0
                                        |) in
                                      Value.StructTuple
                                        "core::result::Result::Ok"
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path
                                                  "alloc::collections::btree::node::BalancingContext")
                                                []
                                                [ K; V ]
                                            ];
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ]
                                        ]
                                        [
                                          Value.StructTuple
                                            "alloc::collections::btree::node::LeftOrRight::Right"
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path
                                                  "alloc::collections::btree::node::BalancingContext")
                                                []
                                                [ K; V ]
                                            ]
                                            [
                                              Value.mkStructRecord
                                                "alloc::collections::btree::node::BalancingContext"
                                                []
                                                [ K; V ]
                                                [
                                                  ("parent",
                                                    M.call_closure (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::Handle")
                                                        []
                                                        [
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::NodeRef")
                                                            []
                                                            [
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Mut";
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ];
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::KV"
                                                        ],
                                                      M.get_function (|
                                                        "core::ptr::read",
                                                        [],
                                                        [
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::Handle")
                                                            []
                                                            [
                                                              Ty.apply
                                                                (Ty.path
                                                                  "alloc::collections::btree::node::NodeRef")
                                                                []
                                                                [
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::Mut";
                                                                  K;
                                                                  V;
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::Internal"
                                                                ];
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::KV"
                                                            ]
                                                        ]
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.ConstPointer,
                                                          M.deref (|
                                                            M.borrow (|
                                                              Pointer.Kind.Ref,
                                                              right_parent_kv
                                                            |)
                                                          |)
                                                        |)
                                                      ]
                                                    |));
                                                  ("left_child", M.read (| self |));
                                                  ("right_child",
                                                    M.call_closure (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::LeafOrInternal"
                                                        ],
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::Handle")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::NodeRef")
                                                              []
                                                              [
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Mut";
                                                                K;
                                                                V;
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Internal"
                                                              ];
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Edge"
                                                          ],
                                                        "descend",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.call_closure (|
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::Handle")
                                                            []
                                                            [
                                                              Ty.apply
                                                                (Ty.path
                                                                  "alloc::collections::btree::node::NodeRef")
                                                                []
                                                                [
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::Mut";
                                                                  K;
                                                                  V;
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::Internal"
                                                                ];
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Edge"
                                                            ],
                                                          M.get_associated_function (|
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::Handle")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "alloc::collections::btree::node::NodeRef")
                                                                  []
                                                                  [
                                                                    Ty.path
                                                                      "alloc::collections::btree::node::marker::Mut";
                                                                    K;
                                                                    V;
                                                                    Ty.path
                                                                      "alloc::collections::btree::node::marker::Internal"
                                                                  ];
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::KV"
                                                              ],
                                                            "right_edge",
                                                            [],
                                                            []
                                                          |),
                                                          [ M.read (| right_parent_kv |) ]
                                                        |)
                                                      ]
                                                    |))
                                                ]
                                            ]
                                        ]));
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ0_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ,
                                          "core::result::Result::Err",
                                          0
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic_fmt", [], [] |),
                                          [
                                            M.call_closure (|
                                              Ty.path "core::fmt::Arguments",
                                              M.get_associated_function (|
                                                Ty.path "core::fmt::Arguments",
                                                "new_v1",
                                                [
                                                  Value.Integer IntegerKind.Usize 1;
                                                  Value.Integer IntegerKind.Usize 0
                                                ],
                                                []
                                              |),
                                              [
                                                M.borrow (|
                                                  Pointer.Kind.Ref,
                                                  M.deref (|
                                                    M.borrow (|
                                                      Pointer.Kind.Ref,
                                                      M.alloc (|
                                                        Ty.apply
                                                          (Ty.path "array")
                                                          [ Value.Integer IntegerKind.Usize 1 ]
                                                          [
                                                            Ty.apply
                                                              (Ty.path "&")
                                                              []
                                                              [ Ty.path "str" ]
                                                          ],
                                                        Value.Array
                                                          [
                                                            mk_str (|
                                                              "internal error: entered unreachable code: empty internal node"
                                                            |)
                                                          ]
                                                      |)
                                                    |)
                                                  |)
                                                |);
                                                M.borrow (|
                                                  Pointer.Kind.Ref,
                                                  M.deref (|
                                                    M.borrow (|
                                                      Pointer.Kind.Ref,
                                                      M.alloc (|
                                                        Ty.apply
                                                          (Ty.path "array")
                                                          [ Value.Integer IntegerKind.Usize 0 ]
                                                          [ Ty.path "core::fmt::rt::Argument" ],
                                                        M.call_closure (|
                                                          Ty.apply
                                                            (Ty.path "array")
                                                            [ Value.Integer IntegerKind.Usize 0 ]
                                                            [ Ty.path "core::fmt::rt::Argument" ],
                                                          M.get_associated_function (|
                                                            Ty.path "core::fmt::rt::Argument",
                                                            "none",
                                                            [],
                                                            []
                                                          |),
                                                          []
                                                        |)
                                                      |)
                                                    |)
                                                  |)
                                                |)
                                              ]
                                            |)
                                          ]
                                        |)
                                      |)))
                                ]
                              |)))
                        ]
                      |)));
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 :=
                        M.SubPointer.get_struct_tuple_field (|
                          γ,
                          "core::result::Result::Err",
                          0
                        |) in
                      let root :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          γ0_0
                        |) in
                      Value.StructTuple
                        "core::result::Result::Err"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::LeftOrRight")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::BalancingContext")
                                []
                                [ K; V ]
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ]
                        ]
                        [ M.read (| root |) ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_choose_parent_kv :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "choose_parent_kv" (choose_parent_kv K V).
        Admitted.
        Global Typeclasses Opaque choose_parent_kv.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Owned";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
            ].
        
        (*
            fn clear_parent_link(&mut self) {
                let mut root_node = self.borrow_mut();
                let leaf = root_node.as_leaf_mut();
                leaf.parent = None;
            }
        *)
        Definition clear_parent_link
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  self
                |) in
              M.read (|
                let~ root_node :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "borrow_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "as_leaf_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, root_node |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| leaf |) |),
                      "alloc::collections::btree::node::LeafNode",
                      "parent"
                    |),
                    Value.StructTuple
                      "core::option::Option::None"
                      []
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ]
                      ]
                      []
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_clear_parent_link :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "clear_parent_link" (clear_parent_link K V).
        Admitted.
        Global Typeclasses Opaque clear_parent_link.
        (*
            pub fn new<A: Allocator + Clone>(alloc: A) -> Self {
                NodeRef::new_leaf(alloc).forget_type()
            }
        *)
        Definition new (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ alloc ] =>
            ltac:(M.monadic
              (let alloc := M.alloc (| A, alloc |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Owned";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                    ],
                  "forget_type",
                  [],
                  []
                |),
                [
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "new_leaf",
                      [],
                      [ A ]
                    |),
                    [ M.read (| alloc |) ]
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "new" (new K V).
        Admitted.
        Global Typeclasses Opaque new.
        
        (*
            pub fn push_internal_level<A: Allocator + Clone>(
                &mut self,
                alloc: A,
            ) -> NodeRef<marker::Mut<'_>, K, V, marker::Internal> {
                super::mem::take_mut(self, |old_root| NodeRef::new_internal(old_root, alloc).forget_type());
        
                // `self.borrow_mut()`, except that we just forgot we're internal now:
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition push_internal_level
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (|
                      "alloc::collections::btree::mem::take_mut",
                      [],
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Owned";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ];
                        Ty.function
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Owned";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ]
                          ]
                          (Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Owned";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ])
                      ]
                    |),
                    [
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                      M.closure
                        (fun γ =>
                          ltac:(M.monadic
                            match γ with
                            | [ α0 ] =>
                              ltac:(M.monadic
                                (M.match_operator (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Owned";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  M.alloc (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Owned";
                                        K;
                                        V;
                                        Ty.path
                                          "alloc::collections::btree::node::marker::LeafOrInternal"
                                      ],
                                    α0
                                  |),
                                  [
                                    fun γ =>
                                      ltac:(M.monadic
                                        (let old_root :=
                                          M.copy (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Owned";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::LeafOrInternal"
                                              ],
                                            γ
                                          |) in
                                        M.call_closure (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Owned";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          M.get_associated_function (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Owned";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ],
                                            "forget_type",
                                            [],
                                            []
                                          |),
                                          [
                                            M.call_closure (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Owned";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ],
                                              M.get_associated_function (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Owned";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Internal"
                                                  ],
                                                "new_internal",
                                                [],
                                                [ A ]
                                              |),
                                              [ M.read (| old_root |); M.read (| alloc |) ]
                                            |)
                                          ]
                                        |)))
                                  ]
                                |)))
                            | _ => M.impossible "wrong number of arguments"
                            end))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::Internal"
                    ]
                    [
                      ("height",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| self |) |),
                            "alloc::collections::btree::node::NodeRef",
                            "height"
                          |)
                        |));
                      ("node",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| self |) |),
                            "alloc::collections::btree::node::NodeRef",
                            "node"
                          |)
                        |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ]
                          ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_push_internal_level :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "push_internal_level" (push_internal_level K V).
        Admitted.
        Global Typeclasses Opaque push_internal_level.
        
        (*
            pub fn pop_internal_level<A: Allocator + Clone>(&mut self, alloc: A) {
                assert!(self.height > 0);
        
                let top = self.node;
        
                // SAFETY: we asserted to be internal.
                let internal_self = unsafe { self.borrow_mut().cast_to_internal_unchecked() };
                // SAFETY: we borrowed `self` exclusively and its borrow type is exclusive.
                let internal_node = unsafe { &mut *NodeRef::as_internal_ptr(&internal_self) };
                // SAFETY: the first edge is always initialized.
                self.node = unsafe { internal_node.edges[0].assume_init_read() };
                self.height -= 1;
                self.clear_parent_link();
        
                unsafe {
                    alloc.deallocate(top.cast(), Layout::new::<InternalNode<K, V>>());
                }
            }
        *)
        Definition pop_internal_level
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.gt,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            M.deref (| M.read (| self |) |),
                                            "alloc::collections::btree::node::NodeRef",
                                            "height"
                                          |)
                                        |);
                                        Value.Integer IntegerKind.Usize 0
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: self.height > 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ top :
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::NodeRef",
                      "node"
                    |)
                  |) in
                let~ internal_self :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "cast_to_internal_unchecked",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Owned";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "borrow_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                      |)
                    ]
                  |) in
                let~ internal_node :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "*mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::InternalNode")
                                  []
                                  [ K; V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "as_internal_ptr",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.Ref,
                                M.deref (| M.borrow (| Pointer.Kind.Ref, internal_self |) |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    |)
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::NodeRef",
                      "node"
                    |),
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "core::ptr::non_null::NonNull")
                        []
                        [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                          []
                          [
                            Ty.apply
                              (Ty.path "core::ptr::non_null::NonNull")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::LeafNode")
                                  []
                                  [ K; V ]
                              ]
                          ],
                        "assume_init_read",
                        [],
                        []
                      |),
                      [
                        M.borrow (|
                          Pointer.Kind.Ref,
                          M.SubPointer.get_array_field (|
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| internal_node |) |),
                              "alloc::collections::btree::node::InternalNode",
                              "edges"
                            |),
                            Value.Integer IntegerKind.Usize 0
                          |)
                        |)
                      ]
                    |)
                  |) in
                let~ _ : Ty.tuple [] :=
                  let β :=
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::NodeRef",
                      "height"
                    |) in
                  M.write (|
                    β,
                    M.call_closure (|
                      Ty.path "usize",
                      BinOp.Wrap.sub,
                      [ M.read (| β |); Value.Integer IntegerKind.Usize 1 ]
                    |)
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "clear_parent_link",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_trait_method (|
                      "core::alloc::Allocator",
                      A,
                      [],
                      [],
                      "deallocate",
                      [],
                      []
                    |),
                    [
                      M.borrow (| Pointer.Kind.Ref, alloc |);
                      M.call_closure (|
                        Ty.apply (Ty.path "core::ptr::non_null::NonNull") [] [ Ty.path "u8" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ],
                          "cast",
                          [],
                          [ Ty.path "u8" ]
                        |),
                        [ M.read (| top |) ]
                      |);
                      M.call_closure (|
                        Ty.path "core::alloc::layout::Layout",
                        M.get_associated_function (|
                          Ty.path "core::alloc::layout::Layout",
                          "new",
                          [],
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ]
                        |),
                        []
                      |)
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_pop_internal_level :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "pop_internal_level" (pop_internal_level K V).
        Admitted.
        Global Typeclasses Opaque pop_internal_level.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; Type_ ].
        
        (*
            pub fn borrow_mut(&mut self) -> NodeRef<marker::Mut<'_>, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition borrow_mut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; Type_ ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [ Ty.tuple [ Ty.path "alloc::collections::btree::node::marker::Mut"; Type_ ] ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_borrow_mut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "borrow_mut" (borrow_mut K V Type_).
        Admitted.
        Global Typeclasses Opaque borrow_mut.
        
        (*
            pub fn borrow_valmut(&mut self) -> NodeRef<marker::ValMut<'_>, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition borrow_valmut
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; Type_ ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [
                        Ty.tuple
                          [ Ty.path "alloc::collections::btree::node::marker::ValMut"; Type_ ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_borrow_valmut :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "borrow_valmut" (borrow_valmut K V Type_).
        Admitted.
        Global Typeclasses Opaque borrow_valmut.
        
        (*
            pub fn into_dying(self) -> NodeRef<marker::Dying, K, V, Type> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition into_dying
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; Type_ ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; Type_ ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [ Ty.tuple [ Ty.path "alloc::collections::btree::node::marker::Dying"; Type_ ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_dying :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self K V Type_) "into_dying" (into_dying K V Type_).
        Admitted.
        Global Typeclasses Opaque into_dying.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Owned_K_V_Type_.
      
      Module Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [
              Ty.path "alloc::collections::btree::node::marker::Mut";
              K;
              V;
              Ty.path "alloc::collections::btree::node::marker::Leaf"
            ].
        
        (*
            pub unsafe fn push_with_handle<'b>(
                &mut self,
                key: K,
                val: V,
            ) -> Handle<NodeRef<marker::Mut<'b>, K, V, marker::Leaf>, marker::KV> {
                let len = self.len_mut();
                let idx = usize::from( *len);
                assert!(idx < CAPACITY);
                *len += 1;
                unsafe {
                    self.key_area_mut(idx).write(key);
                    self.val_area_mut(idx).write(val);
                    Handle::new_kv(
                        NodeRef { height: self.height, node: self.node, _marker: PhantomData },
                        idx,
                    )
                }
            }
        *)
        Definition push_with_handle
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; key; val ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ]
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              M.read (|
                let~ len : Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "len_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                  |) in
                let~ idx : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_trait_method (|
                      "core::convert::From",
                      Ty.path "usize",
                      [],
                      [ Ty.path "u16" ],
                      "from",
                      [],
                      []
                    |),
                    [ M.read (| M.deref (| M.read (| len |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.lt,
                                      [
                                        M.read (| idx |);
                                        M.read (|
                                          get_constant (|
                                            "alloc::collections::btree::node::CAPACITY",
                                            Ty.path "usize"
                                          |)
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: idx < CAPACITY" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  let β := M.deref (| M.read (| len |) |) in
                  M.write (|
                    β,
                    M.call_closure (|
                      Ty.path "u16",
                      BinOp.Wrap.add,
                      [ M.read (| β |); Value.Integer IntegerKind.U16 1 ]
                    |)
                  |) in
                let~ _ : Ty.apply (Ty.path "&mut") [] [ K ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ K ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ]
                            |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                              M.read (| idx |)
                            ]
                          |)
                        |)
                      |);
                      M.read (| key |)
                    ]
                  |) in
                let~ _ : Ty.apply (Ty.path "&mut") [] [ V ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ V ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "write",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ]
                            |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                              M.read (| idx |)
                            ]
                          |)
                        |)
                      |);
                      M.read (| val |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "new_kv",
                      [],
                      []
                    |),
                    [
                      Value.mkStructRecord
                        "alloc::collections::btree::node::NodeRef"
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ]
                        [
                          ("height",
                            M.read (|
                              M.SubPointer.get_struct_record_field (|
                                M.deref (| M.read (| self |) |),
                                "alloc::collections::btree::node::NodeRef",
                                "height"
                              |)
                            |));
                          ("node",
                            M.read (|
                              M.SubPointer.get_struct_record_field (|
                                M.deref (| M.read (| self |) |),
                                "alloc::collections::btree::node::NodeRef",
                                "node"
                              |)
                            |));
                          ("_marker",
                            Value.StructTuple
                              "core::marker::PhantomData"
                              []
                              [
                                Ty.tuple
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ]
                              ]
                              [])
                        ];
                      M.read (| idx |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_push_with_handle :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "push_with_handle" (push_with_handle K V).
        Admitted.
        Global Typeclasses Opaque push_with_handle.
        
        (*
            pub fn push(&mut self, key: K, val: V) -> *mut V {
                // SAFETY: The unbound handle is no longer accessible.
                unsafe { self.push_with_handle(key, val).into_val_mut() }
            }
        *)
        Definition push (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; key; val ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ]
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              M.borrow (|
                Pointer.Kind.MutPointer,
                M.deref (|
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ V ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "into_val_mut",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Leaf"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::KV"
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ],
                          "push_with_handle",
                          [],
                          []
                        |),
                        [
                          M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |);
                          M.read (| key |);
                          M.read (| val |)
                        ]
                      |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_push :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "push" (push K V).
        Admitted.
        Global Typeclasses Opaque push.
      End Impl_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf.
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ].
        
        (*
            pub fn forget_type(self) -> NodeRef<BorrowType, K, V, marker::LeafOrInternal> {
                NodeRef { height: self.height, node: self.node, _marker: PhantomData }
            }
        *)
        Definition forget_type
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::NodeRef"
                []
                [
                  BorrowType;
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                ]
                [
                  ("height",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "height"
                      |)
                    |));
                  ("node",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::NodeRef",
                        "node"
                      |)
                    |));
                  ("_marker",
                    Value.StructTuple
                      "core::marker::PhantomData"
                      []
                      [
                        Ty.tuple
                          [
                            BorrowType;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ]
                      [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_type :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V) "forget_type" (forget_type BorrowType K V).
        Admitted.
        Global Typeclasses Opaque forget_type.
      End Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf.
      
      
      Module Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::NodeRef")
            []
            [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::LeafOrInternal" ].
        
        (*
            pub fn force(
                self,
            ) -> ForceResult<
                NodeRef<BorrowType, K, V, marker::Leaf>,
                NodeRef<BorrowType, K, V, marker::Internal>,
            > {
                if self.height == 0 {
                    ForceResult::Leaf(NodeRef {
                        height: self.height,
                        node: self.node,
                        _marker: PhantomData,
                    })
                } else {
                    ForceResult::Internal(NodeRef {
                        height: self.height,
                        node: self.node,
                        _marker: PhantomData,
                    })
                }
            }
        *)
        Definition force
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      BorrowType;
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  self
                |) in
              M.match_operator (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::ForceResult")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ]
                  ],
                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ :=
                        M.use
                          (M.alloc (|
                            Ty.path "bool",
                            M.call_closure (|
                              Ty.path "bool",
                              BinOp.eq,
                              [
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::NodeRef",
                                    "height"
                                  |)
                                |);
                                Value.Integer IntegerKind.Usize 0
                              ]
                            |)
                          |)) in
                      let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                      Value.StructTuple
                        "alloc::collections::btree::node::ForceResult::Leaf'1"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ]
                        ]
                        [
                          Value.mkStructRecord
                            "alloc::collections::btree::node::NodeRef"
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ]
                            [
                              ("height",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::NodeRef",
                                    "height"
                                  |)
                                |));
                              ("node",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::NodeRef",
                                    "node"
                                  |)
                                |));
                              ("_marker",
                                Value.StructTuple
                                  "core::marker::PhantomData"
                                  []
                                  [
                                    Ty.tuple
                                      [
                                        BorrowType;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ]
                                  ]
                                  [])
                            ]
                        ]));
                  fun γ =>
                    ltac:(M.monadic
                      (Value.StructTuple
                        "alloc::collections::btree::node::ForceResult::Internal'1"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ]
                        ]
                        [
                          Value.mkStructRecord
                            "alloc::collections::btree::node::NodeRef"
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ]
                            [
                              ("height",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::NodeRef",
                                    "height"
                                  |)
                                |));
                              ("node",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::NodeRef",
                                    "node"
                                  |)
                                |));
                              ("_marker",
                                Value.StructTuple
                                  "core::marker::PhantomData"
                                  []
                                  [
                                    Ty.tuple
                                      [
                                        BorrowType;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ]
                                  ]
                                  [])
                            ]
                        ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_force :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V) "force" (force BorrowType K V).
        Admitted.
        Global Typeclasses Opaque force.
      End Impl_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_LeafOrInternal.
      
      
      (* StructRecord
        {
          name := "Handle";
          const_params := [];
          ty_params := [ "Node"; "Type_" ];
          fields :=
            [
              ("node", Node);
              ("idx", Ty.path "usize");
              ("_marker", Ty.apply (Ty.path "core::marker::PhantomData") [] [ Type_ ])
            ];
        } *)
      
      Module Impl_core_marker_Copy_where_core_marker_Copy_Node_for_alloc_collections_btree_node_Handle_Node_Type_.
        Definition Self (Node Type_ : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::Handle") [] [ Node; Type_ ].
        
        Axiom Implements :
          forall (Node Type_ : Ty.t),
          M.IsTraitInstance
            "core::marker::Copy"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self Node Type_)
            (* Instance *) [].
      End Impl_core_marker_Copy_where_core_marker_Copy_Node_for_alloc_collections_btree_node_Handle_Node_Type_.
      
      Module Impl_core_clone_Clone_where_core_marker_Copy_Node_for_alloc_collections_btree_node_Handle_Node_Type_.
        Definition Self (Node Type_ : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::Handle") [] [ Node; Type_ ].
        
        (*
            fn clone(&self) -> Self {
                *self
            }
        *)
        Definition clone
            (Node Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self Node Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [ Node; Type_ ]
                    ],
                  self
                |) in
              M.read (| M.deref (| M.read (| self |) |) |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom Implements :
          forall (Node Type_ : Ty.t),
          M.IsTraitInstance
            "core::clone::Clone"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *) []
            (Self Node Type_)
            (* Instance *) [ ("clone", InstanceField.Method (clone Node Type_)) ].
      End Impl_core_clone_Clone_where_core_marker_Copy_Node_for_alloc_collections_btree_node_Handle_Node_Type_.
      
      Module Impl_alloc_collections_btree_node_Handle_Node_Type_.
        Definition Self (Node Type_ : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::Handle") [] [ Node; Type_ ].
        
        (*
            pub fn into_node(self) -> Node {
                self.node
            }
        *)
        Definition into_node
            (Node Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self Node Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply (Ty.path "alloc::collections::btree::node::Handle") [] [ Node; Type_ ],
                  self
                |) in
              M.read (|
                M.SubPointer.get_struct_record_field (|
                  self,
                  "alloc::collections::btree::node::Handle",
                  "node"
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_node :
          forall (Node Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self Node Type_) "into_node" (into_node Node Type_).
        Admitted.
        Global Typeclasses Opaque into_node.
        
        (*
            pub fn idx(&self) -> usize {
                self.idx
            }
        *)
        Definition idx
            (Node Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self Node Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [ Node; Type_ ]
                    ],
                  self
                |) in
              M.read (|
                M.SubPointer.get_struct_record_field (|
                  M.deref (| M.read (| self |) |),
                  "alloc::collections::btree::node::Handle",
                  "idx"
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_idx :
          forall (Node Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self Node Type_) "idx" (idx Node Type_).
        Admitted.
        Global Typeclasses Opaque idx.
      End Impl_alloc_collections_btree_node_Handle_Node_Type_.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_alloc_collections_btree_node_marker_KV.
        Definition Self (BorrowType K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub unsafe fn new_kv(node: NodeRef<BorrowType, K, V, NodeType>, idx: usize) -> Self {
                debug_assert!(idx < node.len());
        
                Handle { node, idx, _marker: PhantomData }
            }
        *)
        Definition new_kv
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ node; idx ] =>
            ltac:(M.monadic
              (let node :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; NodeType ],
                  node
                |) in
              let idx := M.alloc (| Ty.path "usize", idx |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (| idx |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [ BorrowType; K; V; NodeType ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [ M.borrow (| Pointer.Kind.Ref, node |) ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: idx < node.len()" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::Handle"
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ]
                    [
                      ("node", M.read (| node |));
                      ("idx", M.read (| idx |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [ Ty.path "alloc::collections::btree::node::marker::KV" ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new_kv :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "new_kv"
            (new_kv BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque new_kv.
        
        (*
            pub fn left_edge(self) -> Handle<NodeRef<BorrowType, K, V, NodeType>, marker::Edge> {
                unsafe { Handle::new_edge(self.node, self.idx) }
            }
        *)
        Definition left_edge
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [ BorrowType; K; V; NodeType ];
                    Ty.path "alloc::collections::btree::node::marker::Edge"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  "new_edge",
                  [],
                  []
                |),
                [
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "node"
                    |)
                  |);
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_left_edge :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "left_edge"
            (left_edge BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque left_edge.
        
        (*
            pub fn right_edge(self) -> Handle<NodeRef<BorrowType, K, V, NodeType>, marker::Edge> {
                unsafe { Handle::new_edge(self.node, self.idx + 1) }
            }
        *)
        Definition right_edge
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [ BorrowType; K; V; NodeType ];
                    Ty.path "alloc::collections::btree::node::marker::Edge"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  "new_edge",
                  [],
                  []
                |),
                [
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "node"
                    |)
                  |);
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |);
                      Value.Integer IntegerKind.Usize 1
                    ]
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_right_edge :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "right_edge"
            (right_edge BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque right_edge.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_alloc_collections_btree_node_marker_KV.
      
      Module Impl_core_cmp_PartialEq_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType_for_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType.
        Definition Self (BorrowType K V NodeType HandleType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; NodeType ];
              HandleType
            ].
        
        (*
            fn eq(&self, other: &Self) -> bool {
                let Self { node, idx, _marker } = self;
                node.eq(&other.node) && *idx == other.idx
            }
        *)
        Definition eq
            (BorrowType K V NodeType HandleType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType HandleType in
          match ε, τ, α with
          | [], [], [ self; other ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; NodeType ];
                          HandleType
                        ]
                    ],
                  self
                |) in
              let other :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; NodeType ];
                          HandleType
                        ]
                    ],
                  other
                |) in
              M.match_operator (|
                Ty.path "bool",
                self,
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ := M.deref (| M.read (| γ |) |) in
                      let γ1_0 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |) in
                      let γ1_1 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |) in
                      let γ1_2 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "_marker"
                        |) in
                      let node :=
                        M.alloc (|
                          Ty.apply
                            (Ty.path "&")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ]
                            ],
                          γ1_0
                        |) in
                      let idx :=
                        M.alloc (| Ty.apply (Ty.path "&") [] [ Ty.path "usize" ], γ1_1 |) in
                      let _marker :=
                        M.alloc (|
                          Ty.apply
                            (Ty.path "&")
                            []
                            [ Ty.apply (Ty.path "core::marker::PhantomData") [] [ HandleType ] ],
                          γ1_2
                        |) in
                      LogicalOp.and (|
                        M.call_closure (|
                          Ty.path "bool",
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [ BorrowType; K; V; NodeType ],
                            "eq",
                            [],
                            []
                          |),
                          [
                            M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| node |) |) |);
                            M.borrow (|
                              Pointer.Kind.Ref,
                              M.deref (|
                                M.borrow (|
                                  Pointer.Kind.Ref,
                                  M.SubPointer.get_struct_record_field (|
                                    M.deref (| M.read (| other |) |),
                                    "alloc::collections::btree::node::Handle",
                                    "node"
                                  |)
                                |)
                              |)
                            |)
                          ]
                        |),
                        ltac:(M.monadic
                          (M.call_closure (|
                            Ty.path "bool",
                            BinOp.eq,
                            [
                              M.read (| M.deref (| M.read (| idx |) |) |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| other |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)))
                      |)))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom Implements :
          forall (BorrowType K V NodeType HandleType : Ty.t),
          M.IsTraitInstance
            "core::cmp::PartialEq"
            (* Trait polymorphic consts *) []
            (* Trait polymorphic types *)
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::Handle")
                []
                [
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; NodeType ];
                  HandleType
                ]
            ]
            (Self BorrowType K V NodeType HandleType)
            (* Instance *) [ ("eq", InstanceField.Method (eq BorrowType K V NodeType HandleType)) ].
      End Impl_core_cmp_PartialEq_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType_for_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType.
        Definition Self (BorrowType K V NodeType HandleType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; NodeType ];
              HandleType
            ].
        
        (*
            pub fn reborrow(&self) -> Handle<NodeRef<marker::Immut<'_>, K, V, NodeType>, HandleType> {
                // We can't use Handle::new_kv or Handle::new_edge because we don't know our type
                Handle { node: self.node.reborrow(), idx: self.idx, _marker: PhantomData }
            }
        *)
        Definition reborrow
            (BorrowType K V NodeType HandleType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType HandleType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ BorrowType; K; V; NodeType ];
                          HandleType
                        ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::Handle"
                []
                [
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; NodeType ];
                  HandleType
                ]
                [
                  ("node",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; NodeType
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; NodeType ],
                        "reborrow",
                        [],
                        []
                      |),
                      [
                        M.borrow (|
                          Pointer.Kind.Ref,
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| self |) |),
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |)
                      ]
                    |));
                  ("idx",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::Handle",
                        "idx"
                      |)
                    |));
                  ("_marker", Value.StructTuple "core::marker::PhantomData" [] [ HandleType ] [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_reborrow :
          forall (BorrowType K V NodeType HandleType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType HandleType)
            "reborrow"
            (reborrow BorrowType K V NodeType HandleType).
        Admitted.
        Global Typeclasses Opaque reborrow.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_HandleType.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_NodeType_HandleType.
        Definition Self (K V NodeType HandleType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
              HandleType
            ].
        
        (*
            pub unsafe fn reborrow_mut(
                &mut self,
            ) -> Handle<NodeRef<marker::Mut<'_>, K, V, NodeType>, HandleType> {
                // We can't use Handle::new_kv or Handle::new_edge because we don't know our type
                Handle { node: unsafe { self.node.reborrow_mut() }, idx: self.idx, _marker: PhantomData }
            }
        *)
        Definition reborrow_mut
            (K V NodeType HandleType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType HandleType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          HandleType
                        ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::Handle"
                []
                [
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
                  HandleType
                ]
                [
                  ("node",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                          ],
                        "reborrow_mut",
                        [],
                        []
                      |),
                      [
                        M.borrow (|
                          Pointer.Kind.MutRef,
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| self |) |),
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |)
                      ]
                    |));
                  ("idx",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::Handle",
                        "idx"
                      |)
                    |));
                  ("_marker", Value.StructTuple "core::marker::PhantomData" [] [ HandleType ] [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_reborrow_mut :
          forall (K V NodeType HandleType : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V NodeType HandleType)
            "reborrow_mut"
            (reborrow_mut K V NodeType HandleType).
        Admitted.
        Global Typeclasses Opaque reborrow_mut.
        
        (*
            pub fn dormant(&self) -> Handle<NodeRef<marker::DormantMut, K, V, NodeType>, HandleType> {
                Handle { node: self.node.dormant(), idx: self.idx, _marker: PhantomData }
            }
        *)
        Definition dormant
            (K V NodeType HandleType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType HandleType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          HandleType
                        ]
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::Handle"
                []
                [
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; K; V; NodeType
                    ];
                  HandleType
                ]
                [
                  ("node",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::DormantMut";
                          K;
                          V;
                          NodeType
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                          ],
                        "dormant",
                        [],
                        []
                      |),
                      [
                        M.borrow (|
                          Pointer.Kind.Ref,
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| self |) |),
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |)
                      ]
                    |));
                  ("idx",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        M.deref (| M.read (| self |) |),
                        "alloc::collections::btree::node::Handle",
                        "idx"
                      |)
                    |));
                  ("_marker", Value.StructTuple "core::marker::PhantomData" [] [ HandleType ] [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_dormant :
          forall (K V NodeType HandleType : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V NodeType HandleType)
            "dormant"
            (dormant K V NodeType HandleType).
        Admitted.
        Global Typeclasses Opaque dormant.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_NodeType_HandleType.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_DormantMut_K_V_NodeType_HandleType.
        Definition Self (K V NodeType HandleType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::DormantMut"; K; V; NodeType ];
              HandleType
            ].
        
        (*
            pub unsafe fn awaken<'a>(self) -> Handle<NodeRef<marker::Mut<'a>, K, V, NodeType>, HandleType> {
                Handle { node: unsafe { self.node.awaken() }, idx: self.idx, _marker: PhantomData }
            }
        *)
        Definition awaken
            (K V NodeType HandleType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType HandleType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::DormantMut";
                          K;
                          V;
                          NodeType
                        ];
                      HandleType
                    ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::Handle"
                []
                [
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
                  HandleType
                ]
                [
                  ("node",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::DormantMut";
                            K;
                            V;
                            NodeType
                          ],
                        "awaken",
                        [],
                        []
                      |),
                      [
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |)
                      ]
                    |));
                  ("idx",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::Handle",
                        "idx"
                      |)
                    |));
                  ("_marker", Value.StructTuple "core::marker::PhantomData" [] [ HandleType ] [])
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_awaken :
          forall (K V NodeType HandleType : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V NodeType HandleType)
            "awaken"
            (awaken K V NodeType HandleType).
        Admitted.
        Global Typeclasses Opaque awaken.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_DormantMut_K_V_NodeType_HandleType.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_alloc_collections_btree_node_marker_Edge.
        Definition Self (BorrowType K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            pub unsafe fn new_edge(node: NodeRef<BorrowType, K, V, NodeType>, idx: usize) -> Self {
                debug_assert!(idx <= node.len());
        
                Handle { node, idx, _marker: PhantomData }
            }
        *)
        Definition new_edge
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ node; idx ] =>
            ltac:(M.monadic
              (let node :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ BorrowType; K; V; NodeType ],
                  node
                |) in
              let idx := M.alloc (| Ty.path "usize", idx |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.le,
                                                  [
                                                    M.read (| idx |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [ BorrowType; K; V; NodeType ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [ M.borrow (| Pointer.Kind.Ref, node |) ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "assertion failed: idx <= node.len()" |) ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::Handle"
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ]
                    [
                      ("node", M.read (| node |));
                      ("idx", M.read (| idx |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [ Ty.path "alloc::collections::btree::node::marker::Edge" ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_new_edge :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "new_edge"
            (new_edge BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque new_edge.
        
        (*
            pub fn left_kv(self) -> Result<Handle<NodeRef<BorrowType, K, V, NodeType>, marker::KV>, Self> {
                if self.idx > 0 {
                    Ok(unsafe { Handle::new_kv(self.node, self.idx - 1) })
                } else {
                    Err(self)
                }
            }
        *)
        Definition left_kv
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.match_operator (|
                Ty.apply
                  (Ty.path "core::result::Result")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; NodeType ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; NodeType ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ]
                  ],
                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ :=
                        M.use
                          (M.alloc (|
                            Ty.path "bool",
                            M.call_closure (|
                              Ty.path "bool",
                              BinOp.gt,
                              [
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::Handle",
                                    "idx"
                                  |)
                                |);
                                Value.Integer IntegerKind.Usize 0
                              ]
                            |)
                          |)) in
                      let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                      Value.StructTuple
                        "core::result::Result::Ok"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ]
                        ]
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [ BorrowType; K; V; NodeType ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [ BorrowType; K; V; NodeType ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ],
                              "new_kv",
                              [],
                              []
                            |),
                            [
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              M.call_closure (|
                                Ty.path "usize",
                                BinOp.Wrap.sub,
                                [
                                  M.read (|
                                    M.SubPointer.get_struct_record_field (|
                                      self,
                                      "alloc::collections::btree::node::Handle",
                                      "idx"
                                    |)
                                  |);
                                  Value.Integer IntegerKind.Usize 1
                                ]
                              |)
                            ]
                          |)
                        ]));
                  fun γ =>
                    ltac:(M.monadic
                      (Value.StructTuple
                        "core::result::Result::Err"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ]
                        ]
                        [ M.read (| self |) ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_left_kv :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "left_kv"
            (left_kv BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque left_kv.
        
        (*
            pub fn right_kv(self) -> Result<Handle<NodeRef<BorrowType, K, V, NodeType>, marker::KV>, Self> {
                if self.idx < self.node.len() {
                    Ok(unsafe { Handle::new_kv(self.node, self.idx) })
                } else {
                    Err(self)
                }
            }
        *)
        Definition right_kv
            (BorrowType K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.match_operator (|
                Ty.apply
                  (Ty.path "core::result::Result")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; NodeType ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [ BorrowType; K; V; NodeType ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ]
                  ],
                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ :=
                        M.use
                          (M.alloc (|
                            Ty.path "bool",
                            M.call_closure (|
                              Ty.path "bool",
                              BinOp.lt,
                              [
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::Handle",
                                    "idx"
                                  |)
                                |);
                                M.call_closure (|
                                  Ty.path "usize",
                                  M.get_associated_function (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [ BorrowType; K; V; NodeType ],
                                    "len",
                                    [],
                                    []
                                  |),
                                  [
                                    M.borrow (|
                                      Pointer.Kind.Ref,
                                      M.SubPointer.get_struct_record_field (|
                                        self,
                                        "alloc::collections::btree::node::Handle",
                                        "node"
                                      |)
                                    |)
                                  ]
                                |)
                              ]
                            |)
                          |)) in
                      let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                      Value.StructTuple
                        "core::result::Result::Ok"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ]
                        ]
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [ BorrowType; K; V; NodeType ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [ BorrowType; K; V; NodeType ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ],
                              "new_kv",
                              [],
                              []
                            |),
                            [
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        ]));
                  fun γ =>
                    ltac:(M.monadic
                      (Value.StructTuple
                        "core::result::Result::Err"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [ BorrowType; K; V; NodeType ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ]
                        ]
                        [ M.read (| self |) ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_right_kv :
          forall (BorrowType K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V NodeType)
            "right_kv"
            (right_kv BorrowType K V NodeType).
        Admitted.
        Global Typeclasses Opaque right_kv.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_NodeType_alloc_collections_btree_node_marker_Edge.
      
      (*
      Enum LeftOrRight
      {
        const_params := [];
        ty_params := [ "T" ];
        variants :=
          [
            {
              name := "Left";
              item := StructTuple [ T ];
            };
            {
              name := "Right";
              item := StructTuple [ T ];
            }
          ];
      }
      *)
      
      Axiom IsDiscriminant_LeftOrRight_Left :
        M.IsDiscriminant "alloc::collections::btree::node::LeftOrRight::Left" 0.
      Axiom IsDiscriminant_LeftOrRight_Right :
        M.IsDiscriminant "alloc::collections::btree::node::LeftOrRight::Right" 1.
      
      (*
      fn splitpoint(edge_idx: usize) -> (usize, LeftOrRight<usize>) {
          debug_assert!(edge_idx <= CAPACITY);
          // Rust issue #74834 tries to explain these symmetric rules.
          match edge_idx {
              0..EDGE_IDX_LEFT_OF_CENTER => (KV_IDX_CENTER - 1, LeftOrRight::Left(edge_idx)),
              EDGE_IDX_LEFT_OF_CENTER => (KV_IDX_CENTER, LeftOrRight::Left(edge_idx)),
              EDGE_IDX_RIGHT_OF_CENTER => (KV_IDX_CENTER, LeftOrRight::Right(0)),
              _ => (KV_IDX_CENTER + 1, LeftOrRight::Right(edge_idx - (KV_IDX_CENTER + 1 + 1))),
          }
      }
      *)
      Definition splitpoint (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [], [ edge_idx ] =>
          ltac:(M.monadic
            (let edge_idx := M.alloc (| Ty.path "usize", edge_idx |) in
            M.read (|
              let~ _ : Ty.tuple [] :=
                M.match_operator (|
                  Ty.tuple [],
                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                        let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                        M.read (|
                          let~ _ : Ty.tuple [] :=
                            M.match_operator (|
                              Ty.tuple [],
                              M.alloc (| Ty.tuple [], Value.Tuple [] |),
                              [
                                fun γ =>
                                  ltac:(M.monadic
                                    (let γ :=
                                      M.use
                                        (M.alloc (|
                                          Ty.path "bool",
                                          M.call_closure (|
                                            Ty.path "bool",
                                            UnOp.not,
                                            [
                                              M.call_closure (|
                                                Ty.path "bool",
                                                BinOp.le,
                                                [
                                                  M.read (| edge_idx |);
                                                  M.read (|
                                                    get_constant (|
                                                      "alloc::collections::btree::node::CAPACITY",
                                                      Ty.path "usize"
                                                    |)
                                                  |)
                                                ]
                                              |)
                                            ]
                                          |)
                                        |)) in
                                    let _ :=
                                      is_constant_or_break_match (|
                                        M.read (| γ |),
                                        Value.Bool true
                                      |) in
                                    M.never_to_any (|
                                      M.call_closure (|
                                        Ty.path "never",
                                        M.get_function (| "core::panicking::panic", [], [] |),
                                        [ mk_str (| "assertion failed: edge_idx <= CAPACITY" |) ]
                                      |)
                                    |)));
                                fun γ => ltac:(M.monadic (Value.Tuple []))
                              ]
                            |) in
                          M.alloc (| Ty.tuple [], Value.Tuple [] |)
                        |)));
                    fun γ => ltac:(M.monadic (Value.Tuple []))
                  ]
                |) in
              M.alloc (|
                Ty.tuple
                  [
                    Ty.path "usize";
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::LeftOrRight")
                      []
                      [ Ty.path "usize" ]
                  ],
                M.match_operator (|
                  Ty.tuple
                    [
                      Ty.path "usize";
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::LeftOrRight")
                        []
                        [ Ty.path "usize" ]
                    ],
                  edge_idx,
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (Value.Tuple
                          [
                            M.call_closure (|
                              Ty.path "usize",
                              BinOp.Wrap.sub,
                              [
                                M.read (|
                                  get_constant (|
                                    "alloc::collections::btree::node::KV_IDX_CENTER",
                                    Ty.path "usize"
                                  |)
                                |);
                                Value.Integer IntegerKind.Usize 1
                              ]
                            |);
                            Value.StructTuple
                              "alloc::collections::btree::node::LeftOrRight::Left"
                              []
                              [ Ty.path "usize" ]
                              [ M.read (| edge_idx |) ]
                          ]));
                    fun γ =>
                      ltac:(M.monadic
                        (let _ :=
                          is_constant_or_break_match (|
                            M.read (| γ |),
                            Value.Integer IntegerKind.Usize 5
                          |) in
                        Value.Tuple
                          [
                            M.read (|
                              get_constant (|
                                "alloc::collections::btree::node::KV_IDX_CENTER",
                                Ty.path "usize"
                              |)
                            |);
                            Value.StructTuple
                              "alloc::collections::btree::node::LeftOrRight::Left"
                              []
                              [ Ty.path "usize" ]
                              [ M.read (| edge_idx |) ]
                          ]));
                    fun γ =>
                      ltac:(M.monadic
                        (let _ :=
                          is_constant_or_break_match (|
                            M.read (| γ |),
                            Value.Integer IntegerKind.Usize 6
                          |) in
                        Value.Tuple
                          [
                            M.read (|
                              get_constant (|
                                "alloc::collections::btree::node::KV_IDX_CENTER",
                                Ty.path "usize"
                              |)
                            |);
                            Value.StructTuple
                              "alloc::collections::btree::node::LeftOrRight::Right"
                              []
                              [ Ty.path "usize" ]
                              [ Value.Integer IntegerKind.Usize 0 ]
                          ]));
                    fun γ =>
                      ltac:(M.monadic
                        (Value.Tuple
                          [
                            M.call_closure (|
                              Ty.path "usize",
                              BinOp.Wrap.add,
                              [
                                M.read (|
                                  get_constant (|
                                    "alloc::collections::btree::node::KV_IDX_CENTER",
                                    Ty.path "usize"
                                  |)
                                |);
                                Value.Integer IntegerKind.Usize 1
                              ]
                            |);
                            Value.StructTuple
                              "alloc::collections::btree::node::LeftOrRight::Right"
                              []
                              [ Ty.path "usize" ]
                              [
                                M.call_closure (|
                                  Ty.path "usize",
                                  BinOp.Wrap.sub,
                                  [
                                    M.read (| edge_idx |);
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (|
                                              get_constant (|
                                                "alloc::collections::btree::node::KV_IDX_CENTER",
                                                Ty.path "usize"
                                              |)
                                            |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |);
                                        Value.Integer IntegerKind.Usize 1
                                      ]
                                    |)
                                  ]
                                |)
                              ]
                          ]))
                  ]
                |)
              |)
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_splitpoint :
        M.IsFunction.C "alloc::collections::btree::node::splitpoint" splitpoint.
      Admitted.
      Global Typeclasses Opaque splitpoint.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_Edge.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            unsafe fn insert_fit(
                mut self,
                key: K,
                val: V,
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::Leaf>, marker::KV> {
                debug_assert!(self.node.len() < CAPACITY);
                let new_len = self.node.len() + 1;
        
                unsafe {
                    slice_insert(self.node.key_area_mut(..new_len), self.idx, key);
                    slice_insert(self.node.val_area_mut(..new_len), self.idx, val);
                    *self.node.len_mut() = new_len as u16;
        
                    Handle::new_kv(self.node, self.idx)
                }
            }
        *)
        Definition insert_fit
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; key; val ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Leaf"
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |);
                                                    M.read (|
                                                      get_constant (|
                                                        "alloc::collections::btree::node::CAPACITY",
                                                        Ty.path "usize"
                                                      |)
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.node.len() < CAPACITY"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ new_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [
                      M.call_closure (|
                        Ty.path "usize",
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ],
                          "len",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |);
                      Value.Integer IntegerKind.Usize 1
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (| "alloc::collections::btree::node::slice_insert", [], [ K ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| new_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |);
                      M.read (| key |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (| "alloc::collections::btree::node::slice_insert", [], [ V ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| new_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |);
                      M.read (| val |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_len |))
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "new_kv",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_insert_fit :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "insert_fit" (insert_fit K V).
        Admitted.
        Global Typeclasses Opaque insert_fit.
        (*
            fn insert<A: Allocator + Clone>(
                self,
                key: K,
                val: V,
                alloc: A,
            ) -> (
                Option<SplitResult<'a, K, V, marker::Leaf>>,
                Handle<NodeRef<marker::DormantMut, K, V, marker::Leaf>, marker::KV>,
            ) {
                if self.node.len() < CAPACITY {
                    // SAFETY: There is enough space in the node for insertion.
                    let handle = unsafe { self.insert_fit(key, val) };
                    (None, handle.dormant())
                } else {
                    let (middle_kv_idx, insertion) = splitpoint(self.idx);
                    let middle = unsafe { Handle::new_kv(self.node, middle_kv_idx) };
                    let mut result = middle.split(alloc);
                    let insertion_edge = match insertion {
                        LeftOrRight::Left(insert_idx) => unsafe {
                            Handle::new_edge(result.left.reborrow_mut(), insert_idx)
                        },
                        LeftOrRight::Right(insert_idx) => unsafe {
                            Handle::new_edge(result.right.borrow_mut(), insert_idx)
                        },
                    };
                    // SAFETY: We just split the node, so there is enough space for
                    // insertion.
                    let handle = unsafe { insertion_edge.insert_fit(key, val).dormant() };
                    (Some(result), handle)
                }
            }
        *)
        Definition insert (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; key; val; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              let alloc := M.alloc (| A, alloc |) in
              M.match_operator (|
                Ty.tuple
                  [
                    Ty.apply
                      (Ty.path "core::option::Option")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::SplitResult")
                          []
                          [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ]
                      ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::DormantMut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ]
                  ],
                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ :=
                        M.use
                          (M.alloc (|
                            Ty.path "bool",
                            M.call_closure (|
                              Ty.path "bool",
                              BinOp.lt,
                              [
                                M.call_closure (|
                                  Ty.path "usize",
                                  M.get_associated_function (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ],
                                    "len",
                                    [],
                                    []
                                  |),
                                  [
                                    M.borrow (|
                                      Pointer.Kind.Ref,
                                      M.SubPointer.get_struct_record_field (|
                                        self,
                                        "alloc::collections::btree::node::Handle",
                                        "node"
                                      |)
                                    |)
                                  ]
                                |);
                                M.read (|
                                  get_constant (|
                                    "alloc::collections::btree::node::CAPACITY",
                                    Ty.path "usize"
                                  |)
                                |)
                              ]
                            |)
                          |)) in
                      let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                      M.read (|
                        let~ handle :
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ] :=
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ],
                              "insert_fit",
                              [],
                              []
                            |),
                            [ M.read (| self |); M.read (| key |); M.read (| val |) ]
                          |) in
                        M.alloc (|
                          Ty.tuple
                            [
                              Ty.apply
                                (Ty.path "core::option::Option")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ]
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ]
                            ],
                          Value.Tuple
                            [
                              Value.StructTuple
                                "core::option::Option::None"
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ]
                                ]
                                [];
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path
                                          "alloc::collections::btree::node::marker::DormantMut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::KV"
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::KV"
                                    ],
                                  "dormant",
                                  [],
                                  []
                                |),
                                [ M.borrow (| Pointer.Kind.Ref, handle |) ]
                              |)
                            ]
                        |)
                      |)));
                  fun γ =>
                    ltac:(M.monadic
                      (M.match_operator (|
                        Ty.tuple
                          [
                            Ty.apply
                              (Ty.path "core::option::Option")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::SplitResult")
                                  []
                                  [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ]
                              ];
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ]
                          ],
                        M.alloc (|
                          Ty.tuple
                            [
                              Ty.path "usize";
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                []
                                [ Ty.path "usize" ]
                            ],
                          M.call_closure (|
                            Ty.tuple
                              [
                                Ty.path "usize";
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                  []
                                  [ Ty.path "usize" ]
                              ],
                            M.get_function (|
                              "alloc::collections::btree::node::splitpoint",
                              [],
                              []
                            |),
                            [
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                              let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                              let middle_kv_idx := M.copy (| Ty.path "usize", γ0_0 |) in
                              let insertion :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                    []
                                    [ Ty.path "usize" ],
                                  γ0_1
                                |) in
                              M.read (|
                                let~ middle :
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::KV"
                                      ] :=
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::KV"
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ],
                                      "new_kv",
                                      [],
                                      []
                                    |),
                                    [
                                      M.read (|
                                        M.SubPointer.get_struct_record_field (|
                                          self,
                                          "alloc::collections::btree::node::Handle",
                                          "node"
                                        |)
                                      |);
                                      M.read (| middle_kv_idx |)
                                    ]
                                  |) in
                                let~ result :
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::SplitResult")
                                      []
                                      [
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ] :=
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::SplitResult")
                                      []
                                      [
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ],
                                      "split",
                                      [],
                                      [ A ]
                                    |),
                                    [ M.read (| middle |); M.read (| alloc |) ]
                                  |) in
                                let~ insertion_edge :
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::Edge"
                                      ] :=
                                  M.match_operator (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::Edge"
                                      ],
                                    insertion,
                                    [
                                      fun γ =>
                                        ltac:(M.monadic
                                          (let γ0_0 :=
                                            M.SubPointer.get_struct_tuple_field (|
                                              γ,
                                              "alloc::collections::btree::node::LeftOrRight::Left",
                                              0
                                            |) in
                                          let insert_idx := M.copy (| Ty.path "usize", γ0_0 |) in
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::Handle")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Leaf"
                                                  ];
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Edge"
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::Handle")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Leaf"
                                                    ];
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Edge"
                                                ],
                                              "new_edge",
                                              [],
                                              []
                                            |),
                                            [
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Leaf"
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Leaf"
                                                    ],
                                                  "reborrow_mut",
                                                  [],
                                                  []
                                                |),
                                                [
                                                  M.borrow (|
                                                    Pointer.Kind.MutRef,
                                                    M.SubPointer.get_struct_record_field (|
                                                      result,
                                                      "alloc::collections::btree::node::SplitResult",
                                                      "left"
                                                    |)
                                                  |)
                                                ]
                                              |);
                                              M.read (| insert_idx |)
                                            ]
                                          |)));
                                      fun γ =>
                                        ltac:(M.monadic
                                          (let γ0_0 :=
                                            M.SubPointer.get_struct_tuple_field (|
                                              γ,
                                              "alloc::collections::btree::node::LeftOrRight::Right",
                                              0
                                            |) in
                                          let insert_idx := M.copy (| Ty.path "usize", γ0_0 |) in
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::Handle")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Leaf"
                                                  ];
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Edge"
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::Handle")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Leaf"
                                                    ];
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Edge"
                                                ],
                                              "new_edge",
                                              [],
                                              []
                                            |),
                                            [
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Leaf"
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Owned";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Leaf"
                                                    ],
                                                  "borrow_mut",
                                                  [],
                                                  []
                                                |),
                                                [
                                                  M.borrow (|
                                                    Pointer.Kind.MutRef,
                                                    M.SubPointer.get_struct_record_field (|
                                                      result,
                                                      "alloc::collections::btree::node::SplitResult",
                                                      "right"
                                                    |)
                                                  |)
                                                ]
                                              |);
                                              M.read (| insert_idx |)
                                            ]
                                          |)))
                                    ]
                                  |) in
                                let~ handle :
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path
                                              "alloc::collections::btree::node::marker::DormantMut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::KV"
                                      ] :=
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::Handle")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path
                                              "alloc::collections::btree::node::marker::DormantMut";
                                            K;
                                            V;
                                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                                          ];
                                        Ty.path "alloc::collections::btree::node::marker::KV"
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ],
                                      "dormant",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.Ref,
                                        M.alloc (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::Handle")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Leaf"
                                                ];
                                              Ty.path "alloc::collections::btree::node::marker::KV"
                                            ],
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::Handle")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Leaf"
                                                  ];
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::KV"
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::Handle")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Leaf"
                                                    ];
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Edge"
                                                ],
                                              "insert_fit",
                                              [],
                                              []
                                            |),
                                            [
                                              M.read (| insertion_edge |);
                                              M.read (| key |);
                                              M.read (| val |)
                                            ]
                                          |)
                                        |)
                                      |)
                                    ]
                                  |) in
                                M.alloc (|
                                  Ty.tuple
                                    [
                                      Ty.apply
                                        (Ty.path "core::option::Option")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::SplitResult")
                                            []
                                            [
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ]
                                        ];
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::DormantMut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ]
                                    ],
                                  Value.Tuple
                                    [
                                      Value.StructTuple
                                        "core::option::Option::Some"
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::SplitResult")
                                            []
                                            [
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ]
                                        ]
                                        [ M.read (| result |) ];
                                      M.read (| handle |)
                                    ]
                                |)
                              |)))
                        ]
                      |)))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_insert :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "insert" (insert K V).
        Admitted.
        Global Typeclasses Opaque insert.
        (*
            pub fn insert_recursing<A: Allocator + Clone>(
                self,
                key: K,
                value: V,
                alloc: A,
                split_root: impl FnOnce(SplitResult<'a, K, V, marker::LeafOrInternal>),
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::Leaf>, marker::KV> {
                let (mut split, handle) = match self.insert(key, value, alloc.clone()) {
                    // SAFETY: we have finished splitting and can now re-awaken the
                    // handle to the inserted element.
                    (None, handle) => return unsafe { handle.awaken() },
                    (Some(split), handle) => (split.forget_node_type(), handle),
                };
        
                loop {
                    split = match split.left.ascend() {
                        Ok(parent) => {
                            match parent.insert(split.kv.0, split.kv.1, split.right, alloc.clone()) {
                                // SAFETY: we have finished splitting and can now re-awaken the
                                // handle to the inserted element.
                                None => return unsafe { handle.awaken() },
                                Some(split) => split.forget_node_type(),
                            }
                        }
                        Err(root) => {
                            split_root(SplitResult { left: root, ..split });
                            // SAFETY: we have finished splitting and can now re-awaken the
                            // handle to the inserted element.
                            return unsafe { handle.awaken() };
                        }
                    };
                }
            }
        *)
        Definition insert_recursing
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [],
              [ A; impl_FnOnce_SplitResult_'a__K__V__marker_LeafOrInternal__ ],
              [ self; key; value; alloc; split_root ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let value := M.alloc (| V, value |) in
              let alloc := M.alloc (| A, alloc |) in
              let split_root :=
                M.alloc (|
                  impl_FnOnce_SplitResult_'a__K__V__marker_LeafOrInternal__,
                  split_root
                |) in
              M.catch_return
                (Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ];
                    Ty.path "alloc::collections::btree::node::marker::KV"
                  ]) (|
                ltac:(M.monadic
                  (M.match_operator (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.alloc (|
                      Ty.tuple
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::SplitResult")
                            []
                            [
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ]
                        ],
                      M.match_operator (|
                        Ty.tuple
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::SplitResult")
                              []
                              [
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ];
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::KV"
                              ]
                          ],
                        M.alloc (|
                          Ty.tuple
                            [
                              Ty.apply
                                (Ty.path "core::option::Option")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ]
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ]
                            ],
                          M.call_closure (|
                            Ty.tuple
                              [
                                Ty.apply
                                  (Ty.path "core::option::Option")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::SplitResult")
                                      []
                                      [
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ]
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path
                                          "alloc::collections::btree::node::marker::DormantMut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::KV"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ],
                              "insert",
                              [],
                              [ A ]
                            |),
                            [
                              M.read (| self |);
                              M.read (| key |);
                              M.read (| value |);
                              M.call_closure (|
                                A,
                                M.get_trait_method (|
                                  "core::clone::Clone",
                                  A,
                                  [],
                                  [],
                                  "clone",
                                  [],
                                  []
                                |),
                                [ M.borrow (| Pointer.Kind.Ref, alloc |) ]
                              |)
                            ]
                          |)
                        |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                              let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                              let _ := M.is_struct_tuple (| γ0_0, "core::option::Option::None" |) in
                              let handle :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path
                                            "alloc::collections::btree::node::marker::DormantMut";
                                          K;
                                          V;
                                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::KV"
                                    ],
                                  γ0_1
                                |) in
                              M.never_to_any (|
                                M.read (|
                                  M.return_ (|
                                    M.call_closure (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::Handle")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.path "alloc::collections::btree::node::marker::KV"
                                        ],
                                      M.get_associated_function (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::DormantMut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Leaf"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::KV"
                                          ],
                                        "awaken",
                                        [],
                                        []
                                      |),
                                      [ M.read (| handle |) ]
                                    |)
                                  |)
                                |)
                              |)));
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                              let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                              let γ1_0 :=
                                M.SubPointer.get_struct_tuple_field (|
                                  γ0_0,
                                  "core::option::Option::Some",
                                  0
                                |) in
                              let split :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ],
                                  γ1_0
                                |) in
                              let handle :=
                                M.copy (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path
                                            "alloc::collections::btree::node::marker::DormantMut";
                                          K;
                                          V;
                                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::KV"
                                    ],
                                  γ0_1
                                |) in
                              Value.Tuple
                                [
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::SplitResult")
                                      []
                                      [
                                        K;
                                        V;
                                        Ty.path
                                          "alloc::collections::btree::node::marker::LeafOrInternal"
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::SplitResult")
                                        []
                                        [
                                          K;
                                          V;
                                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                                        ],
                                      "forget_node_type",
                                      [],
                                      []
                                    |),
                                    [ M.read (| split |) ]
                                  |);
                                  M.read (| handle |)
                                ]))
                        ]
                      |)
                    |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                          let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                          let split :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::SplitResult")
                                []
                                [
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              γ0_0
                            |) in
                          let handle :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::DormantMut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Leaf"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ],
                              γ0_1
                            |) in
                          M.never_to_any (|
                            M.read (|
                              M.loop (|
                                Ty.path "never",
                                ltac:(M.monadic
                                  (let~ _ : Ty.tuple [] :=
                                    M.write (|
                                      split,
                                      M.match_operator (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::SplitResult")
                                          []
                                          [
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::LeafOrInternal"
                                          ],
                                        M.alloc (|
                                          Ty.apply
                                            (Ty.path "core::result::Result")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::Handle")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Internal"
                                                    ];
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Edge"
                                                ];
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ]
                                            ],
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "core::result::Result")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::Handle")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ];
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Edge"
                                                  ];
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "ascend",
                                              [],
                                              []
                                            |),
                                            [
                                              M.read (|
                                                M.SubPointer.get_struct_record_field (|
                                                  split,
                                                  "alloc::collections::btree::node::SplitResult",
                                                  "left"
                                                |)
                                              |)
                                            ]
                                          |)
                                        |),
                                        [
                                          fun γ =>
                                            ltac:(M.monadic
                                              (let γ0_0 :=
                                                M.SubPointer.get_struct_tuple_field (|
                                                  γ,
                                                  "core::result::Result::Ok",
                                                  0
                                                |) in
                                              let parent :=
                                                M.copy (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::Handle")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ];
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Edge"
                                                    ],
                                                  γ0_0
                                                |) in
                                              M.match_operator (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::SplitResult")
                                                  []
                                                  [
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                                  ],
                                                M.alloc (|
                                                  Ty.apply
                                                    (Ty.path "core::option::Option")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::SplitResult")
                                                        []
                                                        [
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ]
                                                    ],
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path "core::option::Option")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::SplitResult")
                                                          []
                                                          [
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Internal"
                                                          ]
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::Handle")
                                                        []
                                                        [
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::NodeRef")
                                                            []
                                                            [
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Mut";
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ];
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Edge"
                                                        ],
                                                      "insert",
                                                      [],
                                                      [ A ]
                                                    |),
                                                    [
                                                      M.read (| parent |);
                                                      M.read (|
                                                        M.SubPointer.get_tuple_field (|
                                                          M.SubPointer.get_struct_record_field (|
                                                            split,
                                                            "alloc::collections::btree::node::SplitResult",
                                                            "kv"
                                                          |),
                                                          0
                                                        |)
                                                      |);
                                                      M.read (|
                                                        M.SubPointer.get_tuple_field (|
                                                          M.SubPointer.get_struct_record_field (|
                                                            split,
                                                            "alloc::collections::btree::node::SplitResult",
                                                            "kv"
                                                          |),
                                                          1
                                                        |)
                                                      |);
                                                      M.read (|
                                                        M.SubPointer.get_struct_record_field (|
                                                          split,
                                                          "alloc::collections::btree::node::SplitResult",
                                                          "right"
                                                        |)
                                                      |);
                                                      M.call_closure (|
                                                        A,
                                                        M.get_trait_method (|
                                                          "core::clone::Clone",
                                                          A,
                                                          [],
                                                          [],
                                                          "clone",
                                                          [],
                                                          []
                                                        |),
                                                        [ M.borrow (| Pointer.Kind.Ref, alloc |) ]
                                                      |)
                                                    ]
                                                  |)
                                                |),
                                                [
                                                  fun γ =>
                                                    ltac:(M.monadic
                                                      (let _ :=
                                                        M.is_struct_tuple (|
                                                          γ,
                                                          "core::option::Option::None"
                                                        |) in
                                                      M.never_to_any (|
                                                        M.read (|
                                                          M.return_ (|
                                                            M.call_closure (|
                                                              Ty.apply
                                                                (Ty.path
                                                                  "alloc::collections::btree::node::Handle")
                                                                []
                                                                [
                                                                  Ty.apply
                                                                    (Ty.path
                                                                      "alloc::collections::btree::node::NodeRef")
                                                                    []
                                                                    [
                                                                      Ty.path
                                                                        "alloc::collections::btree::node::marker::Mut";
                                                                      K;
                                                                      V;
                                                                      Ty.path
                                                                        "alloc::collections::btree::node::marker::Leaf"
                                                                    ];
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::KV"
                                                                ],
                                                              M.get_associated_function (|
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "alloc::collections::btree::node::Handle")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::NodeRef")
                                                                      []
                                                                      [
                                                                        Ty.path
                                                                          "alloc::collections::btree::node::marker::DormantMut";
                                                                        K;
                                                                        V;
                                                                        Ty.path
                                                                          "alloc::collections::btree::node::marker::Leaf"
                                                                      ];
                                                                    Ty.path
                                                                      "alloc::collections::btree::node::marker::KV"
                                                                  ],
                                                                "awaken",
                                                                [],
                                                                []
                                                              |),
                                                              [ M.read (| handle |) ]
                                                            |)
                                                          |)
                                                        |)
                                                      |)));
                                                  fun γ =>
                                                    ltac:(M.monadic
                                                      (let γ0_0 :=
                                                        M.SubPointer.get_struct_tuple_field (|
                                                          γ,
                                                          "core::option::Option::Some",
                                                          0
                                                        |) in
                                                      let split :=
                                                        M.copy (|
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::SplitResult")
                                                            []
                                                            [
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ],
                                                          γ0_0
                                                        |) in
                                                      M.call_closure (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::SplitResult")
                                                          []
                                                          [
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::LeafOrInternal"
                                                          ],
                                                        M.get_associated_function (|
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::SplitResult")
                                                            []
                                                            [
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Internal"
                                                            ],
                                                          "forget_node_type",
                                                          [],
                                                          []
                                                        |),
                                                        [ M.read (| split |) ]
                                                      |)))
                                                ]
                                              |)));
                                          fun γ =>
                                            ltac:(M.monadic
                                              (let γ0_0 :=
                                                M.SubPointer.get_struct_tuple_field (|
                                                  γ,
                                                  "core::result::Result::Err",
                                                  0
                                                |) in
                                              let root :=
                                                M.copy (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                                    ],
                                                  γ0_0
                                                |) in
                                              M.never_to_any (|
                                                M.read (|
                                                  let~ _ : Ty.tuple [] :=
                                                    M.call_closure (|
                                                      Ty.tuple [],
                                                      M.get_trait_method (|
                                                        "core::ops::function::FnOnce",
                                                        impl_FnOnce_SplitResult_'a__K__V__marker_LeafOrInternal__,
                                                        [],
                                                        [
                                                          Ty.tuple
                                                            [
                                                              Ty.apply
                                                                (Ty.path
                                                                  "alloc::collections::btree::node::SplitResult")
                                                                []
                                                                [
                                                                  K;
                                                                  V;
                                                                  Ty.path
                                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                                ]
                                                            ]
                                                        ],
                                                        "call_once",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.read (| split_root |);
                                                        Value.Tuple
                                                          [
                                                            M.struct_record_update
                                                              (M.read (| split |))
                                                              [ ("left", M.read (| root |)) ]
                                                          ]
                                                      ]
                                                    |) in
                                                  M.return_ (|
                                                    M.call_closure (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::Handle")
                                                        []
                                                        [
                                                          Ty.apply
                                                            (Ty.path
                                                              "alloc::collections::btree::node::NodeRef")
                                                            []
                                                            [
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Mut";
                                                              K;
                                                              V;
                                                              Ty.path
                                                                "alloc::collections::btree::node::marker::Leaf"
                                                            ];
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::KV"
                                                        ],
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::Handle")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::NodeRef")
                                                              []
                                                              [
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::DormantMut";
                                                                K;
                                                                V;
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Leaf"
                                                              ];
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::KV"
                                                          ],
                                                        "awaken",
                                                        [],
                                                        []
                                                      |),
                                                      [ M.read (| handle |) ]
                                                    |)
                                                  |)
                                                |)
                                              |)))
                                        ]
                                      |)
                                    |) in
                                  M.alloc (| Ty.tuple [], Value.Tuple [] |)))
                              |)
                            |)
                          |)))
                    ]
                  |)))
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_insert_recursing :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "insert_recursing" (insert_recursing K V).
        Admitted.
        Global Typeclasses Opaque insert_recursing.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_Edge.
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_Edge.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::Internal"
                ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            fn correct_parent_link(self) {
                // Create backpointer without invalidating other references to the node.
                let ptr = unsafe { NonNull::new_unchecked(NodeRef::as_internal_ptr(&self.node)) };
                let idx = self.idx;
                let mut child = self.descend();
                child.set_parent_link(ptr, idx);
            }
        *)
        Definition correct_parent_link
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.read (|
                let~ ptr :
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::ptr::non_null::NonNull")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::InternalNode")
                            []
                            [ K; V ]
                        ],
                      "new_unchecked",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::InternalNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          "as_internal_ptr",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.borrow (|
                                Pointer.Kind.Ref,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |)
                            |)
                          |)
                        ]
                      |)
                    ]
                  |) in
                let~ idx : Ty.path "usize" :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |) in
                let~ child :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "descend",
                      [],
                      []
                    |),
                    [ M.read (| self |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "set_parent_link",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, child |); M.read (| ptr |); M.read (| idx |)
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_correct_parent_link :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "correct_parent_link" (correct_parent_link K V).
        Admitted.
        Global Typeclasses Opaque correct_parent_link.
        (*
            fn insert_fit(&mut self, key: K, val: V, edge: Root<K, V>) {
                debug_assert!(self.node.len() < CAPACITY);
                debug_assert!(edge.height == self.node.height - 1);
                let new_len = self.node.len() + 1;
        
                unsafe {
                    slice_insert(self.node.key_area_mut(..new_len), self.idx, key);
                    slice_insert(self.node.val_area_mut(..new_len), self.idx, val);
                    slice_insert(self.node.edge_area_mut(..new_len + 1), self.idx + 1, edge.node);
                    *self.node.len_mut() = new_len as u16;
        
                    self.node.correct_childrens_parent_links(self.idx + 1..new_len + 1);
                }
            }
        *)
        Definition insert_fit
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; key; val; edge ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ]
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              let edge :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  edge
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Internal"
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            M.deref (| M.read (| self |) |),
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |);
                                                    M.read (|
                                                      get_constant (|
                                                        "alloc::collections::btree::node::CAPACITY",
                                                        Ty.path "usize"
                                                      |)
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.node.len() < CAPACITY"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.eq,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        edge,
                                                        "alloc::collections::btree::node::NodeRef",
                                                        "height"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.sub,
                                                      [
                                                        M.read (|
                                                          M.SubPointer.get_struct_record_field (|
                                                            M.SubPointer.get_struct_record_field (|
                                                              M.deref (| M.read (| self |) |),
                                                              "alloc::collections::btree::node::Handle",
                                                              "node"
                                                            |),
                                                            "alloc::collections::btree::node::NodeRef",
                                                            "height"
                                                          |)
                                                        |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: edge.height == self.node.height - 1"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ new_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [
                      M.call_closure (|
                        Ty.path "usize",
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          "len",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |);
                      Value.Integer IntegerKind.Usize 1
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (| "alloc::collections::btree::node::slice_insert", [], [ K ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| new_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |);
                      M.read (| key |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (| "alloc::collections::btree::node::slice_insert", [], [ V ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| new_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |);
                      M.read (| val |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (|
                      "alloc::collections::btree::node::slice_insert",
                      [],
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::ptr::non_null::NonNull")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::LeafNode")
                                              []
                                              [ K; V ]
                                          ]
                                      ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "edge_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::ptr::non_null::NonNull")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::LeafNode")
                                              []
                                              [ K; V ]
                                          ]
                                      ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [
                                  ("end_",
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [ M.read (| new_len |); Value.Integer IntegerKind.Usize 1 ]
                                    |))
                                ]
                            ]
                          |)
                        |)
                      |);
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.add,
                        [
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::Handle",
                              "idx"
                            |)
                          |);
                          Value.Integer IntegerKind.Usize 1
                        ]
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          edge,
                          "alloc::collections::btree::node::NodeRef",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_len |))
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "correct_childrens_parent_links",
                      [],
                      [ Ty.apply (Ty.path "core::ops::range::Range") [] [ Ty.path "usize" ] ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |);
                      Value.mkStructRecord
                        "core::ops::range::Range"
                        []
                        [ Ty.path "usize" ]
                        [
                          ("start",
                            M.call_closure (|
                              Ty.path "usize",
                              BinOp.Wrap.add,
                              [
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    M.deref (| M.read (| self |) |),
                                    "alloc::collections::btree::node::Handle",
                                    "idx"
                                  |)
                                |);
                                Value.Integer IntegerKind.Usize 1
                              ]
                            |));
                          ("end_",
                            M.call_closure (|
                              Ty.path "usize",
                              BinOp.Wrap.add,
                              [ M.read (| new_len |); Value.Integer IntegerKind.Usize 1 ]
                            |))
                        ]
                    ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_insert_fit :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "insert_fit" (insert_fit K V).
        Admitted.
        Global Typeclasses Opaque insert_fit.
        
        (*
            fn insert<A: Allocator + Clone>(
                mut self,
                key: K,
                val: V,
                edge: Root<K, V>,
                alloc: A,
            ) -> Option<SplitResult<'a, K, V, marker::Internal>> {
                assert!(edge.height == self.node.height - 1);
        
                if self.node.len() < CAPACITY {
                    self.insert_fit(key, val, edge);
                    None
                } else {
                    let (middle_kv_idx, insertion) = splitpoint(self.idx);
                    let middle = unsafe { Handle::new_kv(self.node, middle_kv_idx) };
                    let mut result = middle.split(alloc);
                    let mut insertion_edge = match insertion {
                        LeftOrRight::Left(insert_idx) => unsafe {
                            Handle::new_edge(result.left.reborrow_mut(), insert_idx)
                        },
                        LeftOrRight::Right(insert_idx) => unsafe {
                            Handle::new_edge(result.right.borrow_mut(), insert_idx)
                        },
                    };
                    insertion_edge.insert_fit(key, val, edge);
                    Some(result)
                }
            }
        *)
        Definition insert (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; key; val; edge; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              let key := M.alloc (| K, key |) in
              let val := M.alloc (| V, val |) in
              let edge :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Owned";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  edge
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.eq,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            edge,
                                            "alloc::collections::btree::node::NodeRef",
                                            "height"
                                          |)
                                        |);
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.sub,
                                          [
                                            M.read (|
                                              M.SubPointer.get_struct_record_field (|
                                                M.SubPointer.get_struct_record_field (|
                                                  self,
                                                  "alloc::collections::btree::node::Handle",
                                                  "node"
                                                |),
                                                "alloc::collections::btree::node::NodeRef",
                                                "height"
                                              |)
                                            |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: edge.height == self.node.height - 1" |)
                              ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "core::option::Option")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::SplitResult")
                        []
                        [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ]
                    ],
                  M.match_operator (|
                    Ty.apply
                      (Ty.path "core::option::Option")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::SplitResult")
                          []
                          [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ]
                      ],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  BinOp.lt,
                                  [
                                    M.call_closure (|
                                      Ty.path "usize",
                                      M.get_associated_function (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::Internal"
                                          ],
                                        "len",
                                        [],
                                        []
                                      |),
                                      [
                                        M.borrow (|
                                          Pointer.Kind.Ref,
                                          M.SubPointer.get_struct_record_field (|
                                            self,
                                            "alloc::collections::btree::node::Handle",
                                            "node"
                                          |)
                                        |)
                                      ]
                                    |);
                                    M.read (|
                                      get_constant (|
                                        "alloc::collections::btree::node::CAPACITY",
                                        Ty.path "usize"
                                      |)
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::Handle")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::Internal"
                                        ];
                                      Ty.path "alloc::collections::btree::node::marker::Edge"
                                    ],
                                  "insert_fit",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (| Pointer.Kind.MutRef, self |);
                                  M.read (| key |);
                                  M.read (| val |);
                                  M.read (| edge |)
                                ]
                              |) in
                            M.alloc (|
                              Ty.apply
                                (Ty.path "core::option::Option")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ]
                                ],
                              Value.StructTuple
                                "core::option::Option::None"
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::SplitResult")
                                    []
                                    [
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ]
                                ]
                                []
                            |)
                          |)));
                      fun γ =>
                        ltac:(M.monadic
                          (M.match_operator (|
                            Ty.apply
                              (Ty.path "core::option::Option")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::SplitResult")
                                  []
                                  [
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ]
                              ],
                            M.alloc (|
                              Ty.tuple
                                [
                                  Ty.path "usize";
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                    []
                                    [ Ty.path "usize" ]
                                ],
                              M.call_closure (|
                                Ty.tuple
                                  [
                                    Ty.path "usize";
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                      []
                                      [ Ty.path "usize" ]
                                  ],
                                M.get_function (|
                                  "alloc::collections::btree::node::splitpoint",
                                  [],
                                  []
                                |),
                                [
                                  M.read (|
                                    M.SubPointer.get_struct_record_field (|
                                      self,
                                      "alloc::collections::btree::node::Handle",
                                      "idx"
                                    |)
                                  |)
                                ]
                              |)
                            |),
                            [
                              fun γ =>
                                ltac:(M.monadic
                                  (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                                  let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                                  let middle_kv_idx := M.copy (| Ty.path "usize", γ0_0 |) in
                                  let insertion :=
                                    M.copy (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::LeftOrRight")
                                        []
                                        [ Ty.path "usize" ],
                                      γ0_1
                                    |) in
                                  M.read (|
                                    let~ middle :
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::KV"
                                          ] :=
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::KV"
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::Handle")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ];
                                              Ty.path "alloc::collections::btree::node::marker::KV"
                                            ],
                                          "new_kv",
                                          [],
                                          []
                                        |),
                                        [
                                          M.read (|
                                            M.SubPointer.get_struct_record_field (|
                                              self,
                                              "alloc::collections::btree::node::Handle",
                                              "node"
                                            |)
                                          |);
                                          M.read (| middle_kv_idx |)
                                        ]
                                      |) in
                                    let~ result :
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::SplitResult")
                                          []
                                          [
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::Internal"
                                          ] :=
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::SplitResult")
                                          []
                                          [
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::Internal"
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::Handle")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ];
                                              Ty.path "alloc::collections::btree::node::marker::KV"
                                            ],
                                          "split",
                                          [],
                                          [ A ]
                                        |),
                                        [ M.read (| middle |); M.read (| alloc |) ]
                                      |) in
                                    let~ insertion_edge :
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::Edge"
                                          ] :=
                                      M.match_operator (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::Handle")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ];
                                            Ty.path "alloc::collections::btree::node::marker::Edge"
                                          ],
                                        insertion,
                                        [
                                          fun γ =>
                                            ltac:(M.monadic
                                              (let γ0_0 :=
                                                M.SubPointer.get_struct_tuple_field (|
                                                  γ,
                                                  "alloc::collections::btree::node::LeftOrRight::Left",
                                                  0
                                                |) in
                                              let insert_idx :=
                                                M.copy (| Ty.path "usize", γ0_0 |) in
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::Handle")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ];
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Edge"
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::Handle")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ];
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Edge"
                                                    ],
                                                  "new_edge",
                                                  [],
                                                  []
                                                |),
                                                [
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "reborrow_mut",
                                                      [],
                                                      []
                                                    |),
                                                    [
                                                      M.borrow (|
                                                        Pointer.Kind.MutRef,
                                                        M.SubPointer.get_struct_record_field (|
                                                          result,
                                                          "alloc::collections::btree::node::SplitResult",
                                                          "left"
                                                        |)
                                                      |)
                                                    ]
                                                  |);
                                                  M.read (| insert_idx |)
                                                ]
                                              |)));
                                          fun γ =>
                                            ltac:(M.monadic
                                              (let γ0_0 :=
                                                M.SubPointer.get_struct_tuple_field (|
                                                  γ,
                                                  "alloc::collections::btree::node::LeftOrRight::Right",
                                                  0
                                                |) in
                                              let insert_idx :=
                                                M.copy (| Ty.path "usize", γ0_0 |) in
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::Handle")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ];
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Edge"
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::Handle")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ];
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Edge"
                                                    ],
                                                  "new_edge",
                                                  [],
                                                  []
                                                |),
                                                [
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::NodeRef")
                                                      []
                                                      [
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Mut";
                                                        K;
                                                        V;
                                                        Ty.path
                                                          "alloc::collections::btree::node::marker::Internal"
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Owned";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "borrow_mut",
                                                      [],
                                                      []
                                                    |),
                                                    [
                                                      M.borrow (|
                                                        Pointer.Kind.MutRef,
                                                        M.SubPointer.get_struct_record_field (|
                                                          result,
                                                          "alloc::collections::btree::node::SplitResult",
                                                          "right"
                                                        |)
                                                      |)
                                                    ]
                                                  |);
                                                  M.read (| insert_idx |)
                                                ]
                                              |)))
                                        ]
                                      |) in
                                    let~ _ : Ty.tuple [] :=
                                      M.call_closure (|
                                        Ty.tuple [],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::Handle")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ];
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Edge"
                                            ],
                                          "insert_fit",
                                          [],
                                          []
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, insertion_edge |);
                                          M.read (| key |);
                                          M.read (| val |);
                                          M.read (| edge |)
                                        ]
                                      |) in
                                    M.alloc (|
                                      Ty.apply
                                        (Ty.path "core::option::Option")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::SplitResult")
                                            []
                                            [
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ]
                                        ],
                                      Value.StructTuple
                                        "core::option::Option::Some"
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::SplitResult")
                                            []
                                            [
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ]
                                        ]
                                        [ M.read (| result |) ]
                                    |)
                                  |)))
                            ]
                          |)))
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_insert :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "insert" (insert K V).
        Admitted.
        Global Typeclasses Opaque insert.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_Edge.
      
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_Edge.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            pub fn descend(self) -> NodeRef<BorrowType, K, V, marker::LeafOrInternal> {
                const {
                    assert!(BorrowType::TRAVERSAL_PERMIT);
                }
        
                // We need to use raw pointers to nodes because, if BorrowType is
                // marker::ValMut, there might be outstanding mutable references to
                // values that we must not invalidate. There's no worry accessing the
                // height field because that value is copied. Beware that, once the
                // node pointer is dereferenced, we access the edges array with a
                // reference (Rust issue #73987) and invalidate any other references
                // to or inside the array, should any be around.
                let parent_ptr = NodeRef::as_internal_ptr(&self.node);
                let node = unsafe { ( *parent_ptr).edges.get_unchecked(self.idx).assume_init_read() };
                NodeRef { node, height: self.node.height - 1, _marker: PhantomData }
            }
        *)
        Definition descend
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.read (|
                    get_constant (|
                      "alloc::collections::btree::node::descend_discriminant",
                      Ty.tuple []
                    |)
                  |) in
                let~ parent_ptr :
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "*mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "as_internal_ptr",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ node :
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "core::ptr::non_null::NonNull")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                        []
                        [
                          Ty.apply
                            (Ty.path "core::ptr::non_null::NonNull")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::LeafNode")
                                []
                                [ K; V ]
                            ]
                        ],
                      "assume_init_read",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&")
                              []
                              [
                                Ty.apply
                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::ptr::non_null::NonNull")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::LeafNode")
                                            []
                                            [ K; V ]
                                        ]
                                    ]
                                ],
                              "get_unchecked",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::ptr::non_null::NonNull")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::LeafNode")
                                                  []
                                                  [ K; V ]
                                              ]
                                          ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 12 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::ptr::non_null::NonNull")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::LeafNode")
                                                    []
                                                    [ K; V ]
                                                ]
                                            ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::ptr::non_null::NonNull")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::LeafNode")
                                                    []
                                                    [ K; V ]
                                                ]
                                            ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.Ref,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| parent_ptr |) |),
                                      "alloc::collections::btree::node::InternalNode",
                                      "edges"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      BorrowType;
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::NodeRef"
                    []
                    [
                      BorrowType;
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ]
                    [
                      ("node", M.read (| node |));
                      ("height",
                        M.call_closure (|
                          Ty.path "usize",
                          BinOp.Wrap.sub,
                          [
                            M.read (|
                              M.SubPointer.get_struct_record_field (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |),
                                "alloc::collections::btree::node::NodeRef",
                                "height"
                              |)
                            |);
                            Value.Integer IntegerKind.Usize 1
                          ]
                        |));
                      ("_marker",
                        Value.StructTuple
                          "core::marker::PhantomData"
                          []
                          [
                            Ty.tuple
                              [
                                BorrowType;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ]
                          ]
                          [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_descend :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V) "descend" (descend BorrowType K V).
        Admitted.
        Global Typeclasses Opaque descend.
        (*
            pub fn forget_node_type(
                self,
            ) -> Handle<NodeRef<BorrowType, K, V, marker::LeafOrInternal>, marker::Edge> {
                unsafe { Handle::new_edge(self.node.forget_type(), self.idx) }
            }
        *)
        Definition forget_node_type
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ];
                    Ty.path "alloc::collections::btree::node::marker::Edge"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  "new_edge",
                  [],
                  []
                |),
                [
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "forget_type",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |);
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_node_type :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V)
            "forget_node_type"
            (forget_node_type BorrowType K V).
        Admitted.
        Global Typeclasses Opaque forget_node_type.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_Edge.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
        Definition Self (K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn into_kv(self) -> (&'a K, &'a V) {
                debug_assert!(self.idx < self.node.len());
                let leaf = self.node.into_leaf();
                let k = unsafe { leaf.keys.get_unchecked(self.idx).assume_init_ref() };
                let v = unsafe { leaf.vals.get_unchecked(self.idx).assume_init_ref() };
                (k, v)
            }
        *)
        Definition into_kv
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; NodeType
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Immut";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Immut"; K; V; NodeType
                        ],
                      "into_leaf",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ k : Ty.apply (Ty.path "&") [] [ K ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&") [] [ K ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_ref",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ],
                              "get_unchecked",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.Ref,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "keys"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ v : Ty.apply (Ty.path "&") [] [ V ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&") [] [ V ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "assume_init_ref",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ],
                              "get_unchecked",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.Ref,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "vals"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.tuple [ Ty.apply (Ty.path "&") [] [ K ]; Ty.apply (Ty.path "&") [] [ V ] ],
                  Value.Tuple
                    [
                      M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| k |) |) |);
                      M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| v |) |) |)
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_kv :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "into_kv" (into_kv K V NodeType).
        Admitted.
        Global Typeclasses Opaque into_kv.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Immut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
        Definition Self (K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn key_mut(&mut self) -> &mut K {
                unsafe { self.node.key_area_mut(self.idx).assume_init_mut() }
            }
        *)
        Definition key_mut
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ]
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply (Ty.path "&mut") [] [ K ],
                            M.get_associated_function (|
                              Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                              "assume_init_mut",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          NodeType
                                        ],
                                      "key_area_mut",
                                      [],
                                      [
                                        Ty.path "usize";
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (| M.read (| self |) |),
                                          "alloc::collections::btree::node::Handle",
                                          "node"
                                        |)
                                      |);
                                      M.read (|
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (| M.read (| self |) |),
                                          "alloc::collections::btree::node::Handle",
                                          "idx"
                                        |)
                                      |)
                                    ]
                                  |)
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_key_mut :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "key_mut" (key_mut K V NodeType).
        Admitted.
        Global Typeclasses Opaque key_mut.
        
        (*
            pub fn into_val_mut(self) -> &'a mut V {
                debug_assert!(self.idx < self.node.len());
                let leaf = self.node.into_leaf_mut();
                unsafe { leaf.vals.get_unchecked_mut(self.idx).assume_init_mut() }
            }
        *)
        Definition into_val_mut
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.borrow (|
                Pointer.Kind.MutRef,
                M.deref (|
                  M.read (|
                    let~ _ : Ty.tuple [] :=
                      M.match_operator (|
                        Ty.tuple [],
                        M.alloc (| Ty.tuple [], Value.Tuple [] |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                              let _ :=
                                is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                              M.read (|
                                let~ _ : Ty.tuple [] :=
                                  M.match_operator (|
                                    Ty.tuple [],
                                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                    [
                                      fun γ =>
                                        ltac:(M.monadic
                                          (let γ :=
                                            M.use
                                              (M.alloc (|
                                                Ty.path "bool",
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  UnOp.not,
                                                  [
                                                    M.call_closure (|
                                                      Ty.path "bool",
                                                      BinOp.lt,
                                                      [
                                                        M.read (|
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "idx"
                                                          |)
                                                        |);
                                                        M.call_closure (|
                                                          Ty.path "usize",
                                                          M.get_associated_function (|
                                                            Ty.apply
                                                              (Ty.path
                                                                "alloc::collections::btree::node::NodeRef")
                                                              []
                                                              [
                                                                Ty.path
                                                                  "alloc::collections::btree::node::marker::Mut";
                                                                K;
                                                                V;
                                                                NodeType
                                                              ],
                                                            "len",
                                                            [],
                                                            []
                                                          |),
                                                          [
                                                            M.borrow (|
                                                              Pointer.Kind.Ref,
                                                              M.SubPointer.get_struct_record_field (|
                                                                self,
                                                                "alloc::collections::btree::node::Handle",
                                                                "node"
                                                              |)
                                                            |)
                                                          ]
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              |)) in
                                          let _ :=
                                            is_constant_or_break_match (|
                                              M.read (| γ |),
                                              Value.Bool true
                                            |) in
                                          M.never_to_any (|
                                            M.call_closure (|
                                              Ty.path "never",
                                              M.get_function (| "core::panicking::panic", [], [] |),
                                              [
                                                mk_str (|
                                                  "assertion failed: self.idx < self.node.len()"
                                                |)
                                              ]
                                            |)
                                          |)));
                                      fun γ => ltac:(M.monadic (Value.Tuple []))
                                    ]
                                  |) in
                                M.alloc (| Ty.tuple [], Value.Tuple [] |)
                              |)));
                          fun γ => ltac:(M.monadic (Value.Tuple []))
                        ]
                      |) in
                    let~ leaf :
                        Ty.apply
                          (Ty.path "&mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ] :=
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "&mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ],
                          "into_leaf_mut",
                          [],
                          []
                        |),
                        [
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |) in
                    M.alloc (|
                      Ty.apply (Ty.path "&mut") [] [ V ],
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply (Ty.path "&mut") [] [ V ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                    []
                                    [ V ],
                                  "assume_init_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ V ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ V ]
                                            ],
                                          "get_unchecked_mut",
                                          [],
                                          [ Ty.path "usize" ]
                                        |),
                                        [
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ],
                                            M.pointer_coercion
                                              M.PointerCoercion.Unsize
                                              (Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path "array")
                                                    [ Value.Integer IntegerKind.Usize 11 ]
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "core::mem::maybe_uninit::MaybeUninit")
                                                        []
                                                        [ V ]
                                                    ]
                                                ])
                                              (Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path "slice")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "core::mem::maybe_uninit::MaybeUninit")
                                                        []
                                                        [ V ]
                                                    ]
                                                ]),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.SubPointer.get_struct_record_field (|
                                                  M.deref (| M.read (| leaf |) |),
                                                  "alloc::collections::btree::node::LeafNode",
                                                  "vals"
                                                |)
                                              |)
                                            ]
                                          |);
                                          M.read (|
                                            M.SubPointer.get_struct_record_field (|
                                              self,
                                              "alloc::collections::btree::node::Handle",
                                              "idx"
                                            |)
                                          |)
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |)
                            |)
                          |)
                        |)
                      |)
                    |)
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_val_mut :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "into_val_mut" (into_val_mut K V NodeType).
        Admitted.
        Global Typeclasses Opaque into_val_mut.
        
        (*
            pub fn into_kv_mut(self) -> (&'a mut K, &'a mut V) {
                debug_assert!(self.idx < self.node.len());
                let leaf = self.node.into_leaf_mut();
                let k = unsafe { leaf.keys.get_unchecked_mut(self.idx).assume_init_mut() };
                let v = unsafe { leaf.vals.get_unchecked_mut(self.idx).assume_init_mut() };
                (k, v)
            }
        *)
        Definition into_kv_mut
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ],
                      "into_leaf_mut",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ k : Ty.apply (Ty.path "&mut") [] [ K ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ K ],
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                          "assume_init_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "slice")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ K ]
                                    ],
                                  "get_unchecked_mut",
                                  [],
                                  [ Ty.path "usize" ]
                                |),
                                [
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ K ]
                                          ]
                                      ],
                                    M.pointer_coercion
                                      M.PointerCoercion.Unsize
                                      (Ty.apply
                                        (Ty.path "&mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "array")
                                            [ Value.Integer IntegerKind.Usize 11 ]
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ K ]
                                            ]
                                        ])
                                      (Ty.apply
                                        (Ty.path "&mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ K ]
                                            ]
                                        ]),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (| M.read (| leaf |) |),
                                          "alloc::collections::btree::node::LeafNode",
                                          "keys"
                                        |)
                                      |)
                                    ]
                                  |);
                                  M.read (|
                                    M.SubPointer.get_struct_record_field (|
                                      self,
                                      "alloc::collections::btree::node::Handle",
                                      "idx"
                                    |)
                                  |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |)
                    |)
                  |) in
                let~ v : Ty.apply (Ty.path "&mut") [] [ V ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ V ],
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                          "assume_init_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "slice")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ V ]
                                    ],
                                  "get_unchecked_mut",
                                  [],
                                  [ Ty.path "usize" ]
                                |),
                                [
                                  M.call_closure (|
                                    Ty.apply
                                      (Ty.path "&mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "slice")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ V ]
                                          ]
                                      ],
                                    M.pointer_coercion
                                      M.PointerCoercion.Unsize
                                      (Ty.apply
                                        (Ty.path "&mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "array")
                                            [ Value.Integer IntegerKind.Usize 11 ]
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ V ]
                                            ]
                                        ])
                                      (Ty.apply
                                        (Ty.path "&mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ V ]
                                            ]
                                        ]),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.SubPointer.get_struct_record_field (|
                                          M.deref (| M.read (| leaf |) |),
                                          "alloc::collections::btree::node::LeafNode",
                                          "vals"
                                        |)
                                      |)
                                    ]
                                  |);
                                  M.read (|
                                    M.SubPointer.get_struct_record_field (|
                                      self,
                                      "alloc::collections::btree::node::Handle",
                                      "idx"
                                    |)
                                  |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |)
                    |)
                  |) in
                M.alloc (|
                  Ty.tuple
                    [ Ty.apply (Ty.path "&mut") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                  Value.Tuple
                    [
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| k |) |) |);
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| v |) |) |)
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_kv_mut :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "into_kv_mut" (into_kv_mut K V NodeType).
        Admitted.
        Global Typeclasses Opaque into_kv_mut.
        (*
            pub fn kv_mut(&mut self) -> (&mut K, &mut V) {
                debug_assert!(self.idx < self.node.len());
                // We cannot call separate key and value methods, because calling the second one
                // invalidates the reference returned by the first.
                unsafe {
                    let leaf = self.node.as_leaf_mut();
                    let key = leaf.keys.get_unchecked_mut(self.idx).assume_init_mut();
                    let val = leaf.vals.get_unchecked_mut(self.idx).assume_init_mut();
                    (key, val)
                }
            }
        *)
        Definition kv_mut
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ]
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        M.deref (| M.read (| self |) |),
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            M.deref (| M.read (| self |) |),
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ],
                      "as_leaf_mut",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ key : Ty.apply (Ty.path "&mut") [] [ K ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ K ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_mut",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "keys"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ val : Ty.apply (Ty.path "&mut") [] [ V ] :=
                  M.call_closure (|
                    Ty.apply (Ty.path "&mut") [] [ V ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "assume_init_mut",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "vals"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.tuple
                    [ Ty.apply (Ty.path "&mut") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                  Value.Tuple
                    [
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| key |) |) |);
                      M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| val |) |) |)
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_kv_mut :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "kv_mut" (kv_mut K V NodeType).
        Admitted.
        Global Typeclasses Opaque kv_mut.
        
        (*
            pub fn replace_kv(&mut self, k: K, v: V) -> (K, V) {
                let (key, val) = self.kv_mut();
                (mem::replace(key, k), mem::replace(val, v))
            }
        *)
        Definition replace_kv
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self; k; v ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ]
                    ],
                  self
                |) in
              let k := M.alloc (| K, k |) in
              let v := M.alloc (| V, v |) in
              M.match_operator (|
                Ty.tuple [ K; V ],
                M.alloc (|
                  Ty.tuple
                    [ Ty.apply (Ty.path "&mut") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                  M.call_closure (|
                    Ty.tuple
                      [ Ty.apply (Ty.path "&mut") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "kv_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                  |)
                |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                      let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                      let key := M.copy (| Ty.apply (Ty.path "&mut") [] [ K ], γ0_0 |) in
                      let val := M.copy (| Ty.apply (Ty.path "&mut") [] [ V ], γ0_1 |) in
                      Value.Tuple
                        [
                          M.call_closure (|
                            K,
                            M.get_function (| "core::mem::replace", [], [ K ] |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| key |) |) |);
                              M.read (| k |)
                            ]
                          |);
                          M.call_closure (|
                            V,
                            M.get_function (| "core::mem::replace", [], [ V ] |),
                            [
                              M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| val |) |) |);
                              M.read (| v |)
                            ]
                          |)
                        ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_replace_kv :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "replace_kv" (replace_kv K V NodeType).
        Admitted.
        Global Typeclasses Opaque replace_kv.
        (*
            fn split_leaf_data(&mut self, new_node: &mut LeafNode<K, V>) -> (K, V) {
                debug_assert!(self.idx < self.node.len());
                let old_len = self.node.len();
                let new_len = old_len - self.idx - 1;
                new_node.len = new_len as u16;
                unsafe {
                    let k = self.node.key_area_mut(self.idx).assume_init_read();
                    let v = self.node.val_area_mut(self.idx).assume_init_read();
        
                    move_to_slice(
                        self.node.key_area_mut(self.idx + 1..old_len),
                        &mut new_node.keys[..new_len],
                    );
                    move_to_slice(
                        self.node.val_area_mut(self.idx + 1..old_len),
                        &mut new_node.vals[..new_len],
                    );
        
                    *self.node.len_mut() = self.idx as u16;
                    (k, v)
                }
            }
        *)
        Definition split_leaf_data
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self; new_node ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ]
                    ],
                  self
                |) in
              let new_node :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ] ],
                  new_node
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        M.deref (| M.read (| self |) |),
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Mut";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            M.deref (| M.read (| self |) |),
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ old_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ],
                      "len",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ new_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.sub,
                    [
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.sub,
                        [
                          M.read (| old_len |);
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::Handle",
                              "idx"
                            |)
                          |)
                        ]
                      |);
                      Value.Integer IntegerKind.Usize 1
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| new_node |) |),
                      "alloc::collections::btree::node::LeafNode",
                      "len"
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_len |))
                  |) in
                let~ k : K :=
                  M.call_closure (|
                    K,
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_read",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  NodeType
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ v : V :=
                  M.call_closure (|
                    V,
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "assume_init_read",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  NodeType
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.path "usize";
                                Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (|
                      "alloc::collections::btree::node::move_to_slice",
                      [],
                      [ K ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  NodeType
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.apply (Ty.path "core::ops::range::Range") [] [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::Range"
                                []
                                [ Ty.path "usize" ]
                                [
                                  ("start",
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            M.deref (| M.read (| self |) |),
                                            "alloc::collections::btree::node::Handle",
                                            "idx"
                                          |)
                                        |);
                                        Value.Integer IntegerKind.Usize 1
                                      ]
                                    |));
                                  ("end_", M.read (| old_len |))
                                ]
                            ]
                          |)
                        |)
                      |);
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.get_trait_method (|
                                  "core::ops::index::IndexMut",
                                  Ty.apply
                                    (Ty.path "array")
                                    [ Value.Integer IntegerKind.Usize 11 ]
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ K ]
                                    ],
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ]
                                  ],
                                  "index_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| new_node |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "keys"
                                    |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [ ("end_", M.read (| new_len |)) ]
                                ]
                              |)
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (|
                      "alloc::collections::btree::node::move_to_slice",
                      [],
                      [ V ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  NodeType
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.apply (Ty.path "core::ops::range::Range") [] [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::Range"
                                []
                                [ Ty.path "usize" ]
                                [
                                  ("start",
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            M.deref (| M.read (| self |) |),
                                            "alloc::collections::btree::node::Handle",
                                            "idx"
                                          |)
                                        |);
                                        Value.Integer IntegerKind.Usize 1
                                      ]
                                    |));
                                  ("end_", M.read (| old_len |))
                                ]
                            ]
                          |)
                        |)
                      |);
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.get_trait_method (|
                                  "core::ops::index::IndexMut",
                                  Ty.apply
                                    (Ty.path "array")
                                    [ Value.Integer IntegerKind.Usize 11 ]
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ V ]
                                    ],
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ]
                                  ],
                                  "index_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| new_node |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "vals"
                                    |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [ ("end_", M.read (| new_len |)) ]
                                ]
                              |)
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |)
                    |),
                    M.cast
                      (Ty.path "u16")
                      (M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.deref (| M.read (| self |) |),
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |))
                  |) in
                M.alloc (| Ty.tuple [ K; V ], Value.Tuple [ M.read (| k |); M.read (| v |) ] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_split_leaf_data :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V NodeType)
            "split_leaf_data"
            (split_leaf_data K V NodeType).
        Admitted.
        Global Typeclasses Opaque split_leaf_data.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
        Definition Self (K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn into_kv_valmut(self) -> (&'a K, &'a mut V) {
                unsafe { self.node.into_key_val_mut_at(self.idx) }
            }
        *)
        Definition into_kv_valmut
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; NodeType
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.tuple [ Ty.apply (Ty.path "&") [] [ K ]; Ty.apply (Ty.path "&mut") [] [ V ] ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [ Ty.path "alloc::collections::btree::node::marker::ValMut"; K; V; NodeType ],
                  "into_key_val_mut_at",
                  [],
                  []
                |),
                [
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "node"
                    |)
                  |);
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_kv_valmut :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V NodeType)
            "into_kv_valmut"
            (into_kv_valmut K V NodeType).
        Admitted.
        Global Typeclasses Opaque into_kv_valmut.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_ValMut_K_V_NodeType_alloc_collections_btree_node_marker_KV.
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_NodeType_alloc_collections_btree_node_marker_KV.
        Definition Self (K V NodeType : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; NodeType ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub unsafe fn into_key_val(mut self) -> (K, V) {
                debug_assert!(self.idx < self.node.len());
                let leaf = self.node.as_leaf_dying();
                unsafe {
                    let key = leaf.keys.get_unchecked_mut(self.idx).assume_init_read();
                    let val = leaf.vals.get_unchecked_mut(self.idx).assume_init_read();
                    (key, val)
                }
            }
        *)
        Definition into_key_val
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; NodeType
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Dying";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; NodeType
                        ],
                      "as_leaf_dying",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ key : K :=
                  M.call_closure (|
                    K,
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_read",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ K ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "keys"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ val : V :=
                  M.call_closure (|
                    V,
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                      "assume_init_read",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ],
                              "get_unchecked_mut",
                              [],
                              [ Ty.path "usize" ]
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.pointer_coercion
                                  M.PointerCoercion.Unsize
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "array")
                                        [ Value.Integer IntegerKind.Usize 11 ]
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ])
                                  (Ty.apply
                                    (Ty.path "&mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "slice")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ V ]
                                        ]
                                    ]),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| leaf |) |),
                                      "alloc::collections::btree::node::LeafNode",
                                      "vals"
                                    |)
                                  |)
                                ]
                              |);
                              M.read (|
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "idx"
                                |)
                              |)
                            ]
                          |)
                        |)
                      |)
                    ]
                  |) in
                M.alloc (| Ty.tuple [ K; V ], Value.Tuple [ M.read (| key |); M.read (| val |) ] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_key_val :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "into_key_val" (into_key_val K V NodeType).
        Admitted.
        Global Typeclasses Opaque into_key_val.
        
        (*
            pub unsafe fn drop_key_val(mut self) {
                // Run the destructor of the value even if the destructor of the key panics.
                struct Dropper<'a, T>(&'a mut MaybeUninit<T>);
                impl<T> Drop for Dropper<'_, T> {
                    #[inline]
                    fn drop(&mut self) {
                        unsafe {
                            self.0.assume_init_drop();
                        }
                    }
                }
        
                debug_assert!(self.idx < self.node.len());
                let leaf = self.node.as_leaf_dying();
                unsafe {
                    let key = leaf.keys.get_unchecked_mut(self.idx);
                    let val = leaf.vals.get_unchecked_mut(self.idx);
                    let _guard = Dropper(val);
                    key.assume_init_drop();
                    // dropping the guard will drop the value
                }
            }
        *)
        Definition drop_key_val
            (K V NodeType : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V NodeType in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; NodeType
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              UnOp.not,
                                              [
                                                M.call_closure (|
                                                  Ty.path "bool",
                                                  BinOp.lt,
                                                  [
                                                    M.read (|
                                                      M.SubPointer.get_struct_record_field (|
                                                        self,
                                                        "alloc::collections::btree::node::Handle",
                                                        "idx"
                                                      |)
                                                    |);
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      M.get_associated_function (|
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::NodeRef")
                                                          []
                                                          [
                                                            Ty.path
                                                              "alloc::collections::btree::node::marker::Dying";
                                                            K;
                                                            V;
                                                            NodeType
                                                          ],
                                                        "len",
                                                        [],
                                                        []
                                                      |),
                                                      [
                                                        M.borrow (|
                                                          Pointer.Kind.Ref,
                                                          M.SubPointer.get_struct_record_field (|
                                                            self,
                                                            "alloc::collections::btree::node::Handle",
                                                            "node"
                                                          |)
                                                        |)
                                                      ]
                                                    |)
                                                  ]
                                                |)
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [
                                            mk_str (|
                                              "assertion failed: self.idx < self.node.len()"
                                            |)
                                          ]
                                        |)
                                      |)));
                                  fun γ => ltac:(M.monadic (Value.Tuple []))
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ leaf :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ Ty.path "alloc::collections::btree::node::marker::Dying"; K; V; NodeType
                        ],
                      "as_leaf_dying",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ key :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "slice")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ],
                      "get_unchecked_mut",
                      [],
                      [ Ty.path "usize" ]
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "&mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "slice")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ] ]
                          ],
                        M.pointer_coercion
                          M.PointerCoercion.Unsize
                          (Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "array")
                                [ Value.Integer IntegerKind.Usize 11 ]
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ]
                            ])
                          (Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ]
                                ]
                            ]),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| leaf |) |),
                              "alloc::collections::btree::node::LeafNode",
                              "keys"
                            |)
                          |)
                        ]
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |)
                    ]
                  |) in
                let~ val :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "slice")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ],
                      "get_unchecked_mut",
                      [],
                      [ Ty.path "usize" ]
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "&mut")
                          []
                          [
                            Ty.apply
                              (Ty.path "slice")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ] ]
                          ],
                        M.pointer_coercion
                          M.PointerCoercion.Unsize
                          (Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "array")
                                [ Value.Integer IntegerKind.Usize 11 ]
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ]
                            ])
                          (Ty.apply
                            (Ty.path "&mut")
                            []
                            [
                              Ty.apply
                                (Ty.path "slice")
                                []
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ]
                                ]
                            ]),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| leaf |) |),
                              "alloc::collections::btree::node::LeafNode",
                              "vals"
                            |)
                          |)
                        ]
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |)
                    ]
                  |) in
                let~ _guard :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::drop_key_val::Dropper")
                      []
                      [ V ] :=
                  Value.StructTuple
                    "alloc::collections::btree::node::drop_key_val::Dropper"
                    []
                    [ V ]
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| val |) |) |) ] in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                      "assume_init_drop",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| key |) |) |) ]
                  |) in
                M.alloc (| Ty.tuple [], Value.Tuple [] |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_drop_key_val :
          forall (K V NodeType : Ty.t),
          M.IsAssociatedFunction.C (Self K V NodeType) "drop_key_val" (drop_key_val K V NodeType).
        Admitted.
        Global Typeclasses Opaque drop_key_val.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Dying_K_V_NodeType_alloc_collections_btree_node_marker_KV.
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_KV.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn split<A: Allocator + Clone>(mut self, alloc: A) -> SplitResult<'a, K, V, marker::Leaf> {
                let mut new_node = LeafNode::new(alloc);
        
                let kv = self.split_leaf_data(&mut new_node);
        
                let right = NodeRef::from_new_leaf(new_node);
                SplitResult { left: self.node, kv, right }
            }
        *)
        Definition split (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ new_node :
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ];
                        A
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply (Ty.path "alloc::collections::btree::node::LeafNode") [] [ K; V ],
                      "new",
                      [],
                      [ A ]
                    |),
                    [ M.read (| alloc |) ]
                  |) in
                let~ kv : Ty.tuple [ K; V ] :=
                  M.call_closure (|
                    Ty.tuple [ K; V ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "split_leaf_data",
                      [],
                      []
                    |),
                    [
                      M.borrow (| Pointer.Kind.MutRef, self |);
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.read (| M.deref (| M.borrow (| Pointer.Kind.MutRef, new_node |) |) |)
                        |)
                      |)
                    ]
                  |) in
                let~ right :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "from_new_leaf",
                      [],
                      [ A ]
                    |),
                    [ M.read (| new_node |) ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::SplitResult")
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::SplitResult"
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ]
                    [
                      ("left",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |));
                      ("kv", M.read (| kv |));
                      ("right", M.read (| right |))
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_split :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "split" (split K V).
        Admitted.
        Global Typeclasses Opaque split.
        
        (*
            pub fn remove(
                mut self,
            ) -> ((K, V), Handle<NodeRef<marker::Mut<'a>, K, V, marker::Leaf>, marker::Edge>) {
                let old_len = self.node.len();
                unsafe {
                    let k = slice_remove(self.node.key_area_mut(..old_len), self.idx);
                    let v = slice_remove(self.node.val_area_mut(..old_len), self.idx);
                    *self.node.len_mut() = (old_len - 1) as u16;
                    ((k, v), self.left_edge())
                }
            }
        *)
        Definition remove (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ old_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ k : K :=
                  M.call_closure (|
                    K,
                    M.get_function (| "alloc::collections::btree::node::slice_remove", [], [ K ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "key_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| old_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |)
                    ]
                  |) in
                let~ v : V :=
                  M.call_closure (|
                    V,
                    M.get_function (| "alloc::collections::btree::node::slice_remove", [], [ V ] |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ],
                              "val_area_mut",
                              [],
                              [
                                Ty.apply
                                  (Ty.path "core::ops::range::RangeTo")
                                  []
                                  [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::RangeTo"
                                []
                                [ Ty.path "usize" ]
                                [ ("end_", M.read (| old_len |)) ]
                            ]
                          |)
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::Handle",
                              "node"
                            |)
                          |)
                        ]
                      |)
                    |),
                    M.cast
                      (Ty.path "u16")
                      (M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.sub,
                        [ M.read (| old_len |); Value.Integer IntegerKind.Usize 1 ]
                      |))
                  |) in
                M.alloc (|
                  Ty.tuple
                    [
                      Ty.tuple [ K; V ];
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ]
                    ],
                  Value.Tuple
                    [
                      Value.Tuple [ M.read (| k |); M.read (| v |) ];
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Leaf"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::KV"
                            ],
                          "left_edge",
                          [],
                          []
                        |),
                        [ M.read (| self |) ]
                      |)
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_remove :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "remove" (remove K V).
        Admitted.
        Global Typeclasses Opaque remove.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_KV.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_KV.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::Internal"
                ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn split<A: Allocator + Clone>(
                mut self,
                alloc: A,
            ) -> SplitResult<'a, K, V, marker::Internal> {
                let old_len = self.node.len();
                unsafe {
                    let mut new_node = InternalNode::new(alloc);
                    let kv = self.split_leaf_data(&mut new_node.data);
                    let new_len = usize::from(new_node.data.len);
                    move_to_slice(
                        self.node.edge_area_mut(self.idx + 1..old_len + 1),
                        &mut new_node.edges[..new_len + 1],
                    );
        
                    let height = self.node.height;
                    let right = NodeRef::from_new_internal(new_node, height);
        
                    SplitResult { left: self.node, kv, right }
                }
            }
        *)
        Definition split (K V : Ty.t) (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ old_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                let~ new_node :
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ];
                        A
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::boxed::Box")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::InternalNode")
                          []
                          [ K; V ];
                        A
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::InternalNode")
                        []
                        [ K; V ],
                      "new",
                      [],
                      [ A ]
                    |),
                    [ M.read (| alloc |) ]
                  |) in
                let~ kv : Ty.tuple [ K; V ] :=
                  M.call_closure (|
                    Ty.tuple [ K; V ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::KV"
                        ],
                      "split_leaf_data",
                      [],
                      []
                    |),
                    [
                      M.borrow (| Pointer.Kind.MutRef, self |);
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| new_node |) |),
                              "alloc::collections::btree::node::InternalNode",
                              "data"
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ new_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_trait_method (|
                      "core::convert::From",
                      Ty.path "usize",
                      [],
                      [ Ty.path "u16" ],
                      "from",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.SubPointer.get_struct_record_field (|
                            M.deref (| M.read (| new_node |) |),
                            "alloc::collections::btree::node::InternalNode",
                            "data"
                          |),
                          "alloc::collections::btree::node::LeafNode",
                          "len"
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_function (|
                      "alloc::collections::btree::node::move_to_slice",
                      [],
                      [
                        Ty.apply
                          (Ty.path "core::ptr::non_null::NonNull")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::LeafNode")
                              []
                              [ K; V ]
                          ]
                      ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "&mut")
                              []
                              [
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::ptr::non_null::NonNull")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::LeafNode")
                                              []
                                              [ K; V ]
                                          ]
                                      ]
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "edge_area_mut",
                              [],
                              [
                                Ty.apply (Ty.path "core::ops::range::Range") [] [ Ty.path "usize" ];
                                Ty.apply
                                  (Ty.path "slice")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::ptr::non_null::NonNull")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::LeafNode")
                                              []
                                              [ K; V ]
                                          ]
                                      ]
                                  ]
                              ]
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  self,
                                  "alloc::collections::btree::node::Handle",
                                  "node"
                                |)
                              |);
                              Value.mkStructRecord
                                "core::ops::range::Range"
                                []
                                [ Ty.path "usize" ]
                                [
                                  ("start",
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            self,
                                            "alloc::collections::btree::node::Handle",
                                            "idx"
                                          |)
                                        |);
                                        Value.Integer IntegerKind.Usize 1
                                      ]
                                    |));
                                  ("end_",
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [ M.read (| old_len |); Value.Integer IntegerKind.Usize 1 ]
                                    |))
                                ]
                            ]
                          |)
                        |)
                      |);
                      M.borrow (|
                        Pointer.Kind.MutRef,
                        M.deref (|
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::ptr::non_null::NonNull")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::LeafNode")
                                                  []
                                                  [ K; V ]
                                              ]
                                          ]
                                      ]
                                  ],
                                M.get_trait_method (|
                                  "core::ops::index::IndexMut",
                                  Ty.apply
                                    (Ty.path "array")
                                    [ Value.Integer IntegerKind.Usize 12 ]
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::ptr::non_null::NonNull")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path
                                                  "alloc::collections::btree::node::LeafNode")
                                                []
                                                [ K; V ]
                                            ]
                                        ]
                                    ],
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ]
                                  ],
                                  "index_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.SubPointer.get_struct_record_field (|
                                      M.deref (| M.read (| new_node |) |),
                                      "alloc::collections::btree::node::InternalNode",
                                      "edges"
                                    |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [ M.read (| new_len |); Value.Integer IntegerKind.Usize 1
                                          ]
                                        |))
                                    ]
                                ]
                              |)
                            |)
                          |)
                        |)
                      |)
                    ]
                  |) in
                let~ height : Ty.path "usize" :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::Handle",
                        "node"
                      |),
                      "alloc::collections::btree::node::NodeRef",
                      "height"
                    |)
                  |) in
                let~ right :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Owned";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ],
                      "from_new_internal",
                      [],
                      [ A ]
                    |),
                    [ M.read (| new_node |); M.read (| height |) ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::SplitResult")
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::SplitResult"
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ]
                    [
                      ("left",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::Handle",
                            "node"
                          |)
                        |));
                      ("kv", M.read (| kv |));
                      ("right", M.read (| right |))
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_split :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "split" (split K V).
        Admitted.
        Global Typeclasses Opaque split.
        (*
            pub fn consider_for_balancing(self) -> BalancingContext<'a, K, V> {
                let self1 = unsafe { ptr::read(&self) };
                let self2 = unsafe { ptr::read(&self) };
                BalancingContext {
                    parent: self,
                    left_child: self1.left_edge().descend(),
                    right_child: self2.right_edge().descend(),
                }
            }
        *)
        Definition consider_for_balancing
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.read (|
                let~ self1 :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_function (|
                      "core::ptr::read",
                      [],
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::KV"
                          ]
                      ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.ConstPointer,
                        M.deref (| M.borrow (| Pointer.Kind.Ref, self |) |)
                      |)
                    ]
                  |) in
                let~ self2 :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::KV"
                      ],
                    M.get_function (|
                      "core::ptr::read",
                      [],
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::Internal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::KV"
                          ]
                      ]
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.ConstPointer,
                        M.deref (| M.borrow (| Pointer.Kind.Ref, self |) |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::BalancingContext"
                    []
                    [ K; V ]
                    [
                      ("parent", M.read (| self |));
                      ("left_child",
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::Edge"
                              ],
                            "descend",
                            [],
                            []
                          |),
                          [
                            M.call_closure (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ],
                              M.get_associated_function (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::KV"
                                  ],
                                "left_edge",
                                [],
                                []
                              |),
                              [ M.read (| self1 |) ]
                            |)
                          ]
                        |));
                      ("right_child",
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::Handle")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ];
                                Ty.path "alloc::collections::btree::node::marker::Edge"
                              ],
                            "descend",
                            [],
                            []
                          |),
                          [
                            M.call_closure (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::Edge"
                                ],
                              M.get_associated_function (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::Handle")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ];
                                    Ty.path "alloc::collections::btree::node::marker::KV"
                                  ],
                                "right_edge",
                                [],
                                []
                              |),
                              [ M.read (| self2 |) ]
                            |)
                          ]
                        |))
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_consider_for_balancing :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "consider_for_balancing" (consider_for_balancing K V).
        Admitted.
        Global Typeclasses Opaque consider_for_balancing.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_Internal_alloc_collections_btree_node_marker_KV.
      
      (* StructRecord
        {
          name := "BalancingContext";
          const_params := [];
          ty_params := [ "K"; "V" ];
          fields :=
            [
              ("parent",
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ];
                    Ty.path "alloc::collections::btree::node::marker::KV"
                  ]);
              ("left_child",
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Mut";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                  ]);
              ("right_child",
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Mut";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                  ])
            ];
        } *)
      
      
      
      Module Impl_alloc_collections_btree_node_BalancingContext_K_V.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply (Ty.path "alloc::collections::btree::node::BalancingContext") [] [ K; V ].
        
        (*
            pub fn left_child_len(&self) -> usize {
                self.left_child.len()
            }
        *)
        Definition left_child_len
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ]
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.path "usize",
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  "len",
                  [],
                  []
                |),
                [
                  M.borrow (|
                    Pointer.Kind.Ref,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "left_child"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_left_child_len :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "left_child_len" (left_child_len K V).
        Admitted.
        Global Typeclasses Opaque left_child_len.
        
        (*
            pub fn right_child_len(&self) -> usize {
                self.right_child.len()
            }
        *)
        Definition right_child_len
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ]
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.path "usize",
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::NodeRef")
                    []
                    [
                      Ty.path "alloc::collections::btree::node::marker::Mut";
                      K;
                      V;
                      Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                    ],
                  "len",
                  [],
                  []
                |),
                [
                  M.borrow (|
                    Pointer.Kind.Ref,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "right_child"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_right_child_len :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "right_child_len" (right_child_len K V).
        Admitted.
        Global Typeclasses Opaque right_child_len.
        
        (*
            pub fn into_left_child(self) -> NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal> {
                self.left_child
            }
        *)
        Definition into_left_child
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              M.read (|
                M.SubPointer.get_struct_record_field (|
                  self,
                  "alloc::collections::btree::node::BalancingContext",
                  "left_child"
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_left_child :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "into_left_child" (into_left_child K V).
        Admitted.
        Global Typeclasses Opaque into_left_child.
        
        (*
            pub fn into_right_child(self) -> NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal> {
                self.right_child
            }
        *)
        Definition into_right_child
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              M.read (|
                M.SubPointer.get_struct_record_field (|
                  self,
                  "alloc::collections::btree::node::BalancingContext",
                  "right_child"
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_into_right_child :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "into_right_child" (into_right_child K V).
        Admitted.
        Global Typeclasses Opaque into_right_child.
        
        (*
            pub fn can_merge(&self) -> bool {
                self.left_child.len() + 1 + self.right_child.len() <= CAPACITY
            }
        *)
        Definition can_merge
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ]
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.path "bool",
                BinOp.le,
                [
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.add,
                        [
                          M.call_closure (|
                            Ty.path "usize",
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "len",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.Ref,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::BalancingContext",
                                  "left_child"
                                |)
                              |)
                            ]
                          |);
                          Value.Integer IntegerKind.Usize 1
                        ]
                      |);
                      M.call_closure (|
                        Ty.path "usize",
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "len",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.SubPointer.get_struct_record_field (|
                              M.deref (| M.read (| self |) |),
                              "alloc::collections::btree::node::BalancingContext",
                              "right_child"
                            |)
                          |)
                        ]
                      |)
                    ]
                  |);
                  M.read (|
                    get_constant (| "alloc::collections::btree::node::CAPACITY", Ty.path "usize" |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_can_merge :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "can_merge" (can_merge K V).
        Admitted.
        Global Typeclasses Opaque can_merge.
        (*
            fn do_merge<
                F: FnOnce(
                    NodeRef<marker::Mut<'a>, K, V, marker::Internal>,
                    NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal>,
                ) -> R,
                R,
                A: Allocator,
            >(
                self,
                result: F,
                alloc: A,
            ) -> R {
                let Handle { node: mut parent_node, idx: parent_idx, _marker } = self.parent;
                let old_parent_len = parent_node.len();
                let mut left_node = self.left_child;
                let old_left_len = left_node.len();
                let mut right_node = self.right_child;
                let right_len = right_node.len();
                let new_left_len = old_left_len + 1 + right_len;
        
                assert!(new_left_len <= CAPACITY);
        
                unsafe {
                    *left_node.len_mut() = new_left_len as u16;
        
                    let parent_key = slice_remove(parent_node.key_area_mut(..old_parent_len), parent_idx);
                    left_node.key_area_mut(old_left_len).write(parent_key);
                    move_to_slice(
                        right_node.key_area_mut(..right_len),
                        left_node.key_area_mut(old_left_len + 1..new_left_len),
                    );
        
                    let parent_val = slice_remove(parent_node.val_area_mut(..old_parent_len), parent_idx);
                    left_node.val_area_mut(old_left_len).write(parent_val);
                    move_to_slice(
                        right_node.val_area_mut(..right_len),
                        left_node.val_area_mut(old_left_len + 1..new_left_len),
                    );
        
                    slice_remove(&mut parent_node.edge_area_mut(..old_parent_len + 1), parent_idx + 1);
                    parent_node.correct_childrens_parent_links(parent_idx + 1..old_parent_len);
                    *parent_node.len_mut() -= 1;
        
                    if parent_node.height > 1 {
                        // SAFETY: the height of the nodes being merged is one below the height
                        // of the node of this edge, thus above zero, so they are internal.
                        let mut left_node = left_node.reborrow_mut().cast_to_internal_unchecked();
                        let mut right_node = right_node.cast_to_internal_unchecked();
                        move_to_slice(
                            right_node.edge_area_mut(..right_len + 1),
                            left_node.edge_area_mut(old_left_len + 1..new_left_len + 1),
                        );
        
                        left_node.correct_childrens_parent_links(old_left_len + 1..new_left_len + 1);
        
                        alloc.deallocate(right_node.node.cast(), Layout::new::<InternalNode<K, V>>());
                    } else {
                        alloc.deallocate(right_node.node.cast(), Layout::new::<LeafNode<K, V>>());
                    }
                }
                result(parent_node, left_node)
            }
        *)
        Definition do_merge
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ F; R; A ], [ self; result; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let result := M.alloc (| F, result |) in
              let alloc := M.alloc (| A, alloc |) in
              M.match_operator (|
                R,
                M.SubPointer.get_struct_record_field (|
                  self,
                  "alloc::collections::btree::node::BalancingContext",
                  "parent"
                |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |) in
                      let γ0_1 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "idx"
                        |) in
                      let γ0_2 :=
                        M.SubPointer.get_struct_record_field (|
                          γ,
                          "alloc::collections::btree::node::Handle",
                          "_marker"
                        |) in
                      let parent_node :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          γ0_0
                        |) in
                      let parent_idx := M.copy (| Ty.path "usize", γ0_1 |) in
                      let _marker :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "core::marker::PhantomData")
                            []
                            [ Ty.path "alloc::collections::btree::node::marker::KV" ],
                          γ0_2
                        |) in
                      M.read (|
                        let~ old_parent_len : Ty.path "usize" :=
                          M.call_closure (|
                            Ty.path "usize",
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              "len",
                              [],
                              []
                            |),
                            [ M.borrow (| Pointer.Kind.Ref, parent_node |) ]
                          |) in
                        let~ left_node :
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ] :=
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::BalancingContext",
                              "left_child"
                            |)
                          |) in
                        let~ old_left_len : Ty.path "usize" :=
                          M.call_closure (|
                            Ty.path "usize",
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "len",
                              [],
                              []
                            |),
                            [ M.borrow (| Pointer.Kind.Ref, left_node |) ]
                          |) in
                        let~ right_node :
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ] :=
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              self,
                              "alloc::collections::btree::node::BalancingContext",
                              "right_child"
                            |)
                          |) in
                        let~ right_len : Ty.path "usize" :=
                          M.call_closure (|
                            Ty.path "usize",
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "len",
                              [],
                              []
                            |),
                            [ M.borrow (| Pointer.Kind.Ref, right_node |) ]
                          |) in
                        let~ new_left_len : Ty.path "usize" :=
                          M.call_closure (|
                            Ty.path "usize",
                            BinOp.Wrap.add,
                            [
                              M.call_closure (|
                                Ty.path "usize",
                                BinOp.Wrap.add,
                                [ M.read (| old_left_len |); Value.Integer IntegerKind.Usize 1 ]
                              |);
                              M.read (| right_len |)
                            ]
                          |) in
                        let~ _ : Ty.tuple [] :=
                          M.match_operator (|
                            Ty.tuple [],
                            M.alloc (| Ty.tuple [], Value.Tuple [] |),
                            [
                              fun γ =>
                                ltac:(M.monadic
                                  (let γ :=
                                    M.use
                                      (M.alloc (|
                                        Ty.path "bool",
                                        M.call_closure (|
                                          Ty.path "bool",
                                          UnOp.not,
                                          [
                                            M.call_closure (|
                                              Ty.path "bool",
                                              BinOp.le,
                                              [
                                                M.read (| new_left_len |);
                                                M.read (|
                                                  get_constant (|
                                                    "alloc::collections::btree::node::CAPACITY",
                                                    Ty.path "usize"
                                                  |)
                                                |)
                                              ]
                                            |)
                                          ]
                                        |)
                                      |)) in
                                  let _ :=
                                    is_constant_or_break_match (|
                                      M.read (| γ |),
                                      Value.Bool true
                                    |) in
                                  M.never_to_any (|
                                    M.call_closure (|
                                      Ty.path "never",
                                      M.get_function (| "core::panicking::panic", [], [] |),
                                      [ mk_str (| "assertion failed: new_left_len <= CAPACITY" |) ]
                                    |)
                                  |)));
                              fun γ => ltac:(M.monadic (Value.Tuple []))
                            ]
                          |) in
                        let~ _ : Ty.tuple [] :=
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.write (|
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::LeafOrInternal"
                                        ],
                                      "len_mut",
                                      [],
                                      []
                                    |),
                                    [ M.borrow (| Pointer.Kind.MutRef, left_node |) ]
                                  |)
                                |),
                                M.cast (Ty.path "u16") (M.read (| new_left_len |))
                              |) in
                            let~ parent_key : K :=
                              M.call_closure (|
                                K,
                                M.get_function (|
                                  "alloc::collections::btree::node::slice_remove",
                                  [],
                                  [ K ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, parent_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| old_parent_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| parent_idx |)
                                ]
                              |) in
                            let~ _ : Ty.apply (Ty.path "&mut") [] [ K ] :=
                              M.call_closure (|
                                Ty.apply (Ty.path "&mut") [] [ K ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                    []
                                    [ K ],
                                  "write",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ K ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.path "usize";
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ K ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          M.read (| old_left_len |)
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| parent_key |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [ K ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| right_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| old_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |));
                                              ("end_", M.read (| new_left_len |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            let~ parent_val : V :=
                              M.call_closure (|
                                V,
                                M.get_function (|
                                  "alloc::collections::btree::node::slice_remove",
                                  [],
                                  [ V ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, parent_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| old_parent_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| parent_idx |)
                                ]
                              |) in
                            let~ _ : Ty.apply (Ty.path "&mut") [] [ V ] :=
                              M.call_closure (|
                                Ty.apply (Ty.path "&mut") [] [ V ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                    []
                                    [ V ],
                                  "write",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ V ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.path "usize";
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ V ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          M.read (| old_left_len |)
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| parent_val |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [ V ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| right_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| old_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |));
                                              ("end_", M.read (| new_left_len |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            let~ _ :
                                Ty.apply
                                  (Ty.path "core::ptr::non_null::NonNull")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::LeafNode")
                                      []
                                      [ K; V ]
                                  ] :=
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "core::ptr::non_null::NonNull")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::LeafNode")
                                      []
                                      [ K; V ]
                                  ],
                                M.get_function (|
                                  "alloc::collections::btree::node::slice_remove",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.read (|
                                        M.deref (|
                                          M.borrow (|
                                            Pointer.Kind.MutRef,
                                            M.alloc (|
                                              Ty.apply
                                                (Ty.path "&mut")
                                                []
                                                [
                                                  Ty.apply
                                                    (Ty.path "slice")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "core::mem::maybe_uninit::MaybeUninit")
                                                        []
                                                        [
                                                          Ty.apply
                                                            (Ty.path "core::ptr::non_null::NonNull")
                                                            []
                                                            [
                                                              Ty.apply
                                                                (Ty.path
                                                                  "alloc::collections::btree::node::LeafNode")
                                                                []
                                                                [ K; V ]
                                                            ]
                                                        ]
                                                    ]
                                                ],
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path "&mut")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "slice")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "core::mem::maybe_uninit::MaybeUninit")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::ptr::non_null::NonNull")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "alloc::collections::btree::node::LeafNode")
                                                                  []
                                                                  [ K; V ]
                                                              ]
                                                          ]
                                                      ]
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Internal"
                                                    ],
                                                  "edge_area_mut",
                                                  [],
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ops::range::RangeTo")
                                                      []
                                                      [ Ty.path "usize" ];
                                                    Ty.apply
                                                      (Ty.path "slice")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "core::mem::maybe_uninit::MaybeUninit")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::ptr::non_null::NonNull")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "alloc::collections::btree::node::LeafNode")
                                                                  []
                                                                  [ K; V ]
                                                              ]
                                                          ]
                                                      ]
                                                  ]
                                                |),
                                                [
                                                  M.borrow (| Pointer.Kind.MutRef, parent_node |);
                                                  Value.mkStructRecord
                                                    "core::ops::range::RangeTo"
                                                    []
                                                    [ Ty.path "usize" ]
                                                    [
                                                      ("end_",
                                                        M.call_closure (|
                                                          Ty.path "usize",
                                                          BinOp.Wrap.add,
                                                          [
                                                            M.read (| old_parent_len |);
                                                            Value.Integer IntegerKind.Usize 1
                                                          ]
                                                        |))
                                                    ]
                                                ]
                                              |)
                                            |)
                                          |)
                                        |)
                                      |)
                                    |)
                                  |);
                                  M.call_closure (|
                                    Ty.path "usize",
                                    BinOp.Wrap.add,
                                    [ M.read (| parent_idx |); Value.Integer IntegerKind.Usize 1 ]
                                  |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ],
                                  "correct_childrens_parent_links",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ]
                                  ]
                                |),
                                [
                                  M.borrow (| Pointer.Kind.MutRef, parent_node |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| parent_idx |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |));
                                      ("end_", M.read (| old_parent_len |))
                                    ]
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              let β :=
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::Internal"
                                        ],
                                      "len_mut",
                                      [],
                                      []
                                    |),
                                    [ M.borrow (| Pointer.Kind.MutRef, parent_node |) ]
                                  |)
                                |) in
                              M.write (|
                                β,
                                M.call_closure (|
                                  Ty.path "u16",
                                  BinOp.Wrap.sub,
                                  [ M.read (| β |); Value.Integer IntegerKind.U16 1 ]
                                |)
                              |) in
                            M.alloc (|
                              Ty.tuple [],
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (| Ty.tuple [], Value.Tuple [] |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ :=
                                        M.use
                                          (M.alloc (|
                                            Ty.path "bool",
                                            M.call_closure (|
                                              Ty.path "bool",
                                              BinOp.gt,
                                              [
                                                M.read (|
                                                  M.SubPointer.get_struct_record_field (|
                                                    parent_node,
                                                    "alloc::collections::btree::node::NodeRef",
                                                    "height"
                                                  |)
                                                |);
                                                Value.Integer IntegerKind.Usize 1
                                              ]
                                            |)
                                          |)) in
                                      let _ :=
                                        is_constant_or_break_match (|
                                          M.read (| γ |),
                                          Value.Bool true
                                        |) in
                                      M.read (|
                                        let~ left_node :
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ] :=
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "cast_to_internal_unchecked",
                                              [],
                                              []
                                            |),
                                            [
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                                  ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path
                                                      "alloc::collections::btree::node::NodeRef")
                                                    []
                                                    [
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::Mut";
                                                      K;
                                                      V;
                                                      Ty.path
                                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                                    ],
                                                  "reborrow_mut",
                                                  [],
                                                  []
                                                |),
                                                [ M.borrow (| Pointer.Kind.MutRef, left_node |) ]
                                              |)
                                            ]
                                          |) in
                                        let~ right_node :
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ] :=
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "cast_to_internal_unchecked",
                                              [],
                                              []
                                            |),
                                            [ M.read (| right_node |) ]
                                          |) in
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_function (|
                                              "alloc::collections::btree::node::move_to_slice",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ptr::non_null::NonNull")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::LeafNode")
                                                      []
                                                      [ K; V ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (|
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path "&mut")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "edge_area_mut",
                                                      [],
                                                      [
                                                        Ty.apply
                                                          (Ty.path "core::ops::range::RangeTo")
                                                          []
                                                          [ Ty.path "usize" ];
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ]
                                                    |),
                                                    [
                                                      M.borrow (|
                                                        Pointer.Kind.MutRef,
                                                        right_node
                                                      |);
                                                      Value.mkStructRecord
                                                        "core::ops::range::RangeTo"
                                                        []
                                                        [ Ty.path "usize" ]
                                                        [
                                                          ("end_",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| right_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |))
                                                        ]
                                                    ]
                                                  |)
                                                |)
                                              |);
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (|
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path "&mut")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "edge_area_mut",
                                                      [],
                                                      [
                                                        Ty.apply
                                                          (Ty.path "core::ops::range::Range")
                                                          []
                                                          [ Ty.path "usize" ];
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ]
                                                    |),
                                                    [
                                                      M.borrow (| Pointer.Kind.MutRef, left_node |);
                                                      Value.mkStructRecord
                                                        "core::ops::range::Range"
                                                        []
                                                        [ Ty.path "usize" ]
                                                        [
                                                          ("start",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| old_left_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |));
                                                          ("end_",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| new_left_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |))
                                                        ]
                                                    ]
                                                  |)
                                                |)
                                              |)
                                            ]
                                          |) in
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ],
                                              "correct_childrens_parent_links",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::Range")
                                                  []
                                                  [ Ty.path "usize" ]
                                              ]
                                            |),
                                            [
                                              M.borrow (| Pointer.Kind.MutRef, left_node |);
                                              Value.mkStructRecord
                                                "core::ops::range::Range"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("start",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.add,
                                                      [
                                                        M.read (| old_left_len |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |));
                                                  ("end_",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.add,
                                                      [
                                                        M.read (| new_left_len |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |))
                                                ]
                                            ]
                                          |) in
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_trait_method (|
                                              "core::alloc::Allocator",
                                              A,
                                              [],
                                              [],
                                              "deallocate",
                                              [],
                                              []
                                            |),
                                            [
                                              M.borrow (| Pointer.Kind.Ref, alloc |);
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path "core::ptr::non_null::NonNull")
                                                  []
                                                  [ Ty.path "u8" ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path "core::ptr::non_null::NonNull")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::LeafNode")
                                                        []
                                                        [ K; V ]
                                                    ],
                                                  "cast",
                                                  [],
                                                  [ Ty.path "u8" ]
                                                |),
                                                [
                                                  M.read (|
                                                    M.SubPointer.get_struct_record_field (|
                                                      right_node,
                                                      "alloc::collections::btree::node::NodeRef",
                                                      "node"
                                                    |)
                                                  |)
                                                ]
                                              |);
                                              M.call_closure (|
                                                Ty.path "core::alloc::layout::Layout",
                                                M.get_associated_function (|
                                                  Ty.path "core::alloc::layout::Layout",
                                                  "new",
                                                  [],
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::InternalNode")
                                                      []
                                                      [ K; V ]
                                                  ]
                                                |),
                                                []
                                              |)
                                            ]
                                          |) in
                                        M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                      |)));
                                  fun γ =>
                                    ltac:(M.monadic
                                      (M.read (|
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_trait_method (|
                                              "core::alloc::Allocator",
                                              A,
                                              [],
                                              [],
                                              "deallocate",
                                              [],
                                              []
                                            |),
                                            [
                                              M.borrow (| Pointer.Kind.Ref, alloc |);
                                              M.call_closure (|
                                                Ty.apply
                                                  (Ty.path "core::ptr::non_null::NonNull")
                                                  []
                                                  [ Ty.path "u8" ],
                                                M.get_associated_function (|
                                                  Ty.apply
                                                    (Ty.path "core::ptr::non_null::NonNull")
                                                    []
                                                    [
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::LeafNode")
                                                        []
                                                        [ K; V ]
                                                    ],
                                                  "cast",
                                                  [],
                                                  [ Ty.path "u8" ]
                                                |),
                                                [
                                                  M.read (|
                                                    M.SubPointer.get_struct_record_field (|
                                                      right_node,
                                                      "alloc::collections::btree::node::NodeRef",
                                                      "node"
                                                    |)
                                                  |)
                                                ]
                                              |);
                                              M.call_closure (|
                                                Ty.path "core::alloc::layout::Layout",
                                                M.get_associated_function (|
                                                  Ty.path "core::alloc::layout::Layout",
                                                  "new",
                                                  [],
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::LeafNode")
                                                      []
                                                      [ K; V ]
                                                  ]
                                                |),
                                                []
                                              |)
                                            ]
                                          |) in
                                        M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                      |)))
                                ]
                              |)
                            |)
                          |) in
                        M.alloc (|
                          R,
                          M.call_closure (|
                            R,
                            M.get_trait_method (|
                              "core::ops::function::FnOnce",
                              F,
                              [],
                              [
                                Ty.tuple
                                  [
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path "alloc::collections::btree::node::marker::Internal"
                                      ];
                                    Ty.apply
                                      (Ty.path "alloc::collections::btree::node::NodeRef")
                                      []
                                      [
                                        Ty.path "alloc::collections::btree::node::marker::Mut";
                                        K;
                                        V;
                                        Ty.path
                                          "alloc::collections::btree::node::marker::LeafOrInternal"
                                      ]
                                  ]
                              ],
                              "call_once",
                              [],
                              []
                            |),
                            [
                              M.read (| result |);
                              Value.Tuple [ M.read (| parent_node |); M.read (| left_node |) ]
                            ]
                          |)
                        |)
                      |)))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_do_merge :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "do_merge" (do_merge K V).
        Admitted.
        Global Typeclasses Opaque do_merge.
        
        (*
            pub fn merge_tracking_parent<A: Allocator + Clone>(
                self,
                alloc: A,
            ) -> NodeRef<marker::Mut<'a>, K, V, marker::Internal> {
                self.do_merge(|parent, _child| parent, alloc)
            }
        *)
        Definition merge_tracking_parent
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Mut";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::Internal"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  "do_merge",
                  [],
                  [
                    Ty.function
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ]
                      (Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]);
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Internal"
                      ];
                    A
                  ]
                |),
                [
                  M.read (| self |);
                  M.closure
                    (fun γ =>
                      ltac:(M.monadic
                        match γ with
                        | [ α0; α1 ] =>
                          ltac:(M.monadic
                            (M.match_operator (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              M.alloc (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ],
                                α0
                              |),
                              [
                                fun γ =>
                                  ltac:(M.monadic
                                    (let parent :=
                                      M.copy (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::Internal"
                                          ],
                                        γ
                                      |) in
                                    M.match_operator (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::Internal"
                                        ],
                                      M.alloc (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::LeafOrInternal"
                                          ],
                                        α1
                                      |),
                                      [
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let _child :=
                                              M.copy (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                                  ],
                                                γ
                                              |) in
                                            M.read (| parent |)))
                                      ]
                                    |)))
                              ]
                            |)))
                        | _ => M.impossible "wrong number of arguments"
                        end));
                  M.read (| alloc |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_merge_tracking_parent :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "merge_tracking_parent" (merge_tracking_parent K V).
        Admitted.
        Global Typeclasses Opaque merge_tracking_parent.
        
        (*
            pub fn merge_tracking_child<A: Allocator + Clone>(
                self,
                alloc: A,
            ) -> NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal> {
                self.do_merge(|_parent, child| child, alloc)
            }
        *)
        Definition merge_tracking_child
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [
                    Ty.path "alloc::collections::btree::node::marker::Mut";
                    K;
                    V;
                    Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  "do_merge",
                  [],
                  [
                    Ty.function
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ]
                      (Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]);
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ];
                    A
                  ]
                |),
                [
                  M.read (| self |);
                  M.closure
                    (fun γ =>
                      ltac:(M.monadic
                        match γ with
                        | [ α0; α1 ] =>
                          ltac:(M.monadic
                            (M.match_operator (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              M.alloc (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ],
                                α0
                              |),
                              [
                                fun γ =>
                                  ltac:(M.monadic
                                    (let _parent :=
                                      M.copy (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::Internal"
                                          ],
                                        γ
                                      |) in
                                    M.match_operator (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::LeafOrInternal"
                                        ],
                                      M.alloc (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::NodeRef")
                                          []
                                          [
                                            Ty.path "alloc::collections::btree::node::marker::Mut";
                                            K;
                                            V;
                                            Ty.path
                                              "alloc::collections::btree::node::marker::LeafOrInternal"
                                          ],
                                        α1
                                      |),
                                      [
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let child :=
                                              M.copy (|
                                                Ty.apply
                                                  (Ty.path
                                                    "alloc::collections::btree::node::NodeRef")
                                                  []
                                                  [
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::Mut";
                                                    K;
                                                    V;
                                                    Ty.path
                                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                                  ],
                                                γ
                                              |) in
                                            M.read (| child |)))
                                      ]
                                    |)))
                              ]
                            |)))
                        | _ => M.impossible "wrong number of arguments"
                        end));
                  M.read (| alloc |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_merge_tracking_child :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "merge_tracking_child" (merge_tracking_child K V).
        Admitted.
        Global Typeclasses Opaque merge_tracking_child.
        
        (*
            pub fn merge_tracking_child_edge<A: Allocator + Clone>(
                self,
                track_edge_idx: LeftOrRight<usize>,
                alloc: A,
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal>, marker::Edge> {
                let old_left_len = self.left_child.len();
                let right_len = self.right_child.len();
                assert!(match track_edge_idx {
                    LeftOrRight::Left(idx) => idx <= old_left_len,
                    LeftOrRight::Right(idx) => idx <= right_len,
                });
                let child = self.merge_tracking_child(alloc);
                let new_idx = match track_edge_idx {
                    LeftOrRight::Left(idx) => idx,
                    LeftOrRight::Right(idx) => old_left_len + 1 + idx,
                };
                unsafe { Handle::new_edge(child, new_idx) }
            }
        *)
        Definition merge_tracking_child_edge
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [ A ], [ self; track_edge_idx; alloc ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let track_edge_idx :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::LeftOrRight")
                    []
                    [ Ty.path "usize" ],
                  track_edge_idx
                |) in
              let alloc := M.alloc (| A, alloc |) in
              M.read (|
                let~ old_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::BalancingContext",
                          "left_child"
                        |)
                      |)
                    ]
                  |) in
                let~ right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [
                      M.borrow (|
                        Pointer.Kind.Ref,
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::BalancingContext",
                          "right_child"
                        |)
                      |)
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.match_operator (|
                                      Ty.path "bool",
                                      track_edge_idx,
                                      [
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let γ0_0 :=
                                              M.SubPointer.get_struct_tuple_field (|
                                                γ,
                                                "alloc::collections::btree::node::LeftOrRight::Left",
                                                0
                                              |) in
                                            let idx := M.copy (| Ty.path "usize", γ0_0 |) in
                                            M.call_closure (|
                                              Ty.path "bool",
                                              BinOp.le,
                                              [ M.read (| idx |); M.read (| old_left_len |) ]
                                            |)));
                                        fun γ =>
                                          ltac:(M.monadic
                                            (let γ0_0 :=
                                              M.SubPointer.get_struct_tuple_field (|
                                                γ,
                                                "alloc::collections::btree::node::LeftOrRight::Right",
                                                0
                                              |) in
                                            let idx := M.copy (| Ty.path "usize", γ0_0 |) in
                                            M.call_closure (|
                                              Ty.path "bool",
                                              BinOp.le,
                                              [ M.read (| idx |); M.read (| right_len |) ]
                                            |)))
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [
                                mk_str (|
                                  "assertion failed: match track_edge_idx {
    LeftOrRight::Left(idx) => idx <= old_left_len,
    LeftOrRight::Right(idx) => idx <= right_len,
}"
                                |)
                              ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ child :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ],
                      "merge_tracking_child",
                      [],
                      [ A ]
                    |),
                    [ M.read (| self |); M.read (| alloc |) ]
                  |) in
                let~ new_idx : Ty.path "usize" :=
                  M.match_operator (|
                    Ty.path "usize",
                    track_edge_idx,
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ,
                              "alloc::collections::btree::node::LeftOrRight::Left",
                              0
                            |) in
                          let idx := M.copy (| Ty.path "usize", γ0_0 |) in
                          M.read (| idx |)));
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ,
                              "alloc::collections::btree::node::LeftOrRight::Right",
                              0
                            |) in
                          let idx := M.copy (| Ty.path "usize", γ0_0 |) in
                          M.call_closure (|
                            Ty.path "usize",
                            BinOp.Wrap.add,
                            [
                              M.call_closure (|
                                Ty.path "usize",
                                BinOp.Wrap.add,
                                [ M.read (| old_left_len |); Value.Integer IntegerKind.Usize 1 ]
                              |);
                              M.read (| idx |)
                            ]
                          |)))
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "new_edge",
                      [],
                      []
                    |),
                    [ M.read (| child |); M.read (| new_idx |) ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_merge_tracking_child_edge :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V)
            "merge_tracking_child_edge"
            (merge_tracking_child_edge K V).
        Admitted.
        Global Typeclasses Opaque merge_tracking_child_edge.
        
        (*
            pub fn steal_left(
                mut self,
                track_right_edge_idx: usize,
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal>, marker::Edge> {
                self.bulk_steal_left(1);
                unsafe { Handle::new_edge(self.right_child, 1 + track_right_edge_idx) }
            }
        *)
        Definition steal_left
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; track_right_edge_idx ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let track_right_edge_idx := M.alloc (| Ty.path "usize", track_right_edge_idx |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ],
                      "bulk_steal_left",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, self |); Value.Integer IntegerKind.Usize 1 ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "new_edge",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::BalancingContext",
                          "right_child"
                        |)
                      |);
                      M.call_closure (|
                        Ty.path "usize",
                        BinOp.Wrap.add,
                        [ Value.Integer IntegerKind.Usize 1; M.read (| track_right_edge_idx |) ]
                      |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_steal_left :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "steal_left" (steal_left K V).
        Admitted.
        Global Typeclasses Opaque steal_left.
        
        (*
            pub fn steal_right(
                mut self,
                track_left_edge_idx: usize,
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal>, marker::Edge> {
                self.bulk_steal_right(1);
                unsafe { Handle::new_edge(self.left_child, track_left_edge_idx) }
            }
        *)
        Definition steal_right
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; track_left_edge_idx ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::BalancingContext")
                    []
                    [ K; V ],
                  self
                |) in
              let track_left_edge_idx := M.alloc (| Ty.path "usize", track_left_edge_idx |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.call_closure (|
                    Ty.tuple [],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ],
                      "bulk_steal_right",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, self |); Value.Integer IntegerKind.Usize 1 ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ];
                        Ty.path "alloc::collections::btree::node::marker::Edge"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "new_edge",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::BalancingContext",
                          "left_child"
                        |)
                      |);
                      M.read (| track_left_edge_idx |)
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_steal_right :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "steal_right" (steal_right K V).
        Admitted.
        Global Typeclasses Opaque steal_right.
        
        (*
            pub fn bulk_steal_left(&mut self, count: usize) {
                assert!(count > 0);
                unsafe {
                    let left_node = &mut self.left_child;
                    let old_left_len = left_node.len();
                    let right_node = &mut self.right_child;
                    let old_right_len = right_node.len();
        
                    // Make sure that we may steal safely.
                    assert!(old_right_len + count <= CAPACITY);
                    assert!(old_left_len >= count);
        
                    let new_left_len = old_left_len - count;
                    let new_right_len = old_right_len + count;
                    *left_node.len_mut() = new_left_len as u16;
                    *right_node.len_mut() = new_right_len as u16;
        
                    // Move leaf data.
                    {
                        // Make room for stolen elements in the right child.
                        slice_shr(right_node.key_area_mut(..new_right_len), count);
                        slice_shr(right_node.val_area_mut(..new_right_len), count);
        
                        // Move elements from the left child to the right one.
                        move_to_slice(
                            left_node.key_area_mut(new_left_len + 1..old_left_len),
                            right_node.key_area_mut(..count - 1),
                        );
                        move_to_slice(
                            left_node.val_area_mut(new_left_len + 1..old_left_len),
                            right_node.val_area_mut(..count - 1),
                        );
        
                        // Move the leftmost stolen pair to the parent.
                        let k = left_node.key_area_mut(new_left_len).assume_init_read();
                        let v = left_node.val_area_mut(new_left_len).assume_init_read();
                        let (k, v) = self.parent.replace_kv(k, v);
        
                        // Move parent's key-value pair to the right child.
                        right_node.key_area_mut(count - 1).write(k);
                        right_node.val_area_mut(count - 1).write(v);
                    }
        
                    match (left_node.reborrow_mut().force(), right_node.reborrow_mut().force()) {
                        (ForceResult::Internal(mut left), ForceResult::Internal(mut right)) => {
                            // Make room for stolen edges.
                            slice_shr(right.edge_area_mut(..new_right_len + 1), count);
        
                            // Steal edges.
                            move_to_slice(
                                left.edge_area_mut(new_left_len + 1..old_left_len + 1),
                                right.edge_area_mut(..count),
                            );
        
                            right.correct_childrens_parent_links(0..new_right_len + 1);
                        }
                        (ForceResult::Leaf(_), ForceResult::Leaf(_)) => {}
                        _ => unreachable!(),
                    }
                }
            }
        *)
        Definition bulk_steal_left
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; count ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ]
                    ],
                  self
                |) in
              let count := M.alloc (| Ty.path "usize", count |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.gt,
                                      [ M.read (| count |); Value.Integer IntegerKind.Usize 0 ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: count > 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ left_node :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "left_child"
                    |)
                  |) in
                let~ old_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| left_node |) |) |) ]
                  |) in
                let~ right_node :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "right_child"
                    |)
                  |) in
                let~ old_right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| right_node |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.le,
                                      [
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [ M.read (| old_right_len |); M.read (| count |) ]
                                        |);
                                        M.read (|
                                          get_constant (|
                                            "alloc::collections::btree::node::CAPACITY",
                                            Ty.path "usize"
                                          |)
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: old_right_len + count <= CAPACITY" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.ge,
                                      [ M.read (| old_left_len |); M.read (| count |) ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: old_left_len >= count" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ new_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.sub,
                    [ M.read (| old_left_len |); M.read (| count |) ]
                  |) in
                let~ new_right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [ M.read (| old_right_len |); M.read (| count |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| left_node |) |) |) ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_left_len |))
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| right_node |) |) |)
                        ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_right_len |))
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.read (|
                    let~ _ : Ty.tuple [] :=
                      M.call_closure (|
                        Ty.tuple [],
                        M.get_function (|
                          "alloc::collections::btree::node::slice_shr",
                          [],
                          [ K ]
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "key_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [ ("end_", M.read (| new_right_len |)) ]
                                ]
                              |)
                            |)
                          |);
                          M.read (| count |)
                        ]
                      |) in
                    let~ _ : Ty.tuple [] :=
                      M.call_closure (|
                        Ty.tuple [],
                        M.get_function (|
                          "alloc::collections::btree::node::slice_shr",
                          [],
                          [ V ]
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "val_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [ ("end_", M.read (| new_right_len |)) ]
                                ]
                              |)
                            |)
                          |);
                          M.read (| count |)
                        ]
                      |) in
                    let~ _ : Ty.tuple [] :=
                      M.call_closure (|
                        Ty.tuple [],
                        M.get_function (|
                          "alloc::collections::btree::node::move_to_slice",
                          [],
                          [ K ]
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "key_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| new_left_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |));
                                      ("end_", M.read (| old_left_len |))
                                    ]
                                ]
                              |)
                            |)
                          |);
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "key_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ K ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.sub,
                                          [ M.read (| count |); Value.Integer IntegerKind.Usize 1 ]
                                        |))
                                    ]
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    let~ _ : Ty.tuple [] :=
                      M.call_closure (|
                        Ty.tuple [],
                        M.get_function (|
                          "alloc::collections::btree::node::move_to_slice",
                          [],
                          [ V ]
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "val_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| new_left_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |));
                                      ("end_", M.read (| old_left_len |))
                                    ]
                                ]
                              |)
                            |)
                          |);
                          M.borrow (|
                            Pointer.Kind.MutRef,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "val_area_mut",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::RangeTo")
                                      []
                                      [ Ty.path "usize" ];
                                    Ty.apply
                                      (Ty.path "slice")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  Value.mkStructRecord
                                    "core::ops::range::RangeTo"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.sub,
                                          [ M.read (| count |); Value.Integer IntegerKind.Usize 1 ]
                                        |))
                                    ]
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    let~ k : K :=
                      M.call_closure (|
                        K,
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                          "assume_init_read",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "key_area_mut",
                                  [],
                                  [
                                    Ty.path "usize";
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |);
                                  M.read (| new_left_len |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    let~ v : V :=
                      M.call_closure (|
                        V,
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                          "assume_init_read",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "val_area_mut",
                                  [],
                                  [
                                    Ty.path "usize";
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |);
                                  M.read (| new_left_len |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    M.alloc (|
                      Ty.tuple [],
                      M.match_operator (|
                        Ty.tuple [],
                        M.alloc (|
                          Ty.tuple [ K; V ],
                          M.call_closure (|
                            Ty.tuple [ K; V ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ],
                              "replace_kv",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::BalancingContext",
                                  "parent"
                                |)
                              |);
                              M.read (| k |);
                              M.read (| v |)
                            ]
                          |)
                        |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                              let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                              let k := M.copy (| K, γ0_0 |) in
                              let v := M.copy (| V, γ0_1 |) in
                              M.read (|
                                let~ _ : Ty.apply (Ty.path "&mut") [] [ K ] :=
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ K ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ K ],
                                      "write",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "key_area_mut",
                                              [],
                                              [
                                                Ty.path "usize";
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              M.call_closure (|
                                                Ty.path "usize",
                                                BinOp.Wrap.sub,
                                                [
                                                  M.read (| count |);
                                                  Value.Integer IntegerKind.Usize 1
                                                ]
                                              |)
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| k |)
                                    ]
                                  |) in
                                let~ _ : Ty.apply (Ty.path "&mut") [] [ V ] :=
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ V ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ V ],
                                      "write",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "val_area_mut",
                                              [],
                                              [
                                                Ty.path "usize";
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              M.call_closure (|
                                                Ty.path "usize",
                                                BinOp.Wrap.sub,
                                                [
                                                  M.read (| count |);
                                                  Value.Integer IntegerKind.Usize 1
                                                ]
                                              |)
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| v |)
                                    ]
                                  |) in
                                M.alloc (| Ty.tuple [], Value.Tuple [] |)
                              |)))
                        ]
                      |)
                    |)
                  |) in
                M.alloc (|
                  Ty.tuple [],
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (|
                      Ty.tuple
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::ForceResult")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ]
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::ForceResult")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ]
                            ]
                        ],
                      Value.Tuple
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::ForceResult")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "force",
                              [],
                              []
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path
                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "reborrow_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |)
                                ]
                              |)
                            ]
                          |);
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::ForceResult")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "force",
                              [],
                              []
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path
                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "reborrow_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |)
                                ]
                              |)
                            ]
                          |)
                        ]
                    |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                          let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_0,
                              "alloc::collections::btree::node::ForceResult::Internal",
                              0
                            |) in
                          let left :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              γ1_0
                            |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_1,
                              "alloc::collections::btree::node::ForceResult::Internal",
                              0
                            |) in
                          let right :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              γ1_0
                            |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::slice_shr",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("end_",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| new_right_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| count |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| new_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |));
                                              ("end_",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| old_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| count |)) ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ],
                                  "correct_childrens_parent_links",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ]
                                  ]
                                |),
                                [
                                  M.borrow (| Pointer.Kind.MutRef, right |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start", Value.Integer IntegerKind.Usize 0);
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| new_right_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |))
                                    ]
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                          let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_0,
                              "alloc::collections::btree::node::ForceResult::Leaf",
                              0
                            |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_1,
                              "alloc::collections::btree::node::ForceResult::Leaf",
                              0
                            |) in
                          Value.Tuple []));
                      fun γ =>
                        ltac:(M.monadic
                          (M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "internal error: entered unreachable code" |) ]
                            |)
                          |)))
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_bulk_steal_left :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "bulk_steal_left" (bulk_steal_left K V).
        Admitted.
        Global Typeclasses Opaque bulk_steal_left.
        
        (*
            pub fn bulk_steal_right(&mut self, count: usize) {
                assert!(count > 0);
                unsafe {
                    let left_node = &mut self.left_child;
                    let old_left_len = left_node.len();
                    let right_node = &mut self.right_child;
                    let old_right_len = right_node.len();
        
                    // Make sure that we may steal safely.
                    assert!(old_left_len + count <= CAPACITY);
                    assert!(old_right_len >= count);
        
                    let new_left_len = old_left_len + count;
                    let new_right_len = old_right_len - count;
                    *left_node.len_mut() = new_left_len as u16;
                    *right_node.len_mut() = new_right_len as u16;
        
                    // Move leaf data.
                    {
                        // Move the rightmost stolen pair to the parent.
                        let k = right_node.key_area_mut(count - 1).assume_init_read();
                        let v = right_node.val_area_mut(count - 1).assume_init_read();
                        let (k, v) = self.parent.replace_kv(k, v);
        
                        // Move parent's key-value pair to the left child.
                        left_node.key_area_mut(old_left_len).write(k);
                        left_node.val_area_mut(old_left_len).write(v);
        
                        // Move elements from the right child to the left one.
                        move_to_slice(
                            right_node.key_area_mut(..count - 1),
                            left_node.key_area_mut(old_left_len + 1..new_left_len),
                        );
                        move_to_slice(
                            right_node.val_area_mut(..count - 1),
                            left_node.val_area_mut(old_left_len + 1..new_left_len),
                        );
        
                        // Fill gap where stolen elements used to be.
                        slice_shl(right_node.key_area_mut(..old_right_len), count);
                        slice_shl(right_node.val_area_mut(..old_right_len), count);
                    }
        
                    match (left_node.reborrow_mut().force(), right_node.reborrow_mut().force()) {
                        (ForceResult::Internal(mut left), ForceResult::Internal(mut right)) => {
                            // Steal edges.
                            move_to_slice(
                                right.edge_area_mut(..count),
                                left.edge_area_mut(old_left_len + 1..new_left_len + 1),
                            );
        
                            // Fill gap where stolen edges used to be.
                            slice_shl(right.edge_area_mut(..old_right_len + 1), count);
        
                            left.correct_childrens_parent_links(old_left_len + 1..new_left_len + 1);
                            right.correct_childrens_parent_links(0..new_right_len + 1);
                        }
                        (ForceResult::Leaf(_), ForceResult::Leaf(_)) => {}
                        _ => unreachable!(),
                    }
                }
            }
        *)
        Definition bulk_steal_right
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; count ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::BalancingContext")
                        []
                        [ K; V ]
                    ],
                  self
                |) in
              let count := M.alloc (| Ty.path "usize", count |) in
              M.read (|
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.gt,
                                      [ M.read (| count |); Value.Integer IntegerKind.Usize 0 ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: count > 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ left_node :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "left_child"
                    |)
                  |) in
                let~ old_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| left_node |) |) |) ]
                  |) in
                let~ right_node :
                    Ty.apply
                      (Ty.path "&mut")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                          ]
                      ] :=
                  M.borrow (|
                    Pointer.Kind.MutRef,
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::BalancingContext",
                      "right_child"
                    |)
                  |) in
                let~ old_right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| right_node |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.le,
                                      [
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [ M.read (| old_left_len |); M.read (| count |) ]
                                        |);
                                        M.read (|
                                          get_constant (|
                                            "alloc::collections::btree::node::CAPACITY",
                                            Ty.path "usize"
                                          |)
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: old_left_len + count <= CAPACITY" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.ge,
                                      [ M.read (| old_right_len |); M.read (| count |) ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: old_right_len >= count" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ new_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.add,
                    [ M.read (| old_left_len |); M.read (| count |) ]
                  |) in
                let~ new_right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.sub,
                    [ M.read (| old_right_len |); M.read (| count |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| left_node |) |) |) ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_left_len |))
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.write (|
                    M.deref (|
                      M.call_closure (|
                        Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ],
                          "len_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| right_node |) |) |)
                        ]
                      |)
                    |),
                    M.cast (Ty.path "u16") (M.read (| new_right_len |))
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.read (|
                    let~ k : K :=
                      M.call_closure (|
                        K,
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ K ],
                          "assume_init_read",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "key_area_mut",
                                  [],
                                  [
                                    Ty.path "usize";
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ K ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  M.call_closure (|
                                    Ty.path "usize",
                                    BinOp.Wrap.sub,
                                    [ M.read (| count |); Value.Integer IntegerKind.Usize 1 ]
                                  |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    let~ v : V :=
                      M.call_closure (|
                        V,
                        M.get_associated_function (|
                          Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ V ],
                          "assume_init_read",
                          [],
                          []
                        |),
                        [
                          M.borrow (|
                            Pointer.Kind.Ref,
                            M.deref (|
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "&mut")
                                  []
                                  [
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "val_area_mut",
                                  [],
                                  [
                                    Ty.path "usize";
                                    Ty.apply
                                      (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                      []
                                      [ V ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |);
                                  M.call_closure (|
                                    Ty.path "usize",
                                    BinOp.Wrap.sub,
                                    [ M.read (| count |); Value.Integer IntegerKind.Usize 1 ]
                                  |)
                                ]
                              |)
                            |)
                          |)
                        ]
                      |) in
                    M.alloc (|
                      Ty.tuple [],
                      M.match_operator (|
                        Ty.tuple [],
                        M.alloc (|
                          Ty.tuple [ K; V ],
                          M.call_closure (|
                            Ty.tuple [ K; V ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::Handle")
                                []
                                [
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ];
                                  Ty.path "alloc::collections::btree::node::marker::KV"
                                ],
                              "replace_kv",
                              [],
                              []
                            |),
                            [
                              M.borrow (|
                                Pointer.Kind.MutRef,
                                M.SubPointer.get_struct_record_field (|
                                  M.deref (| M.read (| self |) |),
                                  "alloc::collections::btree::node::BalancingContext",
                                  "parent"
                                |)
                              |);
                              M.read (| k |);
                              M.read (| v |)
                            ]
                          |)
                        |),
                        [
                          fun γ =>
                            ltac:(M.monadic
                              (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                              let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                              let k := M.copy (| K, γ0_0 |) in
                              let v := M.copy (| V, γ0_1 |) in
                              M.read (|
                                let~ _ : Ty.apply (Ty.path "&mut") [] [ K ] :=
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ K ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ K ],
                                      "write",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "key_area_mut",
                                              [],
                                              [
                                                Ty.path "usize";
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| left_node |) |)
                                              |);
                                              M.read (| old_left_len |)
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| k |)
                                    ]
                                  |) in
                                let~ _ : Ty.apply (Ty.path "&mut") [] [ V ] :=
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ V ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ V ],
                                      "write",
                                      [],
                                      []
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "val_area_mut",
                                              [],
                                              [
                                                Ty.path "usize";
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| left_node |) |)
                                              |);
                                              M.read (| old_left_len |)
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| v |)
                                    ]
                                  |) in
                                let~ _ : Ty.tuple [] :=
                                  M.call_closure (|
                                    Ty.tuple [],
                                    M.get_function (|
                                      "alloc::collections::btree::node::move_to_slice",
                                      [],
                                      [ K ]
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "key_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::RangeTo")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::RangeTo"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("end_",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.sub,
                                                      [
                                                        M.read (| count |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |))
                                                ]
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "key_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::Range")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| left_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::Range"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("start",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.add,
                                                      [
                                                        M.read (| old_left_len |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |));
                                                  ("end_", M.read (| new_left_len |))
                                                ]
                                            ]
                                          |)
                                        |)
                                      |)
                                    ]
                                  |) in
                                let~ _ : Ty.tuple [] :=
                                  M.call_closure (|
                                    Ty.tuple [],
                                    M.get_function (|
                                      "alloc::collections::btree::node::move_to_slice",
                                      [],
                                      [ V ]
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "val_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::RangeTo")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::RangeTo"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("end_",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.sub,
                                                      [
                                                        M.read (| count |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |))
                                                ]
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "val_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::Range")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| left_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::Range"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("start",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.add,
                                                      [
                                                        M.read (| old_left_len |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |));
                                                  ("end_", M.read (| new_left_len |))
                                                ]
                                            ]
                                          |)
                                        |)
                                      |)
                                    ]
                                  |) in
                                let~ _ : Ty.tuple [] :=
                                  M.call_closure (|
                                    Ty.tuple [],
                                    M.get_function (|
                                      "alloc::collections::btree::node::slice_shl",
                                      [],
                                      [ K ]
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "key_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::RangeTo")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ K ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::RangeTo"
                                                []
                                                [ Ty.path "usize" ]
                                                [ ("end_", M.read (| old_right_len |)) ]
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| count |)
                                    ]
                                  |) in
                                let~ _ : Ty.tuple [] :=
                                  M.call_closure (|
                                    Ty.tuple [],
                                    M.get_function (|
                                      "alloc::collections::btree::node::slice_shl",
                                      [],
                                      [ V ]
                                    |),
                                    [
                                      M.borrow (|
                                        Pointer.Kind.MutRef,
                                        M.deref (|
                                          M.call_closure (|
                                            Ty.apply
                                              (Ty.path "&mut")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::LeafOrInternal"
                                                ],
                                              "val_area_mut",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::RangeTo")
                                                  []
                                                  [ Ty.path "usize" ];
                                                Ty.apply
                                                  (Ty.path "slice")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "core::mem::maybe_uninit::MaybeUninit")
                                                      []
                                                      [ V ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (| M.read (| right_node |) |)
                                              |);
                                              Value.mkStructRecord
                                                "core::ops::range::RangeTo"
                                                []
                                                [ Ty.path "usize" ]
                                                [ ("end_", M.read (| old_right_len |)) ]
                                            ]
                                          |)
                                        |)
                                      |);
                                      M.read (| count |)
                                    ]
                                  |) in
                                M.alloc (| Ty.tuple [], Value.Tuple [] |)
                              |)))
                        ]
                      |)
                    |)
                  |) in
                M.alloc (|
                  Ty.tuple [],
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (|
                      Ty.tuple
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::ForceResult")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ]
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::ForceResult")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ]
                            ]
                        ],
                      Value.Tuple
                        [
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::ForceResult")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "force",
                              [],
                              []
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path
                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "reborrow_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| left_node |) |)
                                  |)
                                ]
                              |)
                            ]
                          |);
                          M.call_closure (|
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::ForceResult")
                              []
                              [
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Leaf"
                                  ];
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path "alloc::collections::btree::node::marker::Internal"
                                  ]
                              ],
                            M.get_associated_function (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ],
                              "force",
                              [],
                              []
                            |),
                            [
                              M.call_closure (|
                                Ty.apply
                                  (Ty.path "alloc::collections::btree::node::NodeRef")
                                  []
                                  [
                                    Ty.path "alloc::collections::btree::node::marker::Mut";
                                    K;
                                    V;
                                    Ty.path
                                      "alloc::collections::btree::node::marker::LeafOrInternal"
                                  ],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path
                                        "alloc::collections::btree::node::marker::LeafOrInternal"
                                    ],
                                  "reborrow_mut",
                                  [],
                                  []
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (| M.read (| right_node |) |)
                                  |)
                                ]
                              |)
                            ]
                          |)
                        ]
                    |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                          let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_0,
                              "alloc::collections::btree::node::ForceResult::Internal",
                              0
                            |) in
                          let left :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              γ1_0
                            |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_1,
                              "alloc::collections::btree::node::ForceResult::Internal",
                              0
                            |) in
                          let right :=
                            M.copy (|
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ],
                              γ1_0
                            |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| count |)) ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| old_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |));
                                              ("end_",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| new_left_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::slice_shl",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ptr::non_null::NonNull")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::LeafNode")
                                          []
                                          [ K; V ]
                                      ]
                                  ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          "edge_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path "core::ptr::non_null::NonNull")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path
                                                            "alloc::collections::btree::node::LeafNode")
                                                          []
                                                          [ K; V ]
                                                      ]
                                                  ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("end_",
                                                M.call_closure (|
                                                  Ty.path "usize",
                                                  BinOp.Wrap.add,
                                                  [
                                                    M.read (| old_right_len |);
                                                    Value.Integer IntegerKind.Usize 1
                                                  ]
                                                |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.read (| count |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ],
                                  "correct_childrens_parent_links",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ]
                                  ]
                                |),
                                [
                                  M.borrow (| Pointer.Kind.MutRef, left |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| old_left_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |));
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| new_left_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |))
                                    ]
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_associated_function (|
                                  Ty.apply
                                    (Ty.path "alloc::collections::btree::node::NodeRef")
                                    []
                                    [
                                      Ty.path "alloc::collections::btree::node::marker::Mut";
                                      K;
                                      V;
                                      Ty.path "alloc::collections::btree::node::marker::Internal"
                                    ],
                                  "correct_childrens_parent_links",
                                  [],
                                  [
                                    Ty.apply
                                      (Ty.path "core::ops::range::Range")
                                      []
                                      [ Ty.path "usize" ]
                                  ]
                                |),
                                [
                                  M.borrow (| Pointer.Kind.MutRef, right |);
                                  Value.mkStructRecord
                                    "core::ops::range::Range"
                                    []
                                    [ Ty.path "usize" ]
                                    [
                                      ("start", Value.Integer IntegerKind.Usize 0);
                                      ("end_",
                                        M.call_closure (|
                                          Ty.path "usize",
                                          BinOp.Wrap.add,
                                          [
                                            M.read (| new_right_len |);
                                            Value.Integer IntegerKind.Usize 1
                                          ]
                                        |))
                                    ]
                                ]
                              |) in
                            M.alloc (| Ty.tuple [], Value.Tuple [] |)
                          |)));
                      fun γ =>
                        ltac:(M.monadic
                          (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                          let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_0,
                              "alloc::collections::btree::node::ForceResult::Leaf",
                              0
                            |) in
                          let γ1_0 :=
                            M.SubPointer.get_struct_tuple_field (|
                              γ0_1,
                              "alloc::collections::btree::node::ForceResult::Leaf",
                              0
                            |) in
                          Value.Tuple []));
                      fun γ =>
                        ltac:(M.monadic
                          (M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "internal error: entered unreachable code" |) ]
                            |)
                          |)))
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_bulk_steal_right :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "bulk_steal_right" (bulk_steal_right K V).
        Admitted.
        Global Typeclasses Opaque bulk_steal_right.
      End Impl_alloc_collections_btree_node_BalancingContext_K_V.
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_Edge.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            pub fn forget_node_type(
                self,
            ) -> Handle<NodeRef<BorrowType, K, V, marker::LeafOrInternal>, marker::Edge> {
                unsafe { Handle::new_edge(self.node.forget_type(), self.idx) }
            }
        *)
        Definition forget_node_type
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ];
                    Ty.path "alloc::collections::btree::node::marker::Edge"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::Edge"
                    ],
                  "new_edge",
                  [],
                  []
                |),
                [
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "forget_type",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |);
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_node_type :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V)
            "forget_node_type"
            (forget_node_type BorrowType K V).
        Admitted.
        Global Typeclasses Opaque forget_node_type.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_Edge.
      
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_KV.
        Definition Self (BorrowType K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ];
              Ty.path "alloc::collections::btree::node::marker::KV"
            ].
        
        (*
            pub fn forget_node_type(
                self,
            ) -> Handle<NodeRef<BorrowType, K, V, marker::LeafOrInternal>, marker::KV> {
                unsafe { Handle::new_kv(self.node.forget_type(), self.idx) }
            }
        *)
        Definition forget_node_type
            (BorrowType K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  self
                |) in
              M.call_closure (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::Handle")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ];
                    Ty.path "alloc::collections::btree::node::marker::KV"
                  ],
                M.get_associated_function (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Ty.path "alloc::collections::btree::node::marker::KV"
                    ],
                  "new_kv",
                  [],
                  []
                |),
                [
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        BorrowType;
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ],
                      "forget_type",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |);
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      self,
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |)
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_node_type :
          forall (BorrowType K V : Ty.t),
          M.IsAssociatedFunction.C
            (Self BorrowType K V)
            "forget_node_type"
            (forget_node_type BorrowType K V).
        Admitted.
        Global Typeclasses Opaque forget_node_type.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_Leaf_alloc_collections_btree_node_marker_KV.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_LeafOrInternal_Type_.
        Definition Self (BorrowType K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  BorrowType;
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                ];
              Type_
            ].
        
        (*
            pub fn force(
                self,
            ) -> ForceResult<
                Handle<NodeRef<BorrowType, K, V, marker::Leaf>, Type>,
                Handle<NodeRef<BorrowType, K, V, marker::Internal>, Type>,
            > {
                match self.node.force() {
                    ForceResult::Leaf(node) => {
                        ForceResult::Leaf(Handle { node, idx: self.idx, _marker: PhantomData })
                    }
                    ForceResult::Internal(node) => {
                        ForceResult::Internal(Handle { node, idx: self.idx, _marker: PhantomData })
                    }
                }
            }
        *)
        Definition force
            (BorrowType K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self BorrowType K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Type_
                    ],
                  self
                |) in
              M.match_operator (|
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::ForceResult")
                  []
                  [
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            BorrowType;
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Type_
                      ];
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::Handle")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            BorrowType;
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ];
                        Type_
                      ]
                  ],
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::ForceResult")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [ BorrowType; K; V; Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Internal"
                        ]
                    ],
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::ForceResult")
                      []
                      [
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            BorrowType;
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ];
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            BorrowType;
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ]
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          BorrowType;
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "force",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |)
                |),
                [
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 :=
                        M.SubPointer.get_struct_tuple_field (|
                          γ,
                          "alloc::collections::btree::node::ForceResult::Leaf",
                          0
                        |) in
                      let node :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Leaf"
                            ],
                          γ0_0
                        |) in
                      Value.StructTuple
                        "alloc::collections::btree::node::ForceResult::Leaf'1"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Type_
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Type_
                            ]
                        ]
                        [
                          Value.mkStructRecord
                            "alloc::collections::btree::node::Handle"
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Type_
                            ]
                            [
                              ("node", M.read (| node |));
                              ("idx",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::Handle",
                                    "idx"
                                  |)
                                |));
                              ("_marker",
                                Value.StructTuple "core::marker::PhantomData" [] [ Type_ ] [])
                            ]
                        ]));
                  fun γ =>
                    ltac:(M.monadic
                      (let γ0_0 :=
                        M.SubPointer.get_struct_tuple_field (|
                          γ,
                          "alloc::collections::btree::node::ForceResult::Internal",
                          0
                        |) in
                      let node :=
                        M.copy (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              BorrowType;
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::Internal"
                            ],
                          γ0_0
                        |) in
                      Value.StructTuple
                        "alloc::collections::btree::node::ForceResult::Internal'1"
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Leaf"
                                ];
                              Type_
                            ];
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Type_
                            ]
                        ]
                        [
                          Value.mkStructRecord
                            "alloc::collections::btree::node::Handle"
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  BorrowType;
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::Internal"
                                ];
                              Type_
                            ]
                            [
                              ("node", M.read (| node |));
                              ("idx",
                                M.read (|
                                  M.SubPointer.get_struct_record_field (|
                                    self,
                                    "alloc::collections::btree::node::Handle",
                                    "idx"
                                  |)
                                |));
                              ("_marker",
                                Value.StructTuple "core::marker::PhantomData" [] [ Type_ ] [])
                            ]
                        ]))
                ]
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_force :
          forall (BorrowType K V Type_ : Ty.t),
          M.IsAssociatedFunction.C (Self BorrowType K V Type_) "force" (force BorrowType K V Type_).
        Admitted.
        Global Typeclasses Opaque force.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_BorrowType_K_V_alloc_collections_btree_node_marker_LeafOrInternal_Type_.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal_Type_.
        Definition Self (K V Type_ : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                ];
              Type_
            ].
        
        (*
            pub unsafe fn cast_to_leaf_unchecked(
                self,
            ) -> Handle<NodeRef<marker::Mut<'a>, K, V, marker::Leaf>, Type> {
                let node = unsafe { self.node.cast_to_leaf_unchecked() };
                Handle { node, idx: self.idx, _marker: PhantomData }
            }
        *)
        Definition cast_to_leaf_unchecked
            (K V Type_ : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V Type_ in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ];
                      Type_
                    ],
                  self
                |) in
              M.read (|
                let~ node :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::Leaf"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "cast_to_leaf_unchecked",
                      [],
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          self,
                          "alloc::collections::btree::node::Handle",
                          "node"
                        |)
                      |)
                    ]
                  |) in
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::Handle")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Type_
                    ],
                  Value.mkStructRecord
                    "alloc::collections::btree::node::Handle"
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::Leaf"
                        ];
                      Type_
                    ]
                    [
                      ("node", M.read (| node |));
                      ("idx",
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::Handle",
                            "idx"
                          |)
                        |));
                      ("_marker", Value.StructTuple "core::marker::PhantomData" [] [ Type_ ] [])
                    ]
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_cast_to_leaf_unchecked :
          forall (K V Type_ : Ty.t),
          M.IsAssociatedFunction.C
            (Self K V Type_)
            "cast_to_leaf_unchecked"
            (cast_to_leaf_unchecked K V Type_).
        Admitted.
        Global Typeclasses Opaque cast_to_leaf_unchecked.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal_Type_.
      
      Module Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal_alloc_collections_btree_node_marker_Edge.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::Handle")
            []
            [
              Ty.apply
                (Ty.path "alloc::collections::btree::node::NodeRef")
                []
                [
                  Ty.path "alloc::collections::btree::node::marker::Mut";
                  K;
                  V;
                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                ];
              Ty.path "alloc::collections::btree::node::marker::Edge"
            ].
        
        (*
            pub fn move_suffix(
                &mut self,
                right: &mut NodeRef<marker::Mut<'a>, K, V, marker::LeafOrInternal>,
            ) {
                unsafe {
                    let new_left_len = self.idx;
                    let mut left_node = self.reborrow_mut().into_node();
                    let old_left_len = left_node.len();
        
                    let new_right_len = old_left_len - new_left_len;
                    let mut right_node = right.reborrow_mut();
        
                    assert!(right_node.len() == 0);
                    assert!(left_node.height == right_node.height);
        
                    if new_right_len > 0 {
                        *left_node.len_mut() = new_left_len as u16;
                        *right_node.len_mut() = new_right_len as u16;
        
                        move_to_slice(
                            left_node.key_area_mut(new_left_len..old_left_len),
                            right_node.key_area_mut(..new_right_len),
                        );
                        move_to_slice(
                            left_node.val_area_mut(new_left_len..old_left_len),
                            right_node.val_area_mut(..new_right_len),
                        );
                        match (left_node.force(), right_node.force()) {
                            (ForceResult::Internal(mut left), ForceResult::Internal(mut right)) => {
                                move_to_slice(
                                    left.edge_area_mut(new_left_len + 1..old_left_len + 1),
                                    right.edge_area_mut(1..new_right_len + 1),
                                );
                                right.correct_childrens_parent_links(1..new_right_len + 1);
                            }
                            (ForceResult::Leaf(_), ForceResult::Leaf(_)) => {}
                            _ => unreachable!(),
                        }
                    }
                }
            }
        *)
        Definition move_suffix
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self; _ as right ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ]
                    ],
                  self
                |) in
              let right :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "&mut")
                    []
                    [
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ]
                    ],
                  right
                |) in
              M.read (|
                let~ new_left_len : Ty.path "usize" :=
                  M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.deref (| M.read (| self |) |),
                      "alloc::collections::btree::node::Handle",
                      "idx"
                    |)
                  |) in
                let~ left_node :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::Handle")
                        []
                        [
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::NodeRef")
                            []
                            [
                              Ty.path "alloc::collections::btree::node::marker::Mut";
                              K;
                              V;
                              Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                            ];
                          Ty.path "alloc::collections::btree::node::marker::Edge"
                        ],
                      "into_node",
                      [],
                      []
                    |),
                    [
                      M.call_closure (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::Handle")
                          []
                          [
                            Ty.apply
                              (Ty.path "alloc::collections::btree::node::NodeRef")
                              []
                              [
                                Ty.path "alloc::collections::btree::node::marker::Mut";
                                K;
                                V;
                                Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                              ];
                            Ty.path "alloc::collections::btree::node::marker::Edge"
                          ],
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::collections::btree::node::Handle")
                            []
                            [
                              Ty.apply
                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                []
                                [
                                  Ty.path "alloc::collections::btree::node::marker::Mut";
                                  K;
                                  V;
                                  Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                                ];
                              Ty.path "alloc::collections::btree::node::marker::Edge"
                            ],
                          "reborrow_mut",
                          [],
                          []
                        |),
                        [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| self |) |) |) ]
                      |)
                    ]
                  |) in
                let~ old_left_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "len",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.Ref, left_node |) ]
                  |) in
                let~ new_right_len : Ty.path "usize" :=
                  M.call_closure (|
                    Ty.path "usize",
                    BinOp.Wrap.sub,
                    [ M.read (| old_left_len |); M.read (| new_left_len |) ]
                  |) in
                let~ right_node :
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ] :=
                  M.call_closure (|
                    Ty.apply
                      (Ty.path "alloc::collections::btree::node::NodeRef")
                      []
                      [
                        Ty.path "alloc::collections::btree::node::marker::Mut";
                        K;
                        V;
                        Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                      ],
                    M.get_associated_function (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      "reborrow_mut",
                      [],
                      []
                    |),
                    [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| right |) |) |) ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.eq,
                                      [
                                        M.call_closure (|
                                          Ty.path "usize",
                                          M.get_associated_function (|
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::LeafOrInternal"
                                              ],
                                            "len",
                                            [],
                                            []
                                          |),
                                          [ M.borrow (| Pointer.Kind.Ref, right_node |) ]
                                        |);
                                        Value.Integer IntegerKind.Usize 0
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [ mk_str (| "assertion failed: right_node.len() == 0" |) ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                let~ _ : Ty.tuple [] :=
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  UnOp.not,
                                  [
                                    M.call_closure (|
                                      Ty.path "bool",
                                      BinOp.eq,
                                      [
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            left_node,
                                            "alloc::collections::btree::node::NodeRef",
                                            "height"
                                          |)
                                        |);
                                        M.read (|
                                          M.SubPointer.get_struct_record_field (|
                                            right_node,
                                            "alloc::collections::btree::node::NodeRef",
                                            "height"
                                          |)
                                        |)
                                      ]
                                    |)
                                  ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.never_to_any (|
                            M.call_closure (|
                              Ty.path "never",
                              M.get_function (| "core::panicking::panic", [], [] |),
                              [
                                mk_str (|
                                  "assertion failed: left_node.height == right_node.height"
                                |)
                              ]
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |) in
                M.alloc (|
                  Ty.tuple [],
                  M.match_operator (|
                    Ty.tuple [],
                    M.alloc (| Ty.tuple [], Value.Tuple [] |),
                    [
                      fun γ =>
                        ltac:(M.monadic
                          (let γ :=
                            M.use
                              (M.alloc (|
                                Ty.path "bool",
                                M.call_closure (|
                                  Ty.path "bool",
                                  BinOp.gt,
                                  [ M.read (| new_right_len |); Value.Integer IntegerKind.Usize 0 ]
                                |)
                              |)) in
                          let _ :=
                            is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                          M.read (|
                            let~ _ : Ty.tuple [] :=
                              M.write (|
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::LeafOrInternal"
                                        ],
                                      "len_mut",
                                      [],
                                      []
                                    |),
                                    [ M.borrow (| Pointer.Kind.MutRef, left_node |) ]
                                  |)
                                |),
                                M.cast (Ty.path "u16") (M.read (| new_left_len |))
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.write (|
                                M.deref (|
                                  M.call_closure (|
                                    Ty.apply (Ty.path "&mut") [] [ Ty.path "u16" ],
                                    M.get_associated_function (|
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::NodeRef")
                                        []
                                        [
                                          Ty.path "alloc::collections::btree::node::marker::Mut";
                                          K;
                                          V;
                                          Ty.path
                                            "alloc::collections::btree::node::marker::LeafOrInternal"
                                        ],
                                      "len_mut",
                                      [],
                                      []
                                    |),
                                    [ M.borrow (| Pointer.Kind.MutRef, right_node |) ]
                                  |)
                                |),
                                M.cast (Ty.path "u16") (M.read (| new_right_len |))
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [ K ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start", M.read (| new_left_len |));
                                              ("end_", M.read (| old_left_len |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "key_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ K ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| new_right_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            let~ _ : Ty.tuple [] :=
                              M.call_closure (|
                                Ty.tuple [],
                                M.get_function (|
                                  "alloc::collections::btree::node::move_to_slice",
                                  [],
                                  [ V ]
                                |),
                                [
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::Range")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, left_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::Range"
                                            []
                                            [ Ty.path "usize" ]
                                            [
                                              ("start", M.read (| new_left_len |));
                                              ("end_", M.read (| old_left_len |))
                                            ]
                                        ]
                                      |)
                                    |)
                                  |);
                                  M.borrow (|
                                    Pointer.Kind.MutRef,
                                    M.deref (|
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "&mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "val_area_mut",
                                          [],
                                          [
                                            Ty.apply
                                              (Ty.path "core::ops::range::RangeTo")
                                              []
                                              [ Ty.path "usize" ];
                                            Ty.apply
                                              (Ty.path "slice")
                                              []
                                              [
                                                Ty.apply
                                                  (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                  []
                                                  [ V ]
                                              ]
                                          ]
                                        |),
                                        [
                                          M.borrow (| Pointer.Kind.MutRef, right_node |);
                                          Value.mkStructRecord
                                            "core::ops::range::RangeTo"
                                            []
                                            [ Ty.path "usize" ]
                                            [ ("end_", M.read (| new_right_len |)) ]
                                        ]
                                      |)
                                    |)
                                  |)
                                ]
                              |) in
                            M.alloc (|
                              Ty.tuple [],
                              M.match_operator (|
                                Ty.tuple [],
                                M.alloc (|
                                  Ty.tuple
                                    [
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::ForceResult")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ]
                                        ];
                                      Ty.apply
                                        (Ty.path "alloc::collections::btree::node::ForceResult")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Leaf"
                                            ];
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ]
                                        ]
                                    ],
                                  Value.Tuple
                                    [
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::ForceResult")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Leaf"
                                              ];
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "force",
                                          [],
                                          []
                                        |),
                                        [ M.read (| left_node |) ]
                                      |);
                                      M.call_closure (|
                                        Ty.apply
                                          (Ty.path "alloc::collections::btree::node::ForceResult")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Leaf"
                                              ];
                                            Ty.apply
                                              (Ty.path "alloc::collections::btree::node::NodeRef")
                                              []
                                              [
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Mut";
                                                K;
                                                V;
                                                Ty.path
                                                  "alloc::collections::btree::node::marker::Internal"
                                              ]
                                          ],
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::LeafOrInternal"
                                            ],
                                          "force",
                                          [],
                                          []
                                        |),
                                        [ M.read (| right_node |) ]
                                      |)
                                    ]
                                |),
                                [
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                                      let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                                      let γ1_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ0_0,
                                          "alloc::collections::btree::node::ForceResult::Internal",
                                          0
                                        |) in
                                      let left :=
                                        M.copy (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          γ1_0
                                        |) in
                                      let γ1_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ0_1,
                                          "alloc::collections::btree::node::ForceResult::Internal",
                                          0
                                        |) in
                                      let right :=
                                        M.copy (|
                                          Ty.apply
                                            (Ty.path "alloc::collections::btree::node::NodeRef")
                                            []
                                            [
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Mut";
                                              K;
                                              V;
                                              Ty.path
                                                "alloc::collections::btree::node::marker::Internal"
                                            ],
                                          γ1_0
                                        |) in
                                      M.read (|
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_function (|
                                              "alloc::collections::btree::node::move_to_slice",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ptr::non_null::NonNull")
                                                  []
                                                  [
                                                    Ty.apply
                                                      (Ty.path
                                                        "alloc::collections::btree::node::LeafNode")
                                                      []
                                                      [ K; V ]
                                                  ]
                                              ]
                                            |),
                                            [
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (|
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path "&mut")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "edge_area_mut",
                                                      [],
                                                      [
                                                        Ty.apply
                                                          (Ty.path "core::ops::range::Range")
                                                          []
                                                          [ Ty.path "usize" ];
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ]
                                                    |),
                                                    [
                                                      M.borrow (| Pointer.Kind.MutRef, left |);
                                                      Value.mkStructRecord
                                                        "core::ops::range::Range"
                                                        []
                                                        [ Ty.path "usize" ]
                                                        [
                                                          ("start",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| new_left_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |));
                                                          ("end_",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| old_left_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |))
                                                        ]
                                                    ]
                                                  |)
                                                |)
                                              |);
                                              M.borrow (|
                                                Pointer.Kind.MutRef,
                                                M.deref (|
                                                  M.call_closure (|
                                                    Ty.apply
                                                      (Ty.path "&mut")
                                                      []
                                                      [
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ],
                                                    M.get_associated_function (|
                                                      Ty.apply
                                                        (Ty.path
                                                          "alloc::collections::btree::node::NodeRef")
                                                        []
                                                        [
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Mut";
                                                          K;
                                                          V;
                                                          Ty.path
                                                            "alloc::collections::btree::node::marker::Internal"
                                                        ],
                                                      "edge_area_mut",
                                                      [],
                                                      [
                                                        Ty.apply
                                                          (Ty.path "core::ops::range::Range")
                                                          []
                                                          [ Ty.path "usize" ];
                                                        Ty.apply
                                                          (Ty.path "slice")
                                                          []
                                                          [
                                                            Ty.apply
                                                              (Ty.path
                                                                "core::mem::maybe_uninit::MaybeUninit")
                                                              []
                                                              [
                                                                Ty.apply
                                                                  (Ty.path
                                                                    "core::ptr::non_null::NonNull")
                                                                  []
                                                                  [
                                                                    Ty.apply
                                                                      (Ty.path
                                                                        "alloc::collections::btree::node::LeafNode")
                                                                      []
                                                                      [ K; V ]
                                                                  ]
                                                              ]
                                                          ]
                                                      ]
                                                    |),
                                                    [
                                                      M.borrow (| Pointer.Kind.MutRef, right |);
                                                      Value.mkStructRecord
                                                        "core::ops::range::Range"
                                                        []
                                                        [ Ty.path "usize" ]
                                                        [
                                                          ("start",
                                                            Value.Integer IntegerKind.Usize 1);
                                                          ("end_",
                                                            M.call_closure (|
                                                              Ty.path "usize",
                                                              BinOp.Wrap.add,
                                                              [
                                                                M.read (| new_right_len |);
                                                                Value.Integer IntegerKind.Usize 1
                                                              ]
                                                            |))
                                                        ]
                                                    ]
                                                  |)
                                                |)
                                              |)
                                            ]
                                          |) in
                                        let~ _ : Ty.tuple [] :=
                                          M.call_closure (|
                                            Ty.tuple [],
                                            M.get_associated_function (|
                                              Ty.apply
                                                (Ty.path "alloc::collections::btree::node::NodeRef")
                                                []
                                                [
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Mut";
                                                  K;
                                                  V;
                                                  Ty.path
                                                    "alloc::collections::btree::node::marker::Internal"
                                                ],
                                              "correct_childrens_parent_links",
                                              [],
                                              [
                                                Ty.apply
                                                  (Ty.path "core::ops::range::Range")
                                                  []
                                                  [ Ty.path "usize" ]
                                              ]
                                            |),
                                            [
                                              M.borrow (| Pointer.Kind.MutRef, right |);
                                              Value.mkStructRecord
                                                "core::ops::range::Range"
                                                []
                                                [ Ty.path "usize" ]
                                                [
                                                  ("start", Value.Integer IntegerKind.Usize 1);
                                                  ("end_",
                                                    M.call_closure (|
                                                      Ty.path "usize",
                                                      BinOp.Wrap.add,
                                                      [
                                                        M.read (| new_right_len |);
                                                        Value.Integer IntegerKind.Usize 1
                                                      ]
                                                    |))
                                                ]
                                            ]
                                          |) in
                                        M.alloc (| Ty.tuple [], Value.Tuple [] |)
                                      |)));
                                  fun γ =>
                                    ltac:(M.monadic
                                      (let γ0_0 := M.SubPointer.get_tuple_field (| γ, 0 |) in
                                      let γ0_1 := M.SubPointer.get_tuple_field (| γ, 1 |) in
                                      let γ1_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ0_0,
                                          "alloc::collections::btree::node::ForceResult::Leaf",
                                          0
                                        |) in
                                      let γ1_0 :=
                                        M.SubPointer.get_struct_tuple_field (|
                                          γ0_1,
                                          "alloc::collections::btree::node::ForceResult::Leaf",
                                          0
                                        |) in
                                      Value.Tuple []));
                                  fun γ =>
                                    ltac:(M.monadic
                                      (M.never_to_any (|
                                        M.call_closure (|
                                          Ty.path "never",
                                          M.get_function (| "core::panicking::panic", [], [] |),
                                          [ mk_str (| "internal error: entered unreachable code" |)
                                          ]
                                        |)
                                      |)))
                                ]
                              |)
                            |)
                          |)));
                      fun γ => ltac:(M.monadic (Value.Tuple []))
                    ]
                  |)
                |)
              |)))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_move_suffix :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "move_suffix" (move_suffix K V).
        Admitted.
        Global Typeclasses Opaque move_suffix.
      End Impl_alloc_collections_btree_node_Handle_alloc_collections_btree_node_NodeRef_alloc_collections_btree_node_marker_Mut_K_V_alloc_collections_btree_node_marker_LeafOrInternal_alloc_collections_btree_node_marker_Edge.
      
      (*
      Enum ForceResult
      {
        const_params := [];
        ty_params := [ "Leaf"; "Internal" ];
        variants :=
          [
            {
              name := "Leaf";
              item := StructTuple [ Leaf ];
            };
            {
              name := "Internal";
              item := StructTuple [ Internal ];
            }
          ];
      }
      *)
      
      Axiom IsDiscriminant_ForceResult_Leaf :
        M.IsDiscriminant "alloc::collections::btree::node::ForceResult::Leaf" 0.
      Axiom IsDiscriminant_ForceResult_Internal :
        M.IsDiscriminant "alloc::collections::btree::node::ForceResult::Internal" 1.
      
      (* StructRecord
        {
          name := "SplitResult";
          const_params := [];
          ty_params := [ "K"; "V"; "NodeType" ];
          fields :=
            [
              ("left",
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [ Ty.path "alloc::collections::btree::node::marker::Mut"; K; V; NodeType ]);
              ("kv", Ty.tuple [ K; V ]);
              ("right",
                Ty.apply
                  (Ty.path "alloc::collections::btree::node::NodeRef")
                  []
                  [ Ty.path "alloc::collections::btree::node::marker::Owned"; K; V; NodeType ])
            ];
        } *)
      
      Module Impl_alloc_collections_btree_node_SplitResult_K_V_alloc_collections_btree_node_marker_Leaf.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::SplitResult")
            []
            [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ].
        
        (*
            pub fn forget_node_type(self) -> SplitResult<'a, K, V, marker::LeafOrInternal> {
                SplitResult { left: self.left.forget_type(), kv: self.kv, right: self.right.forget_type() }
            }
        *)
        Definition forget_node_type
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::SplitResult")
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Leaf" ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::SplitResult"
                []
                [ K; V; Ty.path "alloc::collections::btree::node::marker::LeafOrInternal" ]
                [
                  ("left",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ],
                        "forget_type",
                        [],
                        []
                      |),
                      [
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::SplitResult",
                            "left"
                          |)
                        |)
                      ]
                    |));
                  ("kv",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::SplitResult",
                        "kv"
                      |)
                    |));
                  ("right",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Owned";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Leaf"
                          ],
                        "forget_type",
                        [],
                        []
                      |),
                      [
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::SplitResult",
                            "right"
                          |)
                        |)
                      ]
                    |))
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_node_type :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "forget_node_type" (forget_node_type K V).
        Admitted.
        Global Typeclasses Opaque forget_node_type.
      End Impl_alloc_collections_btree_node_SplitResult_K_V_alloc_collections_btree_node_marker_Leaf.
      
      Module Impl_alloc_collections_btree_node_SplitResult_K_V_alloc_collections_btree_node_marker_Internal.
        Definition Self (K V : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "alloc::collections::btree::node::SplitResult")
            []
            [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ].
        
        (*
            pub fn forget_node_type(self) -> SplitResult<'a, K, V, marker::LeafOrInternal> {
                SplitResult { left: self.left.forget_type(), kv: self.kv, right: self.right.forget_type() }
            }
        *)
        Definition forget_node_type
            (K V : Ty.t)
            (ε : list Value.t)
            (τ : list Ty.t)
            (α : list Value.t)
            : M :=
          let Self : Ty.t := Self K V in
          match ε, τ, α with
          | [], [], [ self ] =>
            ltac:(M.monadic
              (let self :=
                M.alloc (|
                  Ty.apply
                    (Ty.path "alloc::collections::btree::node::SplitResult")
                    []
                    [ K; V; Ty.path "alloc::collections::btree::node::marker::Internal" ],
                  self
                |) in
              Value.mkStructRecord
                "alloc::collections::btree::node::SplitResult"
                []
                [ K; V; Ty.path "alloc::collections::btree::node::marker::LeafOrInternal" ]
                [
                  ("left",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Mut";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Mut";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ],
                        "forget_type",
                        [],
                        []
                      |),
                      [
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::SplitResult",
                            "left"
                          |)
                        |)
                      ]
                    |));
                  ("kv",
                    M.read (|
                      M.SubPointer.get_struct_record_field (|
                        self,
                        "alloc::collections::btree::node::SplitResult",
                        "kv"
                      |)
                    |));
                  ("right",
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "alloc::collections::btree::node::NodeRef")
                        []
                        [
                          Ty.path "alloc::collections::btree::node::marker::Owned";
                          K;
                          V;
                          Ty.path "alloc::collections::btree::node::marker::LeafOrInternal"
                        ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "alloc::collections::btree::node::NodeRef")
                          []
                          [
                            Ty.path "alloc::collections::btree::node::marker::Owned";
                            K;
                            V;
                            Ty.path "alloc::collections::btree::node::marker::Internal"
                          ],
                        "forget_type",
                        [],
                        []
                      |),
                      [
                        M.read (|
                          M.SubPointer.get_struct_record_field (|
                            self,
                            "alloc::collections::btree::node::SplitResult",
                            "right"
                          |)
                        |)
                      ]
                    |))
                ]))
          | _, _, _ => M.impossible "wrong number of arguments"
          end.
        
        Global Instance AssociatedFunction_forget_node_type :
          forall (K V : Ty.t),
          M.IsAssociatedFunction.C (Self K V) "forget_node_type" (forget_node_type K V).
        Admitted.
        Global Typeclasses Opaque forget_node_type.
      End Impl_alloc_collections_btree_node_SplitResult_K_V_alloc_collections_btree_node_marker_Internal.
      
      Module marker.
        (*
        Enum Leaf
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum Internal
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum LeafOrInternal
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum Owned
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum Dying
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum DormantMut
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (* StructTuple
          {
            name := "Immut";
            const_params := [];
            ty_params := [];
            fields :=
              [
                Ty.apply
                  (Ty.path "core::marker::PhantomData")
                  []
                  [ Ty.apply (Ty.path "&") [] [ Ty.tuple [] ] ]
              ];
          } *)
        
        (* StructTuple
          {
            name := "Mut";
            const_params := [];
            ty_params := [];
            fields :=
              [
                Ty.apply
                  (Ty.path "core::marker::PhantomData")
                  []
                  [ Ty.apply (Ty.path "&mut") [] [ Ty.tuple [] ] ]
              ];
          } *)
        
        (* StructTuple
          {
            name := "ValMut";
            const_params := [];
            ty_params := [];
            fields :=
              [
                Ty.apply
                  (Ty.path "core::marker::PhantomData")
                  []
                  [ Ty.apply (Ty.path "&mut") [] [ Ty.tuple [] ] ]
              ];
          } *)
        
        (* Trait *)
        (* Empty module 'BorrowType' *)
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Owned.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::Owned".
          
          (*         const TRAVERSAL_PERMIT: bool = false; *)
          (* Ty.path "bool" *)
          Definition value_TRAVERSAL_PERMIT
              (ε : list Value.t)
              (τ : list Ty.t)
              (α : list Value.t)
              : M :=
            ltac:(M.monadic (M.alloc (| Ty.path "bool", Value.Bool false |))).
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *)
              [ ("value_TRAVERSAL_PERMIT", InstanceField.Method value_TRAVERSAL_PERMIT) ].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Owned.
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Dying.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::Dying".
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *) [].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Dying.
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Immut.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::Immut".
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *) [].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Immut.
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Mut.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::Mut".
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *) [].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_Mut.
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_ValMut.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::ValMut".
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *) [].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_ValMut.
        
        Module Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_DormantMut.
          Definition Self : Ty.t := Ty.path "alloc::collections::btree::node::marker::DormantMut".
          
          Axiom Implements :
            M.IsTraitInstance
              "alloc::collections::btree::node::marker::BorrowType"
              (* Trait polymorphic consts *) []
              (* Trait polymorphic types *) []
              Self
              (* Instance *) [].
        End Impl_alloc_collections_btree_node_marker_BorrowType_for_alloc_collections_btree_node_marker_DormantMut.
        
        (*
        Enum KV
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
        
        (*
        Enum Edge
        {
          const_params := [];
          ty_params := [];
          variants := [];
        }
        *)
        
      End marker.
      
      (*
      unsafe fn slice_insert<T>(slice: &mut [MaybeUninit<T>], idx: usize, val: T) {
          unsafe {
              let len = slice.len();
              debug_assert!(len > idx);
              let slice_ptr = slice.as_mut_ptr();
              if len > idx + 1 {
                  ptr::copy(slice_ptr.add(idx), slice_ptr.add(idx + 1), len - idx - 1);
              }
              ( *slice_ptr.add(idx)).write(val);
          }
      }
      *)
      Definition slice_insert (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [ T ], [ slice; idx; val ] =>
          ltac:(M.monadic
            (let slice :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                slice
              |) in
            let idx := M.alloc (| Ty.path "usize", idx |) in
            let val := M.alloc (| T, val |) in
            M.read (|
              let~ len : Ty.path "usize" :=
                M.call_closure (|
                  Ty.path "usize",
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "len",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.match_operator (|
                  Ty.tuple [],
                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                        let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                        M.read (|
                          let~ _ : Ty.tuple [] :=
                            M.match_operator (|
                              Ty.tuple [],
                              M.alloc (| Ty.tuple [], Value.Tuple [] |),
                              [
                                fun γ =>
                                  ltac:(M.monadic
                                    (let γ :=
                                      M.use
                                        (M.alloc (|
                                          Ty.path "bool",
                                          M.call_closure (|
                                            Ty.path "bool",
                                            UnOp.not,
                                            [
                                              M.call_closure (|
                                                Ty.path "bool",
                                                BinOp.gt,
                                                [ M.read (| len |); M.read (| idx |) ]
                                              |)
                                            ]
                                          |)
                                        |)) in
                                    let _ :=
                                      is_constant_or_break_match (|
                                        M.read (| γ |),
                                        Value.Bool true
                                      |) in
                                    M.never_to_any (|
                                      M.call_closure (|
                                        Ty.path "never",
                                        M.get_function (| "core::panicking::panic", [], [] |),
                                        [ mk_str (| "assertion failed: len > idx" |) ]
                                      |)
                                    |)));
                                fun γ => ltac:(M.monadic (Value.Tuple []))
                              ]
                            |) in
                          M.alloc (| Ty.tuple [], Value.Tuple [] |)
                        |)));
                    fun γ => ltac:(M.monadic (Value.Tuple []))
                  ]
                |) in
              let~ slice_ptr :
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ] :=
                M.call_closure (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "as_mut_ptr",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.match_operator (|
                  Ty.tuple [],
                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (let γ :=
                          M.use
                            (M.alloc (|
                              Ty.path "bool",
                              M.call_closure (|
                                Ty.path "bool",
                                BinOp.gt,
                                [
                                  M.read (| len |);
                                  M.call_closure (|
                                    Ty.path "usize",
                                    BinOp.Wrap.add,
                                    [ M.read (| idx |); Value.Integer IntegerKind.Usize 1 ]
                                  |)
                                ]
                              |)
                            |)) in
                        let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                        M.read (|
                          let~ _ : Ty.tuple [] :=
                            M.call_closure (|
                              Ty.tuple [],
                              M.get_function (|
                                "core::intrinsics::copy",
                                [],
                                [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                                ]
                              |),
                              [
                                M.call_closure (|
                                  Ty.apply
                                    (Ty.path "*const")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ T ]
                                    ],
                                  M.pointer_coercion
                                    M.PointerCoercion.MutToConstPointer
                                    (Ty.apply
                                      (Ty.path "*mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ T ]
                                      ])
                                    (Ty.apply
                                      (Ty.path "*const")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ T ]
                                      ]),
                                  [
                                    M.call_closure (|
                                      Ty.apply
                                        (Ty.path "*mut")
                                        []
                                        [
                                          Ty.apply
                                            (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                            []
                                            [ T ]
                                        ],
                                      M.get_associated_function (|
                                        Ty.apply
                                          (Ty.path "*mut")
                                          []
                                          [
                                            Ty.apply
                                              (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                              []
                                              [ T ]
                                          ],
                                        "add",
                                        [],
                                        []
                                      |),
                                      [ M.read (| slice_ptr |); M.read (| idx |) ]
                                    |)
                                  ]
                                |);
                                M.call_closure (|
                                  Ty.apply
                                    (Ty.path "*mut")
                                    []
                                    [
                                      Ty.apply
                                        (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                        []
                                        [ T ]
                                    ],
                                  M.get_associated_function (|
                                    Ty.apply
                                      (Ty.path "*mut")
                                      []
                                      [
                                        Ty.apply
                                          (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                          []
                                          [ T ]
                                      ],
                                    "add",
                                    [],
                                    []
                                  |),
                                  [
                                    M.read (| slice_ptr |);
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.add,
                                      [ M.read (| idx |); Value.Integer IntegerKind.Usize 1 ]
                                    |)
                                  ]
                                |);
                                M.call_closure (|
                                  Ty.path "usize",
                                  BinOp.Wrap.sub,
                                  [
                                    M.call_closure (|
                                      Ty.path "usize",
                                      BinOp.Wrap.sub,
                                      [ M.read (| len |); M.read (| idx |) ]
                                    |);
                                    Value.Integer IntegerKind.Usize 1
                                  ]
                                |)
                              ]
                            |) in
                          M.alloc (| Ty.tuple [], Value.Tuple [] |)
                        |)));
                    fun γ => ltac:(M.monadic (Value.Tuple []))
                  ]
                |) in
              let~ _ : Ty.apply (Ty.path "&mut") [] [ T ] :=
                M.call_closure (|
                  Ty.apply (Ty.path "&mut") [] [ T ],
                  M.get_associated_function (|
                    Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ],
                    "write",
                    [],
                    []
                  |),
                  [
                    M.borrow (|
                      Pointer.Kind.MutRef,
                      M.deref (|
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "*mut")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "*mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "add",
                            [],
                            []
                          |),
                          [ M.read (| slice_ptr |); M.read (| idx |) ]
                        |)
                      |)
                    |);
                    M.read (| val |)
                  ]
                |) in
              M.alloc (| Ty.tuple [], Value.Tuple [] |)
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_slice_insert :
        M.IsFunction.C "alloc::collections::btree::node::slice_insert" slice_insert.
      Admitted.
      Global Typeclasses Opaque slice_insert.
      
      (*
      unsafe fn slice_remove<T>(slice: &mut [MaybeUninit<T>], idx: usize) -> T {
          unsafe {
              let len = slice.len();
              debug_assert!(idx < len);
              let slice_ptr = slice.as_mut_ptr();
              let ret = ( *slice_ptr.add(idx)).assume_init_read();
              ptr::copy(slice_ptr.add(idx + 1), slice_ptr.add(idx), len - idx - 1);
              ret
          }
      }
      *)
      Definition slice_remove (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [ T ], [ slice; idx ] =>
          ltac:(M.monadic
            (let slice :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                slice
              |) in
            let idx := M.alloc (| Ty.path "usize", idx |) in
            M.read (|
              let~ len : Ty.path "usize" :=
                M.call_closure (|
                  Ty.path "usize",
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "len",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.match_operator (|
                  Ty.tuple [],
                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (let γ := M.use (M.alloc (| Ty.path "bool", Value.Bool true |)) in
                        let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                        M.read (|
                          let~ _ : Ty.tuple [] :=
                            M.match_operator (|
                              Ty.tuple [],
                              M.alloc (| Ty.tuple [], Value.Tuple [] |),
                              [
                                fun γ =>
                                  ltac:(M.monadic
                                    (let γ :=
                                      M.use
                                        (M.alloc (|
                                          Ty.path "bool",
                                          M.call_closure (|
                                            Ty.path "bool",
                                            UnOp.not,
                                            [
                                              M.call_closure (|
                                                Ty.path "bool",
                                                BinOp.lt,
                                                [ M.read (| idx |); M.read (| len |) ]
                                              |)
                                            ]
                                          |)
                                        |)) in
                                    let _ :=
                                      is_constant_or_break_match (|
                                        M.read (| γ |),
                                        Value.Bool true
                                      |) in
                                    M.never_to_any (|
                                      M.call_closure (|
                                        Ty.path "never",
                                        M.get_function (| "core::panicking::panic", [], [] |),
                                        [ mk_str (| "assertion failed: idx < len" |) ]
                                      |)
                                    |)));
                                fun γ => ltac:(M.monadic (Value.Tuple []))
                              ]
                            |) in
                          M.alloc (| Ty.tuple [], Value.Tuple [] |)
                        |)));
                    fun γ => ltac:(M.monadic (Value.Tuple []))
                  ]
                |) in
              let~ slice_ptr :
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ] :=
                M.call_closure (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "as_mut_ptr",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ ret : T :=
                M.call_closure (|
                  T,
                  M.get_associated_function (|
                    Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ],
                    "assume_init_read",
                    [],
                    []
                  |),
                  [
                    M.borrow (|
                      Pointer.Kind.Ref,
                      M.deref (|
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "*mut")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "*mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "add",
                            [],
                            []
                          |),
                          [ M.read (| slice_ptr |); M.read (| idx |) ]
                        |)
                      |)
                    |)
                  ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.call_closure (|
                  Ty.tuple [],
                  M.get_function (|
                    "core::intrinsics::copy",
                    [],
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  |),
                  [
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*const")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.pointer_coercion
                        M.PointerCoercion.MutToConstPointer
                        (Ty.apply
                          (Ty.path "*mut")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ])
                        (Ty.apply
                          (Ty.path "*const")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]),
                      [
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "*mut")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "*mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "add",
                            [],
                            []
                          |),
                          [
                            M.read (| slice_ptr |);
                            M.call_closure (|
                              Ty.path "usize",
                              BinOp.Wrap.add,
                              [ M.read (| idx |); Value.Integer IntegerKind.Usize 1 ]
                            |)
                          ]
                        |)
                      ]
                    |);
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*mut")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                        "add",
                        [],
                        []
                      |),
                      [ M.read (| slice_ptr |); M.read (| idx |) ]
                    |);
                    M.call_closure (|
                      Ty.path "usize",
                      BinOp.Wrap.sub,
                      [
                        M.call_closure (|
                          Ty.path "usize",
                          BinOp.Wrap.sub,
                          [ M.read (| len |); M.read (| idx |) ]
                        |);
                        Value.Integer IntegerKind.Usize 1
                      ]
                    |)
                  ]
                |) in
              ret
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_slice_remove :
        M.IsFunction.C "alloc::collections::btree::node::slice_remove" slice_remove.
      Admitted.
      Global Typeclasses Opaque slice_remove.
      
      (*
      unsafe fn slice_shl<T>(slice: &mut [MaybeUninit<T>], distance: usize) {
          unsafe {
              let slice_ptr = slice.as_mut_ptr();
              ptr::copy(slice_ptr.add(distance), slice_ptr, slice.len() - distance);
          }
      }
      *)
      Definition slice_shl (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [ T ], [ slice; distance ] =>
          ltac:(M.monadic
            (let slice :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                slice
              |) in
            let distance := M.alloc (| Ty.path "usize", distance |) in
            M.read (|
              let~ slice_ptr :
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ] :=
                M.call_closure (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "as_mut_ptr",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.call_closure (|
                  Ty.tuple [],
                  M.get_function (|
                    "core::intrinsics::copy",
                    [],
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  |),
                  [
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*const")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.pointer_coercion
                        M.PointerCoercion.MutToConstPointer
                        (Ty.apply
                          (Ty.path "*mut")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ])
                        (Ty.apply
                          (Ty.path "*const")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]),
                      [
                        M.call_closure (|
                          Ty.apply
                            (Ty.path "*mut")
                            []
                            [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "*mut")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "add",
                            [],
                            []
                          |),
                          [ M.read (| slice_ptr |); M.read (| distance |) ]
                        |)
                      ]
                    |);
                    M.read (| slice_ptr |);
                    M.call_closure (|
                      Ty.path "usize",
                      BinOp.Wrap.sub,
                      [
                        M.call_closure (|
                          Ty.path "usize",
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "slice")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "len",
                            [],
                            []
                          |),
                          [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| slice |) |) |) ]
                        |);
                        M.read (| distance |)
                      ]
                    |)
                  ]
                |) in
              M.alloc (| Ty.tuple [], Value.Tuple [] |)
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_slice_shl :
        M.IsFunction.C "alloc::collections::btree::node::slice_shl" slice_shl.
      Admitted.
      Global Typeclasses Opaque slice_shl.
      
      (*
      unsafe fn slice_shr<T>(slice: &mut [MaybeUninit<T>], distance: usize) {
          unsafe {
              let slice_ptr = slice.as_mut_ptr();
              ptr::copy(slice_ptr, slice_ptr.add(distance), slice.len() - distance);
          }
      }
      *)
      Definition slice_shr (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [ T ], [ slice; distance ] =>
          ltac:(M.monadic
            (let slice :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                slice
              |) in
            let distance := M.alloc (| Ty.path "usize", distance |) in
            M.read (|
              let~ slice_ptr :
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ] :=
                M.call_closure (|
                  Ty.apply
                    (Ty.path "*mut")
                    []
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                  M.get_associated_function (|
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                    "as_mut_ptr",
                    [],
                    []
                  |),
                  [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| slice |) |) |) ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.call_closure (|
                  Ty.tuple [],
                  M.get_function (|
                    "core::intrinsics::copy",
                    [],
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  |),
                  [
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*const")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.pointer_coercion
                        M.PointerCoercion.MutToConstPointer
                        (Ty.apply
                          (Ty.path "*mut")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ])
                        (Ty.apply
                          (Ty.path "*const")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]),
                      [ M.read (| slice_ptr |) ]
                    |);
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*mut")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "*mut")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                        "add",
                        [],
                        []
                      |),
                      [ M.read (| slice_ptr |); M.read (| distance |) ]
                    |);
                    M.call_closure (|
                      Ty.path "usize",
                      BinOp.Wrap.sub,
                      [
                        M.call_closure (|
                          Ty.path "usize",
                          M.get_associated_function (|
                            Ty.apply
                              (Ty.path "slice")
                              []
                              [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ]
                              ],
                            "len",
                            [],
                            []
                          |),
                          [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| slice |) |) |) ]
                        |);
                        M.read (| distance |)
                      ]
                    |)
                  ]
                |) in
              M.alloc (| Ty.tuple [], Value.Tuple [] |)
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_slice_shr :
        M.IsFunction.C "alloc::collections::btree::node::slice_shr" slice_shr.
      Admitted.
      Global Typeclasses Opaque slice_shr.
      
      (*
      fn move_to_slice<T>(src: &mut [MaybeUninit<T>], dst: &mut [MaybeUninit<T>]) {
          assert!(src.len() == dst.len());
          unsafe {
              ptr::copy_nonoverlapping(src.as_ptr(), dst.as_mut_ptr(), src.len());
          }
      }
      *)
      Definition move_to_slice (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
        match ε, τ, α with
        | [], [ T ], [ src; dst ] =>
          ltac:(M.monadic
            (let src :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                src
              |) in
            let dst :=
              M.alloc (|
                Ty.apply
                  (Ty.path "&mut")
                  []
                  [
                    Ty.apply
                      (Ty.path "slice")
                      []
                      [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  ],
                dst
              |) in
            M.read (|
              let~ _ : Ty.tuple [] :=
                M.match_operator (|
                  Ty.tuple [],
                  M.alloc (| Ty.tuple [], Value.Tuple [] |),
                  [
                    fun γ =>
                      ltac:(M.monadic
                        (let γ :=
                          M.use
                            (M.alloc (|
                              Ty.path "bool",
                              M.call_closure (|
                                Ty.path "bool",
                                UnOp.not,
                                [
                                  M.call_closure (|
                                    Ty.path "bool",
                                    BinOp.eq,
                                    [
                                      M.call_closure (|
                                        Ty.path "usize",
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ T ]
                                            ],
                                          "len",
                                          [],
                                          []
                                        |),
                                        [
                                          M.borrow (|
                                            Pointer.Kind.Ref,
                                            M.deref (| M.read (| src |) |)
                                          |)
                                        ]
                                      |);
                                      M.call_closure (|
                                        Ty.path "usize",
                                        M.get_associated_function (|
                                          Ty.apply
                                            (Ty.path "slice")
                                            []
                                            [
                                              Ty.apply
                                                (Ty.path "core::mem::maybe_uninit::MaybeUninit")
                                                []
                                                [ T ]
                                            ],
                                          "len",
                                          [],
                                          []
                                        |),
                                        [
                                          M.borrow (|
                                            Pointer.Kind.Ref,
                                            M.deref (| M.read (| dst |) |)
                                          |)
                                        ]
                                      |)
                                    ]
                                  |)
                                ]
                              |)
                            |)) in
                        let _ := is_constant_or_break_match (| M.read (| γ |), Value.Bool true |) in
                        M.never_to_any (|
                          M.call_closure (|
                            Ty.path "never",
                            M.get_function (| "core::panicking::panic", [], [] |),
                            [ mk_str (| "assertion failed: src.len() == dst.len()" |) ]
                          |)
                        |)));
                    fun γ => ltac:(M.monadic (Value.Tuple []))
                  ]
                |) in
              let~ _ : Ty.tuple [] :=
                M.call_closure (|
                  Ty.tuple [],
                  M.get_function (|
                    "core::intrinsics::copy_nonoverlapping",
                    [],
                    [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ]
                  |),
                  [
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*const")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                        "as_ptr",
                        [],
                        []
                      |),
                      [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| src |) |) |) ]
                    |);
                    M.call_closure (|
                      Ty.apply
                        (Ty.path "*mut")
                        []
                        [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                        "as_mut_ptr",
                        [],
                        []
                      |),
                      [ M.borrow (| Pointer.Kind.MutRef, M.deref (| M.read (| dst |) |) |) ]
                    |);
                    M.call_closure (|
                      Ty.path "usize",
                      M.get_associated_function (|
                        Ty.apply
                          (Ty.path "slice")
                          []
                          [ Ty.apply (Ty.path "core::mem::maybe_uninit::MaybeUninit") [] [ T ] ],
                        "len",
                        [],
                        []
                      |),
                      [ M.borrow (| Pointer.Kind.Ref, M.deref (| M.read (| src |) |) |) ]
                    |)
                  ]
                |) in
              M.alloc (| Ty.tuple [], Value.Tuple [] |)
            |)))
        | _, _, _ => M.impossible "wrong number of arguments"
        end.
      
      Global Instance Instance_IsFunction_move_to_slice :
        M.IsFunction.C "alloc::collections::btree::node::move_to_slice" move_to_slice.
      Admitted.
      Global Typeclasses Opaque move_to_slice.
    End node.
  End btree.
End collections.
