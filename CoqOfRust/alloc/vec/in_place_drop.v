(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module vec.
  Module in_place_drop.
    (* StructRecord
      {
        name := "InPlaceDrop";
        ty_params := [ "T" ];
        fields :=
          [ ("inner", Ty.apply (Ty.path "*mut") [ T ]); ("dst", Ty.apply (Ty.path "*mut") [ T ]) ];
      } *)
    
    Module Impl_alloc_vec_in_place_drop_InPlaceDrop_T.
      Definition Self (T : Ty.t) : Ty.t :=
        Ty.apply (Ty.path "alloc::vec::in_place_drop::InPlaceDrop") [ T ].
      
      (*
          fn len(&self) -> usize {
              unsafe { self.dst.sub_ptr(self.inner) }
          }
      *)
      Definition len (T : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
        let Self : Ty.t := Self T in
        match τ, α with
        | [], [ self ] =>
          ltac:(M.monadic
            (let self := M.alloc (| self |) in
            M.call_closure (|
              M.get_associated_function (| Ty.apply (Ty.path "*mut") [ T ], "sub_ptr", [] |),
              [
                M.read (|
                  M.SubPointer.get_struct_record_field (|
                    M.read (| self |),
                    "alloc::vec::in_place_drop::InPlaceDrop",
                    "dst"
                  |)
                |);
                (* MutToConstPointer *)
                M.pointer_coercion
                  (M.read (|
                    M.SubPointer.get_struct_record_field (|
                      M.read (| self |),
                      "alloc::vec::in_place_drop::InPlaceDrop",
                      "inner"
                    |)
                  |))
              ]
            |)))
        | _, _ => M.impossible
        end.
      
      Axiom AssociatedFunction_len :
        forall (T : Ty.t),
        M.IsAssociatedFunction (Self T) "len" (len T).
    End Impl_alloc_vec_in_place_drop_InPlaceDrop_T.
    
    Module Impl_core_ops_drop_Drop_for_alloc_vec_in_place_drop_InPlaceDrop_T.
      Definition Self (T : Ty.t) : Ty.t :=
        Ty.apply (Ty.path "alloc::vec::in_place_drop::InPlaceDrop") [ T ].
      
      (*
          fn drop(&mut self) {
              unsafe {
                  ptr::drop_in_place(slice::from_raw_parts_mut(self.inner, self.len()));
              }
          }
      *)
      Definition drop (T : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
        let Self : Ty.t := Self T in
        match τ, α with
        | [], [ self ] =>
          ltac:(M.monadic
            (let self := M.alloc (| self |) in
            M.read (|
              let~ _ :=
                M.alloc (|
                  M.call_closure (|
                    M.get_function (|
                      "core::ptr::drop_in_place",
                      [ Ty.apply (Ty.path "slice") [ T ] ]
                    |),
                    [
                      M.call_closure (|
                        M.get_function (| "core::slice::raw::from_raw_parts_mut", [ T ] |),
                        [
                          M.read (|
                            M.SubPointer.get_struct_record_field (|
                              M.read (| self |),
                              "alloc::vec::in_place_drop::InPlaceDrop",
                              "inner"
                            |)
                          |);
                          M.call_closure (|
                            M.get_associated_function (|
                              Ty.apply (Ty.path "alloc::vec::in_place_drop::InPlaceDrop") [ T ],
                              "len",
                              []
                            |),
                            [ M.read (| self |) ]
                          |)
                        ]
                      |)
                    ]
                  |)
                |) in
              M.alloc (| Value.Tuple [] |)
            |)))
        | _, _ => M.impossible
        end.
      
      Axiom Implements :
        forall (T : Ty.t),
        M.IsTraitInstance
          "core::ops::drop::Drop"
          (Self T)
          (* Trait polymorphic types *) []
          (* Instance *) [ ("drop", InstanceField.Method (drop T)) ].
    End Impl_core_ops_drop_Drop_for_alloc_vec_in_place_drop_InPlaceDrop_T.
    
    (* StructRecord
      {
        name := "InPlaceDstBufDrop";
        ty_params := [ "T" ];
        fields :=
          [
            ("ptr", Ty.apply (Ty.path "*mut") [ T ]);
            ("len", Ty.path "usize");
            ("cap", Ty.path "usize")
          ];
      } *)
    
    Module Impl_core_ops_drop_Drop_for_alloc_vec_in_place_drop_InPlaceDstBufDrop_T.
      Definition Self (T : Ty.t) : Ty.t :=
        Ty.apply (Ty.path "alloc::vec::in_place_drop::InPlaceDstBufDrop") [ T ].
      
      (*
          fn drop(&mut self) {
              unsafe { super::Vec::from_raw_parts(self.ptr, self.len, self.cap) };
          }
      *)
      Definition drop (T : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
        let Self : Ty.t := Self T in
        match τ, α with
        | [], [ self ] =>
          ltac:(M.monadic
            (let self := M.alloc (| self |) in
            M.read (|
              let~ _ :=
                M.alloc (|
                  M.call_closure (|
                    M.get_associated_function (|
                      Ty.apply (Ty.path "alloc::vec::Vec") [ T; Ty.path "alloc::alloc::Global" ],
                      "from_raw_parts",
                      []
                    |),
                    [
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.read (| self |),
                          "alloc::vec::in_place_drop::InPlaceDstBufDrop",
                          "ptr"
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.read (| self |),
                          "alloc::vec::in_place_drop::InPlaceDstBufDrop",
                          "len"
                        |)
                      |);
                      M.read (|
                        M.SubPointer.get_struct_record_field (|
                          M.read (| self |),
                          "alloc::vec::in_place_drop::InPlaceDstBufDrop",
                          "cap"
                        |)
                      |)
                    ]
                  |)
                |) in
              M.alloc (| Value.Tuple [] |)
            |)))
        | _, _ => M.impossible
        end.
      
      Axiom Implements :
        forall (T : Ty.t),
        M.IsTraitInstance
          "core::ops::drop::Drop"
          (Self T)
          (* Trait polymorphic types *) []
          (* Instance *) [ ("drop", InstanceField.Method (drop T)) ].
    End Impl_core_ops_drop_Drop_for_alloc_vec_in_place_drop_InPlaceDstBufDrop_T.
  End in_place_drop.
End vec.
