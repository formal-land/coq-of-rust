(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

(*
fn with_impls<A>(func: impl Default, func2: impl Default, foo: A) {
    let mut x = func;
    x = Default::default();

    let mut y = func2;
    y = Default::default();

    let z = foo;

    let b = Box::new((x, y, z));
}
*)
Definition with_impls (ðœ : list Ty.t) (Î± : list Value.t) : M :=
  match ðœ, Î± with
  | [ A; impl_Default; impl_Default'1 ], [ func; func2; foo ] =>
    let* func := M.alloc func in
    let* func2 := M.alloc func2 in
    let* foo := M.alloc foo in
    let* x := M.copy func in
    let* _ :=
      let* Î±0 :=
        M.get_trait_method
          "core::default::Default"
          impl_Default
          []
          "default"
          [] in
      let* Î±1 := M.call_closure Î±0 [] in
      M.assign x Î±1 in
    let* y := M.copy func2 in
    let* _ :=
      let* Î±0 :=
        M.get_trait_method
          "core::default::Default"
          impl_Default'1
          []
          "default"
          [] in
      let* Î±1 := M.call_closure Î±0 [] in
      M.assign y Î±1 in
    let* z := M.copy foo in
    let* b :=
      let* Î±0 :=
        M.get_associated_function
          (Ty.apply
            (Ty.path "alloc::boxed::Box")
            [
              Ty.tuple [ impl_Default; impl_Default'1; A ];
              Ty.path "alloc::alloc::Global"
            ])
          "new"
          [] in
      let* Î±1 := M.read x in
      let* Î±2 := M.read y in
      let* Î±3 := M.read z in
      let* Î±4 := M.call_closure Î±0 [ Value.Tuple [ Î±1; Î±2; Î±3 ] ] in
      M.alloc Î±4 in
    let* Î±0 := M.alloc (Value.Tuple []) in
    M.read Î±0
  | _, _ => M.impossible
  end.
