(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module Error.
  Inductive t : Set :=
  .
End Error.

(*
fn set_code_hash<E>(code_hash: &E) -> Result<(), Error> {
    unimplemented!()
}
*)
Definition set_code_hash
    {E : Set}
    (code_hash : ref E)
    : M (core.result.Result.t unit set_code_hash.Error.t) :=
  ltac:(M.monadic (
    let code_hash := M.alloc (| code_hash |) in
    (never_to_any (B := core.result.Result.t unit set_code_hash.Error.t)) (|
      M.call (|(core.panicking.panic (M.read (| mk_str "not implemented" |))) |)
    |)
  )).

Module  Incrementer.
Section Incrementer.
  Record t : Set := {
    count : u32.t;
  }.
  
  Definition Get_count :=
    Ref.map (fun α => Some α.(count)) (fun β α => Some (α <| count := β |>)).
End Incrementer.
End Incrementer.

Module  Impl_core_default_Default_for_set_code_hash_Incrementer_t.
Section Impl_core_default_Default_for_set_code_hash_Incrementer_t.
  Definition Self : Set := set_code_hash.Incrementer.t.
  
  (*
  Default
  *)
  Definition default : M set_code_hash.Incrementer.t :=
    ltac:(M.monadic (
      {|
        set_code_hash.Incrementer.count :=
          M.call (|ltac:(M.get_method (fun ℐ =>
            core.default.Default.default (Self := u32.t) (Trait := ℐ)))
          |);
      |} : set_code_hash.Incrementer.t
    )).
  
  Global Instance AssociatedFunction_default :
    Notations.DoubleColon Self "default" := {
    Notations.double_colon := default;
  }.
  
  Global Instance ℐ : core.default.Default.Trait Self := {
    core.default.Default.default := default;
  }.
End Impl_core_default_Default_for_set_code_hash_Incrementer_t.
End Impl_core_default_Default_for_set_code_hash_Incrementer_t.

Module  Impl_set_code_hash_Incrementer_t.
Section Impl_set_code_hash_Incrementer_t.
  Definition Self : Set := set_code_hash.Incrementer.t.
  
  (*
      pub fn new() -> Self {
          Default::default()
      }
  *)
  Definition new : M Self :=
    ltac:(M.monadic (
      M.call (|ltac:(M.get_method (fun ℐ =>
        core.default.Default.default
          (Self := set_code_hash.Incrementer.t)
          (Trait := ℐ)))
      |)
    )).
  
  Global Instance AssociatedFunction_new : Notations.DoubleColon Self "new" := {
    Notations.double_colon := new;
  }.
  
  (*
      pub fn inc(&mut self) {
          self.count += 1;
          println!(
              "The new count is {}, it was modified using the original contract code.",
              self.count
          );
      }
  *)
  Definition inc (self : mut_ref Self) : M unit :=
    ltac:(M.monadic (
      let self := M.alloc (| self |) in
      M.read (|
        let _ : M.Val unit :=
          let β : M.Val u32.t :=
            set_code_hash.Incrementer.Get_count (deref (M.read (| self |))) in
          assign (|
            β,
            BinOp.Panic.add (| M.read (| β |), (Integer.of_Z 1) : u32.t |)
          |) in
        let _ : M.Val unit :=
          let _ : M.Val unit :=
            M.alloc (|
              M.call (|(std.io.stdio._print
                (M.call (|(core.fmt.Arguments.t::["new_v1"]
                  (pointer_coercion
                    "Unsize"
                    (borrow
                      (M.alloc (|
                        [
                          M.read (| mk_str "The new count is " |);
                          M.read (|
                            mk_str
                              ", it was modified using the original contract code.
"
                          |)
                        ]
                      |))))
                  (pointer_coercion
                    "Unsize"
                    (borrow
                      (M.alloc (|
                        [
                          M.call (|(core.fmt.rt.Argument.t::["new_display"]
                            (borrow
                              (set_code_hash.Incrementer.Get_count
                                (deref (M.read (| self |))))))
                          |)
                        ]
                      |)))))
                |)))
              |)
            |) in
          M.alloc (| tt |) in
        M.alloc (| tt |)
      |)
    )).
  
  Global Instance AssociatedFunction_inc : Notations.DoubleColon Self "inc" := {
    Notations.double_colon := inc;
  }.
  
  (*
      pub fn get(&self) -> u32 {
          self.count
      }
  *)
  Definition get (self : ref Self) : M u32.t :=
    ltac:(M.monadic (
      let self := M.alloc (| self |) in
      M.read (| set_code_hash.Incrementer.Get_count (deref (M.read (| self |)))
      |)
    )).
  
  Global Instance AssociatedFunction_get : Notations.DoubleColon Self "get" := {
    Notations.double_colon := get;
  }.
  
  (*
      pub fn set_code(&mut self, code_hash: [u8; 32]) {
          set_code_hash(&code_hash).unwrap_or_else(|err| {
              panic!("Failed to `set_code_hash` to {code_hash:?} due to {err:?}")
          });
          println!("Switched code hash to {:?}.", code_hash);
      }
  *)
  Definition set_code (self : mut_ref Self) (code_hash : array u8.t) : M unit :=
    ltac:(M.monadic (
      let self := M.alloc (| self |) in
      let code_hash := M.alloc (| code_hash |) in
      M.read (|
        let _ : M.Val unit :=
          M.alloc (|
            M.call (|((core.result.Result.t
                  unit
                  set_code_hash.Error.t)::["unwrap_or_else"]
              (M.call (|(set_code_hash.set_code_hash (borrow code_hash)) |))
              (fun (α0 : set_code_hash.Error.t) =>
                (ltac:
                  (M.monadic_match_operator
                    (M.alloc (| α0 |))
                    [
                      fun γ =>
                        (let err := M.copy (| γ |) in
                        (never_to_any (B := unit)) (|
                          M.call (|(std.panicking.begin_panic
                            (M.read (|
                              mk_str
                                "Failed to `set_code_hash` to {code_hash:?} due to {err:?}"
                            |)))
                          |)
                        |)) :
                        unit
                    ])) :
                unit))
            |)
          |) in
        let _ : M.Val unit :=
          let _ : M.Val unit :=
            M.alloc (|
              M.call (|(std.io.stdio._print
                (M.call (|(core.fmt.Arguments.t::["new_v1"]
                  (pointer_coercion
                    "Unsize"
                    (borrow
                      (M.alloc (|
                        [
                          M.read (| mk_str "Switched code hash to " |);
                          M.read (| mk_str ".
" |)
                        ]
                      |))))
                  (pointer_coercion
                    "Unsize"
                    (borrow
                      (M.alloc (|
                        [
                          M.call (|(core.fmt.rt.Argument.t::["new_debug"]
                            (borrow code_hash))
                          |)
                        ]
                      |)))))
                |)))
              |)
            |) in
          M.alloc (| tt |) in
        M.alloc (| tt |)
      |)
    )).
  
  Global Instance AssociatedFunction_set_code :
    Notations.DoubleColon Self "set_code" := {
    Notations.double_colon := set_code;
  }.
End Impl_set_code_hash_Incrementer_t.
End Impl_set_code_hash_Incrementer_t.
