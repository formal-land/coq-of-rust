(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module Fruit.
  Inductive t : Set :=
  | Apple
  | Orange
  | Banana
  | Kiwi
  | Lemon.
End Fruit.

Module  Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_Fruit_t.
Section Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_Fruit_t.
  Definition Self : Set := unpacking_options_and_defaults_via_or.Fruit.t.
  
  (*
  Debug
  *)
  Definition fmt
      (self : ref Self)
      (f : mut_ref core.fmt.Formatter.t)
      : M ltac:(core.fmt.Result) :=
    ltac:(M.monadic ((
      let self := M.alloc (| self |) in
      let f := M.alloc (| f |) in
      M.call (|(core.fmt.Formatter.t::["write_str"]
        (M.read (| f |))
        (M.read (|
          ltac:
            (M.monadic_match_operator
              self
              [
                fun
                    (γ :
                      M.Val
                        (ref unpacking_options_and_defaults_via_or.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or.Fruit.Apple =>
                    M.alloc (| M.read (| mk_str "Apple" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref unpacking_options_and_defaults_via_or.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or.Fruit.Orange =>
                    M.alloc (| M.read (| mk_str "Orange" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref unpacking_options_and_defaults_via_or.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or.Fruit.Banana =>
                    M.alloc (| M.read (| mk_str "Banana" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref unpacking_options_and_defaults_via_or.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or.Fruit.Kiwi =>
                    M.alloc (| M.read (| mk_str "Kiwi" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref unpacking_options_and_defaults_via_or.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or.Fruit.Lemon =>
                    M.alloc (| M.read (| mk_str "Lemon" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t)
              ])
        |)))
      |)
    ) : ltac:(core.fmt.Result))).
  
  Global Instance AssociatedFunction_fmt : Notations.DoubleColon Self "fmt" := {
    Notations.double_colon := fmt;
  }.
  
  Global Instance ℐ : core.fmt.Debug.Trait Self := {
    core.fmt.Debug.fmt := fmt;
  }.
End Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_Fruit_t.
End Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_Fruit_t.

(*
fn main() {
    let apple = Some(Fruit::Apple);
    let orange = Some(Fruit::Orange);
    let no_fruit: Option<Fruit> = None;

    let first_available_fruit = no_fruit.or(orange).or(apple);
    println!("first_available_fruit: {:?}", first_available_fruit);
    // first_available_fruit: Some(Orange)

    // `or` moves its argument.
    // In the example above, `or(orange)` returned a `Some`, so `or(apple)` was not invoked.
    // But the variable named `apple` has been moved regardless, and cannot be used anymore.
    // println!("Variable apple was moved, so this line won't compile: {:?}", apple);
    // TODO: uncomment the line above to see the compiler error
}
*)
(* #[allow(dead_code)] - function was ignored by the compiler *)
Definition main : M unit :=
  ltac:(M.monadic ((
    M.read (|
      let apple :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or.Fruit.t) :=
        M.alloc (|
          core.option.Option.Some
            unpacking_options_and_defaults_via_or.Fruit.Apple
        |) in
      let orange :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or.Fruit.t) :=
        M.alloc (|
          core.option.Option.Some
            unpacking_options_and_defaults_via_or.Fruit.Orange
        |) in
      let no_fruit :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or.Fruit.t) :=
        M.alloc (| core.option.Option.None |) in
      let first_available_fruit :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or.Fruit.t) :=
        M.alloc (|
          M.call (|((core.option.Option.t
                unpacking_options_and_defaults_via_or.Fruit.t)::["or"]
            (M.call (|((core.option.Option.t
                  unpacking_options_and_defaults_via_or.Fruit.t)::["or"]
              (M.read (| no_fruit |))
              (M.read (| orange |)))
            |))
            (M.read (| apple |)))
          |)
        |) in
      let _ : M.Val unit :=
        let _ : M.Val unit :=
          M.alloc (|
            M.call (|(std.io.stdio._print
              (M.call (|(core.fmt.Arguments.t::["new_v1"]
                (pointer_coercion
                  "Unsize"
                  (borrow
                    (M.alloc (|
                      [
                        M.read (| mk_str "first_available_fruit: " |);
                        M.read (| mk_str "
" |)
                      ]
                    |))))
                (pointer_coercion
                  "Unsize"
                  (borrow
                    (M.alloc (|
                      [
                        M.call (|(core.fmt.rt.Argument.t::["new_debug"]
                          (borrow first_available_fruit))
                        |)
                      ]
                    |)))))
              |)))
            |)
          |) in
        M.alloc (| tt |) in
      M.alloc (| tt |)
    |)
  ) : unit)).
