(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module Fruit.
  Inductive t : Set :=
  | Apple
  | Orange
  | Banana
  | Kiwi
  | Lemon.
End Fruit.

Module  Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_else_Fruit_t.
Section Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_else_Fruit_t.
  Definition Self : Set := unpacking_options_and_defaults_via_or_else.Fruit.t.
  
  (*
  Debug
  *)
  Definition fmt
      (self : ref Self)
      (f : mut_ref core.fmt.Formatter.t)
      : M ltac:(core.fmt.Result) :=
    ltac:(M.monadic ((
      let self := M.alloc (| self |) in
      let f := M.alloc (| f |) in
      M.call (|(core.fmt.Formatter.t::["write_str"]
        (M.read (| f |))
        (M.read (|
          ltac:
            (M.monadic_match_operator
              self
              [
                fun
                    (γ :
                      M.Val
                        (ref
                          unpacking_options_and_defaults_via_or_else.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or_else.Fruit.Apple =>
                    M.alloc (| M.read (| mk_str "Apple" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref
                          unpacking_options_and_defaults_via_or_else.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or_else.Fruit.Orange =>
                    M.alloc (| M.read (| mk_str "Orange" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref
                          unpacking_options_and_defaults_via_or_else.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or_else.Fruit.Banana =>
                    M.alloc (| M.read (| mk_str "Banana" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref
                          unpacking_options_and_defaults_via_or_else.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or_else.Fruit.Kiwi =>
                    M.alloc (| M.read (| mk_str "Kiwi" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t);
                fun
                    (γ :
                      M.Val
                        (ref
                          unpacking_options_and_defaults_via_or_else.Fruit.t)) =>
                  (let γ := deref (M.read (| γ |)) in
                  match M.read (| γ |) with
                  | unpacking_options_and_defaults_via_or_else.Fruit.Lemon =>
                    M.alloc (| M.read (| mk_str "Lemon" |) |)
                  | _ => M.break_match(||)
                  end) :
                  M.Val (ref str.t)
              ])
        |)))
      |)
    ) : ltac:(core.fmt.Result))).
  
  Global Instance AssociatedFunction_fmt : Notations.DoubleColon Self "fmt" := {
    Notations.double_colon := fmt;
  }.
  
  Global Instance ℐ : core.fmt.Debug.Trait Self := {
    core.fmt.Debug.fmt := fmt;
  }.
End Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_else_Fruit_t.
End Impl_core_fmt_Debug_for_unpacking_options_and_defaults_via_or_else_Fruit_t.

(*
fn main() {
    let apple = Some(Fruit::Apple);
    let no_fruit: Option<Fruit> = None;
    let get_kiwi_as_fallback = || {
        println!("Providing kiwi as fallback");
        Some(Fruit::Kiwi)
    };
    let get_lemon_as_fallback = || {
        println!("Providing lemon as fallback");
        Some(Fruit::Lemon)
    };

    let first_available_fruit = no_fruit
        .or_else(get_kiwi_as_fallback)
        .or_else(get_lemon_as_fallback);
    println!("first_available_fruit: {:?}", first_available_fruit);
    // Providing kiwi as fallback
    // first_available_fruit: Some(Kiwi)
}
*)
(* #[allow(dead_code)] - function was ignored by the compiler *)
Definition main : M unit :=
  ltac:(M.monadic ((
    M.read (|
      let apple :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or_else.Fruit.t) :=
        M.alloc (|
          core.option.Option.Some
            unpacking_options_and_defaults_via_or_else.Fruit.Apple
        |) in
      let no_fruit :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or_else.Fruit.t) :=
        M.alloc (| core.option.Option.None |) in
      let get_kiwi_as_fallback :
          M.Val
            (unit ->
              core.option.Option.t
                unpacking_options_and_defaults_via_or_else.Fruit.t) :=
        M.alloc (|
          fun (α0 : unit) =>
            (ltac:
              (M.monadic_match_operator
                (M.alloc (| α0 |))
                [
                  fun γ =>
                    (M.read (|
                      let _ : M.Val unit :=
                        let _ : M.Val unit :=
                          M.alloc (|
                            M.call (|(std.io.stdio._print
                              (M.call (|(core.fmt.Arguments.t::["new_const"]
                                (pointer_coercion
                                  "Unsize"
                                  (borrow
                                    (M.alloc (|
                                      [
                                        M.read (|
                                          mk_str "Providing kiwi as fallback
"
                                        |)
                                      ]
                                    |)))))
                              |)))
                            |)
                          |) in
                        M.alloc (| tt |) in
                      M.alloc (|
                        core.option.Option.Some
                          unpacking_options_and_defaults_via_or_else.Fruit.Kiwi
                      |)
                    |)) :
                    core.option.Option.t
                      unpacking_options_and_defaults_via_or_else.Fruit.t
                ])) :
            core.option.Option.t
              unpacking_options_and_defaults_via_or_else.Fruit.t
        |) in
      let get_lemon_as_fallback :
          M.Val
            (unit ->
              core.option.Option.t
                unpacking_options_and_defaults_via_or_else.Fruit.t) :=
        M.alloc (|
          fun (α0 : unit) =>
            (ltac:
              (M.monadic_match_operator
                (M.alloc (| α0 |))
                [
                  fun γ =>
                    (M.read (|
                      let _ : M.Val unit :=
                        let _ : M.Val unit :=
                          M.alloc (|
                            M.call (|(std.io.stdio._print
                              (M.call (|(core.fmt.Arguments.t::["new_const"]
                                (pointer_coercion
                                  "Unsize"
                                  (borrow
                                    (M.alloc (|
                                      [
                                        M.read (|
                                          mk_str "Providing lemon as fallback
"
                                        |)
                                      ]
                                    |)))))
                              |)))
                            |)
                          |) in
                        M.alloc (| tt |) in
                      M.alloc (|
                        core.option.Option.Some
                          unpacking_options_and_defaults_via_or_else.Fruit.Lemon
                      |)
                    |)) :
                    core.option.Option.t
                      unpacking_options_and_defaults_via_or_else.Fruit.t
                ])) :
            core.option.Option.t
              unpacking_options_and_defaults_via_or_else.Fruit.t
        |) in
      let first_available_fruit :
          M.Val
            (core.option.Option.t
              unpacking_options_and_defaults_via_or_else.Fruit.t) :=
        M.alloc (|
          M.call (|((core.option.Option.t
                unpacking_options_and_defaults_via_or_else.Fruit.t)::["or_else"]
            (M.call (|((core.option.Option.t
                  unpacking_options_and_defaults_via_or_else.Fruit.t)::["or_else"]
              (M.read (| no_fruit |))
              (M.read (| get_kiwi_as_fallback |)))
            |))
            (M.read (| get_lemon_as_fallback |)))
          |)
        |) in
      let _ : M.Val unit :=
        let _ : M.Val unit :=
          M.alloc (|
            M.call (|(std.io.stdio._print
              (M.call (|(core.fmt.Arguments.t::["new_v1"]
                (pointer_coercion
                  "Unsize"
                  (borrow
                    (M.alloc (|
                      [
                        M.read (| mk_str "first_available_fruit: " |);
                        M.read (| mk_str "
" |)
                      ]
                    |))))
                (pointer_coercion
                  "Unsize"
                  (borrow
                    (M.alloc (|
                      [
                        M.call (|(core.fmt.rt.Argument.t::["new_debug"]
                          (borrow first_available_fruit))
                        |)
                      ]
                    |)))))
              |)))
            |)
          |) in
        M.alloc (| tt |) in
      M.alloc (| tt |)
    |)
  ) : unit)).
