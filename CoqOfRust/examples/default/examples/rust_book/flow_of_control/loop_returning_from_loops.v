(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

(*
fn main() {
    let mut counter = 0;

    let result = loop {
        counter += 1;

        if counter == 10 {
            break counter * 2;
        }
    };

    assert_eq!(result, 20);
}
*)
(* #[allow(dead_code)] - function was ignored by the compiler *)
Definition main : M unit :=
  ltac:(M.monadic ((
    M.read (|
      let counter : M.Val i32.t := M.alloc (| (Integer.of_Z 0) : i32.t |) in
      let result : M.Val i32.t :=
        M.copy (|
          M.loop
            (let _ : M.Val unit :=
              let β : M.Val i32.t := counter in
              assign (|
                β,
                BinOp.Panic.add (| M.read (| β |), (Integer.of_Z 1) : i32.t |)
              |) in
            if
              M.read (|
                use
                  (M.alloc (|
                    BinOp.Pure.eq
                      (M.read (| counter |))
                      ((Integer.of_Z 10) : i32.t)
                  |))
              |)
            then
              M.alloc (| (never_to_any (B := unit)) (| M.read (| M.break |) |)
              |)
            else
              M.alloc (| tt |))
        |) in
      let _ : M.Val unit :=
        ltac:
          (M.monadic_match_operator
            (M.alloc (|
              (borrow result, borrow (M.alloc (| (Integer.of_Z 20) : i32.t |)))
            |))
            [
              fun (γ : M.Val ((ref i32.t) * (ref i32.t))) =>
                match M.read (| γ |) with
                | (_, _) =>
                  let γ0_0 := Tuple.Access.left γ in
                  let γ0_1 := Tuple.Access.right γ in
                  let left_val := M.copy (| γ0_0 |) in
                  let right_val := M.copy (| γ0_1 |) in
                  if
                    M.read (|
                      use
                        (M.alloc (|
                          UnOp.not
                            (BinOp.Pure.eq
                              (M.read (| deref (M.read (| left_val |)) |))
                              (M.read (| deref (M.read (| right_val |)) |)))
                        |))
                    |)
                  then
                    M.alloc (|
                      (never_to_any (B := unit)) (|
                        M.read (|
                          let kind : M.Val core.panicking.AssertKind.t :=
                            M.alloc (| core.panicking.AssertKind.Eq |) in
                          M.alloc (|
                            M.call (|(core.panicking.assert_failed
                              (M.read (| kind |))
                              (M.read (| left_val |))
                              (M.read (| right_val |))
                              core.option.Option.None)
                            |)
                          |)
                        |)
                      |)
                    |)
                  else
                    M.alloc (| tt |)
                end :
                M.Val unit
            ]) in
      M.alloc (| tt |)
    |)
  ) : unit)).
