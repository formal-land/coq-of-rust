(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

(*
fn main() {
    calculate! {
        eval 1 + 2 // hehehe `eval` is _not_ a Rust keyword!
    }

    calculate! {
        eval (1 + 2) * (3 / 4)
    }
}
*)
Definition main (τ : list Ty.t) (α : list Value.t) : M :=
  match τ, α with
  | [], [] =>
    ltac:(M.monadic
      (M.read
        (|
          (let _ :=
            let val :=
              M.alloc
                (|
                  (BinOp.Panic.add
                    (| (Value.Integer Integer.Usize 1), (Value.Integer Integer.Usize 2)
                    |))
                |) in
            let _ :=
              let _ :=
                M.alloc
                  (|
                    (M.call_closure
                      (|
                        (M.get_function (| "std::io::stdio::_print", [] |)),
                        [
                          M.call_closure
                            (|
                              (M.get_associated_function
                                (| (Ty.path "core::fmt::Arguments"), "new_v1", []
                                |)),
                              [
                                (* Unsize *)
                                  M.pointer_coercion
                                    (M.alloc
                                      (|
                                        (Value.Array
                                          [
                                            M.read (| (mk_str "1 + 2 = ") |);
                                            M.read (| (mk_str "
") |)
                                          ])
                                      |));
                                (* Unsize *)
                                  M.pointer_coercion
                                    (M.alloc
                                      (|
                                        (Value.Array
                                          [
                                            M.call_closure
                                              (|
                                                (M.get_associated_function
                                                  (|
                                                    (Ty.path "core::fmt::rt::Argument"),
                                                    "new_display",
                                                    [ Ty.path "usize" ]
                                                  |)),
                                                [ val ]
                                              |)
                                          ])
                                      |))
                              ]
                            |)
                        ]
                      |))
                  |) in
              M.alloc (| (Value.Tuple []) |) in
            M.alloc (| (Value.Tuple []) |) in
          let val :=
            M.alloc
              (|
                (BinOp.Panic.mul
                  (|
                    (BinOp.Panic.add
                      (| (Value.Integer Integer.Usize 1), (Value.Integer Integer.Usize 2)
                      |)),
                    (BinOp.Panic.div
                      (| (Value.Integer Integer.Usize 3), (Value.Integer Integer.Usize 4)
                      |))
                  |))
              |) in
          let _ :=
            let _ :=
              M.alloc
                (|
                  (M.call_closure
                    (|
                      (M.get_function (| "std::io::stdio::_print", [] |)),
                      [
                        M.call_closure
                          (|
                            (M.get_associated_function
                              (| (Ty.path "core::fmt::Arguments"), "new_v1", []
                              |)),
                            [
                              (* Unsize *)
                                M.pointer_coercion
                                  (M.alloc
                                    (|
                                      (Value.Array
                                        [
                                          M.read (| (mk_str "(1 + 2) * (3 / 4) = ") |);
                                          M.read (| (mk_str "
") |)
                                        ])
                                    |));
                              (* Unsize *)
                                M.pointer_coercion
                                  (M.alloc
                                    (|
                                      (Value.Array
                                        [
                                          M.call_closure
                                            (|
                                              (M.get_associated_function
                                                (|
                                                  (Ty.path "core::fmt::rt::Argument"),
                                                  "new_display",
                                                  [ Ty.path "usize" ]
                                                |)),
                                              [ val ]
                                            |)
                                        ])
                                    |))
                            ]
                          |)
                      ]
                    |))
                |) in
            M.alloc (| (Value.Tuple []) |) in
          M.alloc (| (Value.Tuple []) |))
        |)))
  | _, _ => M.impossible
  end.
