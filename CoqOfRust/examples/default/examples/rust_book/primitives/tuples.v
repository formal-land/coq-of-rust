(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

(*
fn reverse(pair: (i32, bool)) -> (bool, i32) {
    // `let` can be used to bind the members of a tuple to variables
    let (int_param, bool_param) = pair;

    (bool_param, int_param)
}
*)
Definition reverse (ðœ : list Ty.t) (Î± : list Value.t) : M :=
  match ðœ, Î± with
  | [], [ pair ] =>
    let* pair := M.alloc pair in
    let* Î±0 :=
      match_operator
        pair
        [
          fun Î³ =>
            (let* Î³0_0 := M.get_tuple_field_or_break_match Î³ 0 in
            let* Î³0_1 := M.get_tuple_field_or_break_match Î³ 1 in
            let* int_param := M.copy Î³0_0 in
            let* bool_param := M.copy Î³0_1 in
            let* Î±0 := M.read bool_param in
            let* Î±1 := M.read int_param in
            M.alloc (Value.Tuple [ Î±0; Î±1 ]))
        ] in
    M.read Î±0
  | _, _ => M.impossible
  end.

(* Struct Matrix *)

Module Impl_core_fmt_Debug_for_tuples_Matrix.
  (*
  Debug
  *)
  Definition fmt (ðœ : list Ty.t) (Î± : list Value.t) : M :=
    match ðœ, Î± with
    | [ Self ], [ self; f ] =>
      let* self := M.alloc self in
      let* f := M.alloc f in
      let* Î±0 :=
        M.get_associated_function
          (Ty.path "core::fmt::Formatter")
          "debug_tuple_field4_finish" in
      let* Î±1 := M.read f in
      let* Î±2 := M.read (mk_str "Matrix") in
      let* Î±3 := M.read self in
      let* Î±4 := M.read self in
      let* Î±5 := M.read self in
      let* Î±6 := M.read self in
      let* Î±7 := M.alloc (M.get_struct_tuple Î±6 3) in
      M.call
        Î±0
        [
          Î±1;
          Î±2;
          M.pointer_coercion (* Unsize *) (M.get_struct_tuple Î±3 0);
          M.pointer_coercion (* Unsize *) (M.get_struct_tuple Î±4 1);
          M.pointer_coercion (* Unsize *) (M.get_struct_tuple Î±5 2);
          M.pointer_coercion (* Unsize *) Î±7
        ]
    | _, _ => M.impossible
    end.
  
  Axiom Implements :
    M.IsTraitInstance
      "core::fmt::Debug"
      (* Self *) (Ty.path "tuples::Matrix")
      (* Trait polymorphic types *) []
      (* Instance *) [ ("fmt", InstanceField.Method fmt) ]
      (* Instance polymorphic types *) [].
End Impl_core_fmt_Debug_for_tuples_Matrix.

(*
fn main() {
    // A tuple with a bunch of different types
    let long_tuple = (1u8, 2u16, 3u32, 4u64,
                      -1i8, -2i16, -3i32, -4i64,
                      0.1f32, 0.2f64,
                      'a', true);

    // Values can be extracted from the tuple using tuple indexing
    println!("long tuple first value: {}", long_tuple.0);
    println!("long tuple second value: {}", long_tuple.1);

    // Tuples can be tuple members
    let tuple_of_tuples = ((1u8, 2u16, 2u32), (4u64, -1i8), -2i16);

    // Tuples are printable
    println!("tuple of tuples: {:?}", tuple_of_tuples);
    
    // But long Tuples (more than 12 elements) cannot be printed
    // let too_long_tuple = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13);
    // println!("too long tuple: {:?}", too_long_tuple);
    // TODO ^ Uncomment the above 2 lines to see the compiler error

    let pair = (1, true);
    println!("pair is {:?}", pair);

    println!("the reversed pair is {:?}", reverse(pair));

    // To create one element tuples, the comma is required to tell them apart
    // from a literal surrounded by parentheses
    println!("one element tuple: {:?}", (5u32,));
    println!("just an integer: {:?}", (5u32));

    //tuples can be destructured to create bindings
    let tuple = (1, "hello", 4.5, true);

    let (a, b, c, d) = tuple;
    println!("{:?}, {:?}, {:?}, {:?}", a, b, c, d);

    let matrix = Matrix(1.1, 1.2, 2.1, 2.2);
    println!("{:?}", matrix);

}
*)
(* #[allow(dead_code)] - function was ignored by the compiler *)
Definition main (ðœ : list Ty.t) (Î± : list Value.t) : M :=
  match ðœ, Î± with
  | [], [] =>
    let* long_tuple :=
      let* Î±0 := M.read UnsupportedLiteral in
      let* Î±1 := M.read UnsupportedLiteral in
      M.alloc
        (Value.Tuple
          [
            Value.Integer Integer.U8 1;
            Value.Integer Integer.U16 2;
            Value.Integer Integer.U32 3;
            Value.Integer Integer.U64 4;
            Value.Integer Integer.I8 (-1);
            Value.Integer Integer.I16 (-2);
            Value.Integer Integer.I32 (-3);
            Value.Integer Integer.I64 (-4);
            Î±0;
            Î±1;
            Value.UnicodeChar 97;
            Value.Bool true
          ]) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "long tuple first value: ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_display" in
        let* Î±6 := M.call Î±5 [ (* Unknown Field *) ] in
        let* Î±7 := M.alloc (Value.Array [ Î±6 ]) in
        let* Î±8 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±7
            ] in
        let* Î±9 := M.call Î±0 [ Î±8 ] in
        M.alloc Î±9 in
      M.alloc (Value.Tuple []) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "long tuple second value: ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_display" in
        let* Î±6 := M.call Î±5 [ (* Unknown Field *) ] in
        let* Î±7 := M.alloc (Value.Array [ Î±6 ]) in
        let* Î±8 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±7
            ] in
        let* Î±9 := M.call Î±0 [ Î±8 ] in
        M.alloc Î±9 in
      M.alloc (Value.Tuple []) in
    let* tuple_of_tuples :=
      M.alloc
        (Value.Tuple
          [
            Value.Tuple
              [
                Value.Integer Integer.U8 1;
                Value.Integer Integer.U16 2;
                Value.Integer Integer.U32 2
              ];
            Value.Tuple
              [ Value.Integer Integer.U64 4; Value.Integer Integer.I8 (-1) ];
            Value.Integer Integer.I16 (-2)
          ]) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "tuple of tuples: ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_debug" in
        let* Î±6 := M.call Î±5 [ tuple_of_tuples ] in
        let* Î±7 := M.alloc (Value.Array [ Î±6 ]) in
        let* Î±8 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±7
            ] in
        let* Î±9 := M.call Î±0 [ Î±8 ] in
        M.alloc Î±9 in
      M.alloc (Value.Tuple []) in
    let* pair :=
      M.alloc (Value.Tuple [ Value.Integer Integer.I32 1; Value.Bool true ]) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "pair is ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_debug" in
        let* Î±6 := M.call Î±5 [ pair ] in
        let* Î±7 := M.alloc (Value.Array [ Î±6 ]) in
        let* Î±8 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±7
            ] in
        let* Î±9 := M.call Î±0 [ Î±8 ] in
        M.alloc Î±9 in
      M.alloc (Value.Tuple []) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "the reversed pair is ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_debug" in
        let* Î±6 := M.get_function "tuples::reverse" [] in
        let* Î±7 := M.read pair in
        let* Î±8 := M.call Î±6 [ Î±7 ] in
        let* Î±9 := M.alloc Î±8 in
        let* Î±10 := M.call Î±5 [ Î±9 ] in
        let* Î±11 := M.alloc (Value.Array [ Î±10 ]) in
        let* Î±12 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±11
            ] in
        let* Î±13 := M.call Î±0 [ Î±12 ] in
        M.alloc Î±13 in
      M.alloc (Value.Tuple []) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "one element tuple: ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_debug" in
        let* Î±6 := M.alloc (Value.Tuple [ Value.Integer Integer.U32 5 ]) in
        let* Î±7 := M.call Î±5 [ Î±6 ] in
        let* Î±8 := M.alloc (Value.Array [ Î±7 ]) in
        let* Î±9 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±8
            ] in
        let* Î±10 := M.call Î±0 [ Î±9 ] in
        M.alloc Î±10 in
      M.alloc (Value.Tuple []) in
    let* _ :=
      let* _ :=
        let* Î±0 := M.get_function "std::io::stdio::_print" [] in
        let* Î±1 :=
          M.get_associated_function (Ty.path "core::fmt::Arguments") "new_v1" in
        let* Î±2 := M.read (mk_str "just an integer: ") in
        let* Î±3 := M.read (mk_str "
") in
        let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
        let* Î±5 :=
          M.get_associated_function
            (Ty.path "core::fmt::rt::Argument")
            "new_debug" in
        let* Î±6 := M.alloc (Value.Integer Integer.U32 5) in
        let* Î±7 := M.call Î±5 [ Î±6 ] in
        let* Î±8 := M.alloc (Value.Array [ Î±7 ]) in
        let* Î±9 :=
          M.call
            Î±1
            [
              M.pointer_coercion (* Unsize *) Î±4;
              M.pointer_coercion (* Unsize *) Î±8
            ] in
        let* Î±10 := M.call Î±0 [ Î±9 ] in
        M.alloc Î±10 in
      M.alloc (Value.Tuple []) in
    let* tuple :=
      let* Î±0 := M.read (mk_str "hello") in
      let* Î±1 := M.read UnsupportedLiteral in
      M.alloc
        (Value.Tuple
          [ Value.Integer Integer.I32 1; Î±0; Î±1; Value.Bool true ]) in
    let* Î±0 :=
      match_operator
        tuple
        [
          fun Î³ =>
            (let* Î³0_0 := M.get_tuple_field_or_break_match Î³ 0 in
            let* Î³0_1 := M.get_tuple_field_or_break_match Î³ 1 in
            let* Î³0_2 := M.get_tuple_field_or_break_match Î³ 2 in
            let* Î³0_3 := M.get_tuple_field_or_break_match Î³ 3 in
            let* a := M.copy Î³0_0 in
            let* b := M.copy Î³0_1 in
            let* c := M.copy Î³0_2 in
            let* d := M.copy Î³0_3 in
            let* _ :=
              let* _ :=
                let* Î±0 := M.get_function "std::io::stdio::_print" [] in
                let* Î±1 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::Arguments")
                    "new_v1" in
                let* Î±2 := M.read (mk_str "") in
                let* Î±3 := M.read (mk_str ", ") in
                let* Î±4 := M.read (mk_str ", ") in
                let* Î±5 := M.read (mk_str ", ") in
                let* Î±6 := M.read (mk_str "
") in
                let* Î±7 := M.alloc (Value.Array [ Î±2; Î±3; Î±4; Î±5; Î±6 ]) in
                let* Î±8 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::rt::Argument")
                    "new_debug" in
                let* Î±9 := M.call Î±8 [ a ] in
                let* Î±10 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::rt::Argument")
                    "new_debug" in
                let* Î±11 := M.call Î±10 [ b ] in
                let* Î±12 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::rt::Argument")
                    "new_debug" in
                let* Î±13 := M.call Î±12 [ c ] in
                let* Î±14 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::rt::Argument")
                    "new_debug" in
                let* Î±15 := M.call Î±14 [ d ] in
                let* Î±16 := M.alloc (Value.Array [ Î±9; Î±11; Î±13; Î±15 ]) in
                let* Î±17 :=
                  M.call
                    Î±1
                    [
                      M.pointer_coercion (* Unsize *) Î±7;
                      M.pointer_coercion (* Unsize *) Î±16
                    ] in
                let* Î±18 := M.call Î±0 [ Î±17 ] in
                M.alloc Î±18 in
              M.alloc (Value.Tuple []) in
            let* matrix :=
              let* Î±0 := M.read UnsupportedLiteral in
              let* Î±1 := M.read UnsupportedLiteral in
              let* Î±2 := M.read UnsupportedLiteral in
              let* Î±3 := M.read UnsupportedLiteral in
              M.alloc (Value.StructTuple "tuples::Matrix" [ Î±0; Î±1; Î±2; Î±3 ]) in
            let* _ :=
              let* _ :=
                let* Î±0 := M.get_function "std::io::stdio::_print" [] in
                let* Î±1 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::Arguments")
                    "new_v1" in
                let* Î±2 := M.read (mk_str "") in
                let* Î±3 := M.read (mk_str "
") in
                let* Î±4 := M.alloc (Value.Array [ Î±2; Î±3 ]) in
                let* Î±5 :=
                  M.get_associated_function
                    (Ty.path "core::fmt::rt::Argument")
                    "new_debug" in
                let* Î±6 := M.call Î±5 [ matrix ] in
                let* Î±7 := M.alloc (Value.Array [ Î±6 ]) in
                let* Î±8 :=
                  M.call
                    Î±1
                    [
                      M.pointer_coercion (* Unsize *) Î±4;
                      M.pointer_coercion (* Unsize *) Î±7
                    ] in
                let* Î±9 := M.call Î±0 [ Î±8 ] in
                M.alloc Î±9 in
              M.alloc (Value.Tuple []) in
            M.alloc (Value.Tuple []))
        ] in
    M.read Î±0
  | _, _ => M.impossible
  end.
