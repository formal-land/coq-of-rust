(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

(*
fn main() {
    let i = 3; // Lifetime for `i` starts. ────────────────┐
               //                                                     │
    {
        //                                                   │
        let borrow1 = &i; // `borrow1` lifetime starts. ──┐│
                          //                                                ││
        println!("borrow1: {}", borrow1); //              ││
    } // `borrow1` ends. ─────────────────────────────────┘│
      //                                                     │
      //                                                     │
    {
        //                                                   │
        let borrow2 = &i; // `borrow2` lifetime starts. ──┐│
                          //                                                ││
        println!("borrow2: {}", borrow2); //              ││
    } // `borrow2` ends. ─────────────────────────────────┘│
      //                                                     │
}
*)
Definition main (τ : list Ty.t) (α : list Value.t) : M :=
  match τ, α with
  | [], [] =>
    ltac:(M.monadic
      (M.read
        (|
          (let i := M.alloc (| (Value.Integer Integer.I32 3) |) in
          let _ :=
            let borrow1 := M.alloc (| i |) in
            let _ :=
              let _ :=
                M.alloc
                  (|
                    (M.call_closure
                      (|
                        (M.get_function (| "std::io::stdio::_print", [] |)),
                        [
                          M.call_closure
                            (|
                              (M.get_associated_function
                                (| (Ty.path "core::fmt::Arguments"), "new_v1", []
                                |)),
                              [
                                (* Unsize *)
                                  M.pointer_coercion
                                    (M.alloc
                                      (|
                                        (Value.Array
                                          [
                                            M.read (| (mk_str "borrow1: ") |);
                                            M.read (| (mk_str "
") |)
                                          ])
                                      |));
                                (* Unsize *)
                                  M.pointer_coercion
                                    (M.alloc
                                      (|
                                        (Value.Array
                                          [
                                            M.call_closure
                                              (|
                                                (M.get_associated_function
                                                  (|
                                                    (Ty.path "core::fmt::rt::Argument"),
                                                    "new_display",
                                                    [ Ty.apply (Ty.path "&") [ Ty.path "i32" ] ]
                                                  |)),
                                                [ borrow1 ]
                                              |)
                                          ])
                                      |))
                              ]
                            |)
                        ]
                      |))
                  |) in
              M.alloc (| (Value.Tuple []) |) in
            M.alloc (| (Value.Tuple []) |) in
          let borrow2 := M.alloc (| i |) in
          let _ :=
            let _ :=
              M.alloc
                (|
                  (M.call_closure
                    (|
                      (M.get_function (| "std::io::stdio::_print", [] |)),
                      [
                        M.call_closure
                          (|
                            (M.get_associated_function
                              (| (Ty.path "core::fmt::Arguments"), "new_v1", []
                              |)),
                            [
                              (* Unsize *)
                                M.pointer_coercion
                                  (M.alloc
                                    (|
                                      (Value.Array
                                        [
                                          M.read (| (mk_str "borrow2: ") |);
                                          M.read (| (mk_str "
") |)
                                        ])
                                    |));
                              (* Unsize *)
                                M.pointer_coercion
                                  (M.alloc
                                    (|
                                      (Value.Array
                                        [
                                          M.call_closure
                                            (|
                                              (M.get_associated_function
                                                (|
                                                  (Ty.path "core::fmt::rt::Argument"),
                                                  "new_display",
                                                  [ Ty.apply (Ty.path "&") [ Ty.path "i32" ] ]
                                                |)),
                                              [ borrow2 ]
                                            |)
                                        ])
                                    |))
                            ]
                          |)
                      ]
                    |))
                |) in
            M.alloc (| (Value.Tuple []) |) in
          M.alloc (| (Value.Tuple []) |))
        |)))
  | _, _ => M.impossible
  end.
