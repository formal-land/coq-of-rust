(* Generated by coq-of-rust *)
Require Import CoqOfRust.CoqOfRust.

Module handler.
  Module handle_types.
    Module validation.
      Axiom ValidateEnvHandle :
        forall (DB : Ty.t),
        (Ty.apply (Ty.path "revm::handler::handle_types::validation::ValidateEnvHandle") [ DB ]) =
          (Ty.apply
            (Ty.path "alloc::sync::Arc")
            [
              Ty.dyn
                [
                  ("existential predicate with variables", []);
                  ("existential predicate with variables", [])
                ];
              Ty.path "alloc::alloc::Global"
            ]).
      
      Axiom ValidateTxEnvAgainstState :
        forall (EXT DB : Ty.t),
        (Ty.apply
            (Ty.path "revm::handler::handle_types::validation::ValidateTxEnvAgainstState")
            [ EXT; DB ]) =
          (Ty.apply
            (Ty.path "alloc::sync::Arc")
            [
              Ty.dyn
                [
                  ("existential predicate with variables", []);
                  ("existential predicate with variables", [])
                ];
              Ty.path "alloc::alloc::Global"
            ]).
      
      Axiom ValidateInitialTxGasHandle :
        forall (DB : Ty.t),
        (Ty.apply
            (Ty.path "revm::handler::handle_types::validation::ValidateInitialTxGasHandle")
            [ DB ]) =
          (Ty.apply
            (Ty.path "alloc::sync::Arc")
            [
              Ty.dyn
                [
                  ("existential predicate with variables", []);
                  ("existential predicate with variables", [])
                ];
              Ty.path "alloc::alloc::Global"
            ]).
      
      (* StructRecord
        {
          name := "ValidationHandler";
          ty_params := [ "EXT"; "DB" ];
          fields :=
            [
              ("initial_tx_gas",
                Ty.apply
                  (Ty.path "alloc::sync::Arc")
                  [
                    Ty.dyn
                      [
                        ("existential predicate with variables", []);
                        ("existential predicate with variables", [])
                      ];
                    Ty.path "alloc::alloc::Global"
                  ]);
              ("tx_against_state",
                Ty.apply
                  (Ty.path "alloc::sync::Arc")
                  [
                    Ty.dyn
                      [
                        ("existential predicate with variables", []);
                        ("existential predicate with variables", [])
                      ];
                    Ty.path "alloc::alloc::Global"
                  ]);
              ("env",
                Ty.apply
                  (Ty.path "alloc::sync::Arc")
                  [
                    Ty.dyn
                      [
                        ("existential predicate with variables", []);
                        ("existential predicate with variables", [])
                      ];
                    Ty.path "alloc::alloc::Global"
                  ])
            ];
        } *)
      
      Module Impl_revm_handler_handle_types_validation_ValidationHandler_EXT_DB.
        Definition Self (EXT DB : Ty.t) : Ty.t :=
          Ty.apply
            (Ty.path "revm::handler::handle_types::validation::ValidationHandler")
            [ EXT; DB ].
        
        (*
            pub fn new<SPEC: Spec + 'a>() -> Self {
                Self {
                    initial_tx_gas: Arc::new(mainnet::validate_initial_tx_gas::<SPEC, DB>),
                    env: Arc::new(mainnet::validate_env::<SPEC, DB>),
                    tx_against_state: Arc::new(mainnet::validate_tx_against_state::<SPEC, EXT, DB>),
                }
            }
        *)
        Definition new (EXT DB : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self EXT DB in
          match τ, α with
          | [ SPEC ], [] =>
            ltac:(M.monadic
              (Value.StructRecord
                "revm::handler::handle_types::validation::ValidationHandler"
                [
                  ("initial_tx_gas",
                    (* Unsize *)
                    M.pointer_coercion
                      (M.call_closure (|
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::sync::Arc")
                            [
                              Ty.function
                                [ Ty.apply (Ty.path "&") [ Ty.path "revm_primitives::env::Env" ] ]
                                (Ty.apply
                                  (Ty.path "core::result::Result")
                                  [
                                    Ty.path "u64";
                                    Ty.apply
                                      (Ty.path "revm_primitives::result::EVMError")
                                      [ Ty.associated ]
                                  ]);
                              Ty.path "alloc::alloc::Global"
                            ],
                          "new",
                          []
                        |),
                        [
                          M.get_function (|
                            "revm::handler::mainnet::validation::validate_initial_tx_gas",
                            [ SPEC; DB ]
                          |)
                        ]
                      |)));
                  ("env",
                    (* Unsize *)
                    M.pointer_coercion
                      (M.call_closure (|
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::sync::Arc")
                            [
                              Ty.function
                                [ Ty.apply (Ty.path "&") [ Ty.path "revm_primitives::env::Env" ] ]
                                (Ty.apply
                                  (Ty.path "core::result::Result")
                                  [
                                    Ty.tuple [];
                                    Ty.apply
                                      (Ty.path "revm_primitives::result::EVMError")
                                      [ Ty.associated ]
                                  ]);
                              Ty.path "alloc::alloc::Global"
                            ],
                          "new",
                          []
                        |),
                        [
                          M.get_function (|
                            "revm::handler::mainnet::validation::validate_env",
                            [ SPEC; DB ]
                          |)
                        ]
                      |)));
                  ("tx_against_state",
                    (* Unsize *)
                    M.pointer_coercion
                      (M.call_closure (|
                        M.get_associated_function (|
                          Ty.apply
                            (Ty.path "alloc::sync::Arc")
                            [
                              Ty.function
                                [
                                  Ty.apply
                                    (Ty.path "&mut")
                                    [ Ty.apply (Ty.path "revm::context::Context") [ EXT; DB ] ]
                                ]
                                (Ty.apply
                                  (Ty.path "core::result::Result")
                                  [
                                    Ty.tuple [];
                                    Ty.apply
                                      (Ty.path "revm_primitives::result::EVMError")
                                      [ Ty.associated ]
                                  ]);
                              Ty.path "alloc::alloc::Global"
                            ],
                          "new",
                          []
                        |),
                        [
                          M.get_function (|
                            "revm::handler::mainnet::validation::validate_tx_against_state",
                            [ SPEC; EXT; DB ]
                          |)
                        ]
                      |)))
                ]))
          | _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom AssociatedFunction_new :
          forall (EXT DB : Ty.t),
          M.IsAssociatedFunction (Self EXT DB) "new" (new EXT DB).
        (*
            pub fn env(&self, env: &Env) -> Result<(), EVMError<DB::Error>> {
                (self.env)(env)
            }
        *)
        Definition env (EXT DB : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self EXT DB in
          match τ, α with
          | [], [ self; env ] =>
            ltac:(M.monadic
              (let self := M.alloc (| self |) in
              let env := M.alloc (| env |) in
              M.call_closure (|
                M.get_trait_method (|
                  "core::ops::function::Fn",
                  Ty.dyn
                    [
                      ("existential predicate with variables", []);
                      ("existential predicate with variables", [])
                    ],
                  [ Ty.tuple [ Ty.apply (Ty.path "&") [ Ty.path "revm_primitives::env::Env" ] ] ],
                  "call",
                  []
                |),
                [
                  M.call_closure (|
                    M.get_trait_method (|
                      "core::ops::deref::Deref",
                      Ty.apply
                        (Ty.path "alloc::sync::Arc")
                        [
                          Ty.dyn
                            [
                              ("existential predicate with variables", []);
                              ("existential predicate with variables", [])
                            ];
                          Ty.path "alloc::alloc::Global"
                        ],
                      [],
                      "deref",
                      []
                    |),
                    [
                      M.SubPointer.get_struct_record_field (|
                        M.read (| self |),
                        "revm::handler::handle_types::validation::ValidationHandler",
                        "env"
                      |)
                    ]
                  |);
                  Value.Tuple [ M.read (| env |) ]
                ]
              |)))
          | _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom AssociatedFunction_env :
          forall (EXT DB : Ty.t),
          M.IsAssociatedFunction (Self EXT DB) "env" (env EXT DB).
        
        (*
            pub fn initial_tx_gas(&self, env: &Env) -> Result<u64, EVMError<DB::Error>> {
                (self.initial_tx_gas)(env)
            }
        *)
        Definition initial_tx_gas (EXT DB : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self EXT DB in
          match τ, α with
          | [], [ self; env ] =>
            ltac:(M.monadic
              (let self := M.alloc (| self |) in
              let env := M.alloc (| env |) in
              M.call_closure (|
                M.get_trait_method (|
                  "core::ops::function::Fn",
                  Ty.dyn
                    [
                      ("existential predicate with variables", []);
                      ("existential predicate with variables", [])
                    ],
                  [ Ty.tuple [ Ty.apply (Ty.path "&") [ Ty.path "revm_primitives::env::Env" ] ] ],
                  "call",
                  []
                |),
                [
                  M.call_closure (|
                    M.get_trait_method (|
                      "core::ops::deref::Deref",
                      Ty.apply
                        (Ty.path "alloc::sync::Arc")
                        [
                          Ty.dyn
                            [
                              ("existential predicate with variables", []);
                              ("existential predicate with variables", [])
                            ];
                          Ty.path "alloc::alloc::Global"
                        ],
                      [],
                      "deref",
                      []
                    |),
                    [
                      M.SubPointer.get_struct_record_field (|
                        M.read (| self |),
                        "revm::handler::handle_types::validation::ValidationHandler",
                        "initial_tx_gas"
                      |)
                    ]
                  |);
                  Value.Tuple [ M.read (| env |) ]
                ]
              |)))
          | _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom AssociatedFunction_initial_tx_gas :
          forall (EXT DB : Ty.t),
          M.IsAssociatedFunction (Self EXT DB) "initial_tx_gas" (initial_tx_gas EXT DB).
        
        (*
            pub fn tx_against_state(
                &self,
                context: &mut Context<EXT, DB>,
            ) -> Result<(), EVMError<DB::Error>> {
                (self.tx_against_state)(context)
            }
        *)
        Definition tx_against_state (EXT DB : Ty.t) (τ : list Ty.t) (α : list Value.t) : M :=
          let Self : Ty.t := Self EXT DB in
          match τ, α with
          | [], [ self; context ] =>
            ltac:(M.monadic
              (let self := M.alloc (| self |) in
              let context := M.alloc (| context |) in
              M.call_closure (|
                M.get_trait_method (|
                  "core::ops::function::Fn",
                  Ty.dyn
                    [
                      ("existential predicate with variables", []);
                      ("existential predicate with variables", [])
                    ],
                  [
                    Ty.tuple
                      [
                        Ty.apply
                          (Ty.path "&mut")
                          [ Ty.apply (Ty.path "revm::context::Context") [ EXT; DB ] ]
                      ]
                  ],
                  "call",
                  []
                |),
                [
                  M.call_closure (|
                    M.get_trait_method (|
                      "core::ops::deref::Deref",
                      Ty.apply
                        (Ty.path "alloc::sync::Arc")
                        [
                          Ty.dyn
                            [
                              ("existential predicate with variables", []);
                              ("existential predicate with variables", [])
                            ];
                          Ty.path "alloc::alloc::Global"
                        ],
                      [],
                      "deref",
                      []
                    |),
                    [
                      M.SubPointer.get_struct_record_field (|
                        M.read (| self |),
                        "revm::handler::handle_types::validation::ValidationHandler",
                        "tx_against_state"
                      |)
                    ]
                  |);
                  Value.Tuple [ M.read (| context |) ]
                ]
              |)))
          | _, _ => M.impossible "wrong number of arguments"
          end.
        
        Axiom AssociatedFunction_tx_against_state :
          forall (EXT DB : Ty.t),
          M.IsAssociatedFunction (Self EXT DB) "tx_against_state" (tx_against_state EXT DB).
      End Impl_revm_handler_handle_types_validation_ValidationHandler_EXT_DB.
      
    End validation.
  End handle_types.
End handler.
